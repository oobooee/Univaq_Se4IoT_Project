"use strict";(self.webpackChunkgrafana_lokiexplore_app=self.webpackChunkgrafana_lokiexplore_app||[]).push([[59],{5218:(e,t,n)=>{n.d(t,{F:()=>l});var r=n(6089),a=n(2007),i=n(5959),s=n.n(i),o=n(1220);const l=e=>{const{isExcluded:t,isIncluded:n,onInclude:r,onExclude:i,onClear:l,titles:d,buttonFill:u}=e,p=(0,a.useStyles2)(c,n,t);return s().createElement("div",{className:p.container},s().createElement(a.Button,{variant:n?"primary":"secondary",fill:u,size:"sm","aria-selected":n,className:p.includeButton,onClick:n?l:r,"data-testid":o.b.exploreServiceDetails.buttonFilterInclude,title:null==d?void 0:d.include},"Include"),s().createElement(a.Button,{variant:t?"primary":"secondary",fill:u,size:"sm","aria-selected":t,className:p.excludeButton,onClick:t?l:i,title:null==d?void 0:d.exclude,"data-testid":o.b.exploreServiceDetails.buttonFilterExclude},"Exclude"))},c=(e,t,n)=>({container:(0,r.css)({display:"flex",justifyContent:"center"}),includeButton:(0,r.css)({borderRadius:0,borderRight:t?void 0:"none"}),excludeButton:(0,r.css)({borderRadius:`0 ${e.shape.radius.default} ${e.shape.radius.default} 0`,borderLeft:n?void 0:"none"})})},4482:(e,t,n)=>{n.d(t,{R:()=>c});var r=n(5959),a=n.n(r),i=n(6089),s=n(1575),o=n(2007);const l=e=>({graphicContainer:(0,i.css)({display:"flex",justifyContent:"center",margin:"0 auto"}),graphic:(0,i.css)({width:"200px",height:"120px",padding:e.spacing(1)}),text:(0,i.css)({display:"flex",justifyContent:"center",alignItems:"center"}),wrap:(0,i.css)({margin:"0 auto"})}),c=({children:e})=>{const t=(0,o.useStyles2)(l),n=(0,o.useTheme2)();return a().createElement("div",{className:t.wrap},a().createElement("div",{className:t.graphicContainer},a().createElement(s.A,{className:t.graphic,src:n.isDark?"/public/plugins/grafana-lokiexplore-app/img/grot_err.svg":"/public/plugins/grafana-lokiexplore-app/img/grot_err_light.svg"})),a().createElement("div",{className:t.text},a().createElement(o.Text,{textAlignment:"center",color:"primary",element:"span"},e||"An error occurred")))}},4235:(e,t,n)=>{n.d(t,{PR:()=>De,nB:()=>Ae,yQ:()=>Fe});var r=n(5959),a=n.n(r),i=n(7781),s=n(7141),o=n(3143),l=n(227),c=n(1766),d=n(2007),u=n(6089),p=n(1220);const g=({onRemove:e,pattern:t,size:n="lg"})=>{const i=(0,d.useStyles2)(m),[s,o]=(0,r.useState)(!1);return a().createElement("div",{className:i.pattern,onClick:()=>o(!s),onMouseLeave:()=>o(!1)},a().createElement(d.Tag,{title:t,key:t,name:s?t:v(t,n),className:i.tag}),a().createElement(d.Button,{"aria-label":"Remove pattern","data-testid":p.b.exploreServiceDetails.buttonRemovePattern,variant:"secondary",size:"sm",className:i.removeButton,onClick:e},a().createElement(d.Icon,{name:"times"})))},h={sm:50,lg:Math.round(window.innerWidth/8)};function v(e,t){const n=e.length;if(n<h[t])return e;const r=Math.round(.4*h[t]);return`${e.substring(0,r)} … ${e.substring(n-r)}`}const m=e=>({pattern:(0,u.css)({display:"flex",fontFamily:"monospace",gap:e.spacing(.25),cursor:"pointer",overflow:"hidden"}),tag:(0,u.css)({borderTopRightRadius:0,borderBottomRightRadius:0,backgroundColor:e.colors.secondary.main,border:`solid 1px ${e.colors.secondary.border}`,color:e.colors.secondary.text,boxSizing:"border-box",padding:e.spacing(.25,.75),overflow:"hidden",textOverflow:"ellipsis"}),removeButton:(0,u.css)({paddingLeft:2.5,paddingRight:2.5})});var f=n(2718);const b=({patterns:e,onRemove:t})=>{const n=(0,d.useStyles2)(y);if(!e||0===e.length)return null;const r=e.filter((e=>"include"===e.type)),i=e.filter((e=>"include"!==e.type)),s=n=>{t(e.filter((e=>e!==n))),(0,f.EE)(f.NO.service_details,f.ir.service_details.pattern_removed,{includePatternsLength:r.length-("include"===(null==n?void 0:n.type)?1:0),excludePatternsLength:i.length-("include"!==(null==n?void 0:n.type)?1:0),type:n.type})};return a().createElement("div",null,r.length>0&&a().createElement("div",{className:n.patternsContainer},a().createElement(d.Text,{variant:"bodySmall",weight:"bold","data-testid":p.b.patterns.buttonIncludedPattern},"Included pattern",e.length>1?"s":""),a().createElement("div",{className:n.patterns},r.map((e=>a().createElement(g,{key:e.pattern,pattern:e.pattern,size:"lg",onRemove:()=>s(e)}))))),i.length>0&&a().createElement("div",{className:n.patternsContainer},a().createElement(d.Text,{variant:"bodySmall",weight:"bold","data-testid":p.b.patterns.buttonExcludedPattern},"Excluded pattern",i.length>1?"s":"",":"),a().createElement("div",{className:n.patterns},i.map((e=>a().createElement(g,{key:e.pattern,pattern:e.pattern,size:i.length>1?"sm":"lg",onRemove:()=>s(e)}))))))};function y(e){return{patternsContainer:(0,u.css)({paddingBottom:e.spacing(1),overflow:"hidden"}),patterns:(0,u.css)({display:"flex",gap:e.spacing(1),alignItems:"center",flexWrap:"wrap"})}}const S=()=>{const e=(0,d.useStyles2)(w);return a().createElement("div",{className:e.wrapper},a().createElement("a",{href:"https://forms.gle/1sYWCTPvD72T1dPH9",className:e.feedback,title:"Share your thoughts about Logs in Grafana.",target:"_blank",rel:"noreferrer noopener"},a().createElement(d.Icon,{name:"comment-alt-message"})," Give feedback"))},w=e=>({wrapper:(0,u.css)({display:"flex",marginLeft:"auto",gap:e.spacing(1),position:"relative",top:e.spacing(-1)}),feedback:(0,u.css)({alignSelf:"center",color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,"&:hover":{color:e.colors.text.link}})});function O(e){const t=(0,d.useStyles2)(E);return a().createElement(a().Fragment,null,a().createElement(d.Alert,{className:t.alert,severity:"info",title:"Welcome to Explore Logs!",onRemove:e.onRemove},a().createElement("div",null,"Check out our"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://grafana.com/docs/grafana-cloud/visualizations/simplified-exploration/logs/",rel:"noreferrer"},"Get started doc"),", or see"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://github.com/grafana/explore-logs/releases",rel:"noreferrer"},"recent changes"),".",a().createElement("br",null),"Help us shape the future of the app."," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://forms.gle/1sYWCTPvD72T1dPH9",rel:"noreferrer"},"Send us feedback")," ","or engage with us on"," ",a().createElement("a",{className:"external-link",target:"_blank",href:"https://github.com/grafana/explore-logs/?tab=readme-ov-file#explore-logs",rel:"noreferrer"},"GitHub"),".")))}function E(e){return{alert:(0,u.css)({flex:"none"})}}var x,C,L,k=n(8831);class j extends s.Bs{}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}L=function({model:e}){var t,n;const r=s.jh.getVariables(e).useState();let i=r.variables;return(null===(t=e.state.include)||void 0===t?void 0:t.length)&&(i=r.variables.filter((t=>{var n,r;return null===(n=e.state.include)||void 0===n?void 0:n.includes(null!==(r=t.state.name)&&void 0!==r?r:"")}))),(null===(n=e.state.exclude)||void 0===n?void 0:n.length)&&(i=r.variables.filter((t=>{var n,r;return!(null===(n=e.state.exclude)||void 0===n?void 0:n.includes(null!==(r=t.state.name)&&void 0!==r?r:""))}))),a().createElement(a().Fragment,null,i.map((t=>a().createElement(s.Lp,{key:t.state.key,variable:t,layout:e.state.layout}))))},(C="Component")in(x=j)?Object.defineProperty(x,C,{value:L,enumerable:!0,configurable:!0,writable:!0}):x[C]=L;const _=`${k.s_}.interceptBannerStorageKey`;class T extends s.Bs{dismiss(){this.setState({interceptDismissed:!0}),localStorage.setItem(_,"true")}constructor(e){var t,n;super((t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){P(e,t,n[t])}))}return e}({},e),n=null!=(n={interceptDismissed:!!localStorage.getItem(_)})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t))}}function F(e){return{firstRowWrapper:(0,u.css)({"& > div > div":{gap:"16px",label:"first-row-wrapper",[e.breakpoints.down("lg")]:{flexDirection:"column"},"& > div:first-child":{flex:"1 0 auto",display:"inline-block"}}}),bodyContainer:(0,u.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column"}),container:(0,u.css)({flexGrow:1,display:"flex",gap:e.spacing(1),minHeight:"100%",flexDirection:"column",padding:e.spacing(2),maxWidth:"100vw"}),body:(0,u.css)({flexGrow:1,display:"flex",flexDirection:"column",gap:e.spacing(1)}),controlsFirstRowContainer:(0,u.css)({display:"flex",gap:e.spacing(2),justifyContent:"space-between",alignItems:"flex-start",marginBottom:e.spacing(2)}),controlsSecondRowContainer:(0,u.css)({display:"flex",gap:e.spacing(2),justifyContent:"space-between",alignItems:"flex-start"}),controlsContainer:(0,u.css)({label:"controlsContainer"}),filters:(0,u.css)({label:"filters"}),filtersWrap:(0,u.css)({label:"filtersWrap",display:"flex",gap:e.spacing(2),width:"calc(100% - 450)",flexWrap:"wrap",alignItems:"flex-end",'& + div[data-testid="data-testid Dashboard template variables submenu Label Filters"]:empty':{visibility:"hidden"},"& > div &:first-child":{"& > div":{"& > div":{flexWrap:"wrap","& > div":{maxWidth:"380px","& > div":{flex:"1 0 auto","&:nth-child(3)":{flex:"0 1 auto"}}}}}},'[data-testid="AdHocFilter-service_name"]':{'div[class*="input-wrapper"]:first-child':{display:"none"},'div[class*="input-wrapper"]:nth-child(2)':{marginLeft:0}},'div >[title="Add filter"]':{border:0,display:"none",width:0,padding:0,margin:0}}),controlsWrapper:(0,u.css)({label:"controlsWrapper",display:"flex",flexDirection:"column",marginTop:e.spacing(.375)}),controls:(0,u.css)({display:"flex",gap:e.spacing(1)}),feedback:(0,u.css)({textAlign:"end"}),rotateIcon:(0,u.css)({svg:{transform:"rotate(180deg)"}})}}P(T,"Component",(({model:e})=>{if(!e.parent)return null;const{controls:t,contentScene:n,patterns:r}=e.parent.useState(),{interceptDismissed:i}=e.useState();if(!n)return null;const o=(0,d.useStyles2)(F);return a().createElement("div",{className:o.bodyContainer},a().createElement("div",{className:o.container},!i&&a().createElement(O,{onRemove:()=>{e.dismiss()}}),t&&a().createElement("div",{className:o.controlsContainer},a().createElement("div",{className:o.controlsFirstRowContainer},a().createElement("div",{className:o.filtersWrap},a().createElement("div",{className:(0,u.cx)(o.filters,o.firstRowWrapper)},t.map((e=>e instanceof s.G1?a().createElement(e.Component,{key:e.state.key,model:e}):null)))),a().createElement("div",{className:o.controlsWrapper},a().createElement(S,null),a().createElement("div",{className:o.controls},t.map((e=>e instanceof j||e instanceof s.G1?null:a().createElement(e.Component,{key:e.state.key,model:e})))))),a().createElement("div",{className:o.controlsSecondRowContainer},a().createElement("div",{className:o.filtersWrap},a().createElement("div",{className:o.filters},t.map((e=>e instanceof j?a().createElement(e.Component,{key:e.state.key,model:e}):null)))))),a().createElement(b,{patterns:r,onRemove:t=>{var n;return null===(n=e.parent)||void 0===n?void 0:n.setState({patterns:t})}}),a().createElement("div",{className:o.body},n&&a().createElement(n.Component,{model:n}))))}));var D=n(892),N=n(6939),$=n(8531),A=n(7918),I=n(5435),M=n(5431),B=n(4750),R=n(4002),V=n(4106),W=n(1255),z=n(9829),H=n(2871),U=n(3241),G=n(4793);function q(e,t,n,r,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function Q(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){q(i,r,a,s,o,"next",e)}function o(e){q(i,r,a,s,o,"throw",e)}s(void 0)}))}}const J=function(){var e=Q((function*(e,t,n,r,a){const i=yield(0,$.getDataSourceSrv)().get((0,z.U4)(n));if(!(i instanceof $.DataSourceWithBackend))throw H.v.error(new Error("getTagValuesProvider: Invalid datasource!")),new Error("Invalid datasource!");const s=i.languageProvider;let l=[];if(s&&s.fetchDetectedLabelValues){const n={expr:t,limit:1e3,timeRange:r,throwError:!0},i={showErrorAlert:!1};try{let t=yield s.fetchDetectedLabelValues(e.key,n,i);if(t&&(0,U.isArray)(t)){if(a===o.mB){const n=(0,B.bu)(e,a);return{replace:!0,values:t.map((e=>({text:e,value:JSON.stringify({value:e,parser:n.parser})})))}}l=t.map((e=>({text:e})))}else l=[]}catch(e){H.v.error(e,{msg:"getDetectedFieldValuesTagValuesProvider: loki missing detected_field/.../values endpoint. Upgrade to Loki 3.3.0 or higher."}),l=[]}}else H.v.warn("getDetectedFieldValuesTagValuesProvider: fetchDetectedLabelValues is not defined in Loki datasource. Upgrade to Grafana 11.4 or higher."),l=[];return{replace:!0,values:l}}));return function(t,n,r,a,i){return e.apply(this,arguments)}}();function K(e,t){return Y.apply(this,arguments)}function Y(){return(Y=Q((function*(e,t){const n=yield(0,$.getDataSourceSrv)().get((0,z.U4)(e));if(!(n instanceof $.DataSourceWithBackend))throw H.v.error(new Error("getTagValuesProvider: Invalid datasource!")),new Error("Invalid datasource!");const r=n;if(r&&r.getTagValues){const n=(0,A.W3)(e).filter((e=>!("="===t.operator&&e.key===t.key))),i={key:t.key,filters:n};let s=yield r.getTagValues(i);if((0,U.isArray)(s)){var a;s=s.filter((n=>!e.state.filters.filter((e=>e.key===t.key)).some((e=>e.operator===G.w.Equal&&e.value===n.text))));const n=(0,l.eT)(null===(a=(0,B.S9)(e).getValue())||void 0===a?void 0:a.toString(),t.key),r=new Set(n);n.length&&s.sort(((e,t)=>(r.has(t.text)?1:-1)-(r.has(e.text)?1:-1)))}return{replace:!0,values:s}}return H.v.error(new Error("getTagValuesProvider: missing or invalid datasource!")),{replace:!0,values:[]}}))).apply(this,arguments)}var X=n(7097),Z=n(6001);function ee(e,t,n,r,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function te(e){return ne.apply(this,arguments)}function ne(){var e;return e=function*(e){const t=yield(0,$.getDataSourceSrv)().get((0,z.U4)(e));if(!(t instanceof $.DataSourceWithBackend))throw H.v.error(new Error("getTagKeysProvider: Invalid datasource!")),new Error("Invalid datasource!");const n=t;if(n&&n.getTagKeys){const t={filters:(0,A.W3)(e)},r=yield n.getTagKeys(t),a=(Array.isArray(r)?r:[]).filter((e=>!Z.rm.includes(e.text)));return{replace:!0,values:a}}return H.v.error(new Error("getTagKeysProvider: missing or invalid datasource!")),{replace:!0,values:[]}},ne=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){ee(i,r,a,s,o,"next",e)}function o(e){ee(i,r,a,s,o,"throw",e)}s(void 0)}))},ne.apply(this,arguments)}var re=n(6059);function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let ie={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},se={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},oe={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},le={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},ce=null;for(let e=1;e<20;++e)ie[111+e]="f"+e;for(let e=0;e<=9;++e)ie[e+96]=e.toString();function de(e){if("keypress"===e.type){let t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return ie[e.which]?ie[e.which]:se[e.which]?se[e.which]:String.fromCharCode(e.which).toLowerCase()}function ue(e){return"shift"===e||"ctrl"===e||"alt"===e||"meta"===e}function pe(e,t,n){return n||(n=function(){if(!ce){ce={};for(let e in ie){const t=parseInt(e,10);t>95&&t<112||ie.hasOwnProperty(e)&&(ce[ie[e]]=e)}}return ce}()[e]?"keydown":"keypress"),"keypress"===n&&t.length&&(n="keydown"),n}function ge(e,t){let n,r,a,i=[];for(n=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),a=0;a<n.length;++a)r=n[a],le[r]&&(r=le[r]),t&&"keypress"!==t&&oe[r]&&(r=oe[r],i.push("shift")),ue(r)&&i.push(r);if(!r)throw new Error("Unable to get key");return{key:r,modifiers:i,action:t=pe(r,i,t)}}function he(e,t){return null!==e&&e!==document&&(e===t||he(e.parentNode,t))}const ve=new class{constructor(e){ae(this,"target",void 0),ae(this,"_callbacks",{}),ae(this,"_directMap",{}),ae(this,"_sequenceLevels",{}),ae(this,"_resetTimer",void 0),ae(this,"_ignoreNextKeyup",!1),ae(this,"_ignoreNextKeypress",!1),ae(this,"_nextExpectedAction",!1),ae(this,"_globalCallbacks",{}),ae(this,"_resetSequences",(e=>{e=e||{};let t,n=!1;for(t in this._sequenceLevels)e[t]?n=!0:this._sequenceLevels[t]=0;n||(this._nextExpectedAction=!1)})),ae(this,"_getMatches",((e,t,n,r,a,i)=>{let s,o,l=[],c=n.type;if(!this._callbacks[e])return[];for("keyup"===c&&ue(e)&&(t=[e]),s=0;s<this._callbacks[e].length;++s)if(o=this._callbacks[e][s],(r||!o.seq||this._sequenceLevels[o.seq]===o.level)&&c===o.action&&("keypress"===c&&!n.metaKey&&!n.ctrlKey||(d=t,u=o.modifiers,d.sort().join(",")===u.sort().join(",")))){let t=!r&&o.combo===a,n=r&&o.seq===r&&o.level===i;(t||n)&&this._callbacks[e].splice(s,1),l.push(o)}var d,u;return l})),ae(this,"_fireCallback",((e,t,n,r)=>{const a=t.target||t.srcElement;var i;a&&a instanceof HTMLElement&&this.stopCallback(t,a,n,r)||!1===e(t,n)&&((i=t).preventDefault?i.preventDefault():i.returnValue=!1,function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(t))})),ae(this,"_handleKey",((e,t,n)=>{let r,a=this._getMatches(e,t,n),i={},s=0,o=!1;for(r=0;r<a.length;++r){var l;a[r].seq&&(s=Math.max(s,null!==(l=a[r].level)&&void 0!==l?l:0))}for(r=0;r<a.length;++r){const t=a[r].seq;if(t){if(a[r].level!==s)continue;o=!0,i[t]=1,this._fireCallback(a[r].callback,n,a[r].combo,t);const l=t.lastIndexOf(e),c=t.slice(0,l);for(const[e,t]of Object.entries(this._sequenceLevels))t>0&&e.startsWith(c)&&(i[e]=1)}else o||this._fireCallback(a[r].callback,n,a[r].combo)}var c;for(const t of null!==(c=this._callbacks[e])&&void 0!==c?c:[])t.action===n.type&&t.seq&&0===t.level&&(i[t.seq]=1);let d="keypress"===n.type&&this._ignoreNextKeypress;n.type!==this._nextExpectedAction||ue(e)||d||this._resetSequences(i),this._ignoreNextKeypress=o&&"keydown"===n.type})),ae(this,"_handleKeyEvent",(e=>{if(!(e instanceof KeyboardEvent))throw new Error("Didn't get a KeyboardEvent");const t=e;if(t.repeat)return;"number"!=typeof t.which&&(t.which=t.keyCode);let n=de(t);n&&("keyup"!==t.type||this._ignoreNextKeyup!==n?this.handleKey(n,function(e){let t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(t),t):this._ignoreNextKeyup=!1)})),ae(this,"_resetSequenceTimer",(()=>{clearTimeout(this._resetTimer),this._resetTimer=setTimeout(this._resetSequences,1e3)})),ae(this,"_bindSequence",((e,t,n,r)=>{this._sequenceLevels[e]=0;const a=t=>()=>{this._nextExpectedAction=t,++this._sequenceLevels[e],this._resetSequenceTimer()},i=t=>{this._fireCallback(n,t,e),"keyup"!==r&&(this._ignoreNextKeyup=de(t)),this._resetSequenceTimer()};for(let n=0;n<t.length;++n){let s=n+1===t.length?i:a(r||ge(t[n+1]).action);this._bindSingle(t[n],s,r,e,n)}})),ae(this,"_bindSingle",((e,t,n,r,a)=>{this._directMap[e+":"+n]=t;let i,s=(e=e.replace(/\s+/g," ")).split(" ");if(s.length>1)return void this._bindSequence(e,s,t,n);i=ge(e,n),this._callbacks[i.key]=this._callbacks[i.key]||[];const o={type:i.action,metaKey:!1,ctrlKey:!1};this._getMatches(i.key,i.modifiers,o,r,e,a);const l={callback:t,modifiers:i.modifiers,action:i.action,seq:r,level:a,combo:e};this._callbacks[i.key][r?"unshift":"push"](l)})),ae(this,"_bindMultiple",((e,t,n)=>{for(let r=0;r<e.length;++r)this._bindSingle(e[r],t,n)})),ae(this,"bind",((e,t,n)=>(e=e instanceof Array?e:[e],this._bindMultiple(e,t,n),self))),ae(this,"unbind",((e,t)=>this.bind(e,(function(){}),t))),ae(this,"bindGlobal",((e,t,n)=>{if(this.bind(e,t,n),e instanceof Array)for(let t=0;t<e.length;t++)this._globalCallbacks[e[t]]=!0;else this._globalCallbacks[e]=!0})),ae(this,"unbindGlobal",((e,t)=>{if(this.unbind(e,t),e instanceof Array)for(let t=0;t<e.length;t++)this._globalCallbacks[e[t]]=!1;else this._globalCallbacks[e]=!1})),ae(this,"trigger",((e,t)=>{let n=this;return n._directMap[e+":"+t]&&n._directMap[e+":"+t]({},e),n})),ae(this,"reset",(()=>(this._callbacks={},this._directMap={},this))),ae(this,"stopCallback",((e,t,n,r)=>{if(this._globalCallbacks[n]||r&&this._globalCallbacks[r])return!1;if((" "+t.className+" ").indexOf(" mousetrap ")>-1)return!1;if(he(t,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){let n=e.composedPath()[0];n!==e.target&&n instanceof HTMLElement&&(t=n)}return Boolean("INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||"isContentEditable"in t&&t.isContentEditable)})),ae(this,"handleKey",((...e)=>this._handleKey(...e))),ae(this,"addKeycodes",(e=>{for(let t in e)e.hasOwnProperty(t)&&(ie[t]=e[t]);ce=null})),this.target=e,this.target.addEventListener("keypress",(e=>{e instanceof KeyboardEvent&&this._handleKeyEvent(e)})),this.target.addEventListener("keydown",(e=>{e instanceof KeyboardEvent&&this._handleKeyEvent(e)})),this.target.addEventListener("keyup",(e=>{e instanceof KeyboardEvent&&this._handleKeyEvent(e)}))}}(document);class me{addBinding(e){ve.bind(e.key,(t=>{t.preventDefault(),t.stopPropagation(),t.returnValue=!1,e.onTrigger()}),"keydown"),this._binds.push(e)}removeAll(){this._binds.forEach((e=>{ve.unbind(e.key,e.type)})),this._binds=[]}constructor(){!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"_binds",[])}}var fe=n(4861),be=n(4011);function ye(e,t,n,r,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function Se(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){ye(i,r,a,s,o,"next",e)}function o(e){ye(i,r,a,s,o,"throw",e)}s(void 0)}))}}function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Oe=(0,$.getAppEvents)();function Ee(e){const t=(0,z.m0)(e);null==t||t.onZoom()}function xe(e,t){const n=(0,z.m0)(e);n&&("left"===t&&n.onMoveBackward(),"right"===t&&n.onMoveForward())}function Ce(e){const t=e.state.options;var n;null!=(n=t)&&"object"==typeof n&&"legend"in n&&"boolean"==typeof t.legend.showLegend&&e.onOptionsChange({legend:{showLegend:!t.legend.showLegend}})}class Le extends i.BusEventBase{}we(Le,"type","copy-time");class ke extends i.BusEventWithPayload{}function je(){return(je=Se((function*(){const e=yield navigator.clipboard.readText();let t;try{t=JSON.parse(e);const n=(0,be.OK)(t);if(n)return{isError:!1,range:n}}catch(e){}return{range:e,isError:!0}}))).apply(this,arguments)}function Pe(e,t,n,r,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function _e(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){Pe(i,r,a,s,o,"next",e)}function o(e){Pe(i,r,a,s,o,"throw",e)}s(void 0)}))}}function Te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}we(ke,"type","paste-time");const Fe="showLogsButtonScene";class De extends s.Bs{onActivate(){const e={};var t,n;this.setVariableTagValuesProviders(),s.jh.findByKeyAndType(this,Fe,re.H).setState({hidden:!1}),this.state.contentScene||(e.contentScene=(n=null===(t=this.state.routeMatch)||void 0===t?void 0:t.params.breakdownLabel,(0,D.FT)()===D.G3.explore?new N.yj({}):new c.Mn({drillDownLabel:n}))),this.setTagProviders(),this.setVariableOperators(),this.setState(e),this.updatePatterns(this.state,(0,B.Ku)(this)),this.resetVariablesIfNotInUrl((0,B.ir)(this),(0,B.n5)(o.mB)),this.resetVariablesIfNotInUrl((0,B.iw)(this),(0,B.n5)(o._Y)),this._subs.add(this.subscribeToState((e=>{this.updatePatterns(e,(0,B.Ku)(this))})));const r=s.jh.getTimeRange(this);this._subs.add(r.subscribeToState(this.limitMaxInterval(r))),this._subs.add(this.subscribeToEvent(ke,this.subscribeToPasteTimeEvent));const a=function(e){const t=new me;let n=null;const r=Oe.subscribe(i.SetPanelAttentionEvent,(e=>{"string"==typeof e.payload.panelId&&(n=e.payload.panelId)}));function a(e,t){return()=>{const r=s.jh.findObject(e,(e=>e.state.key===n&&e.isActive));r&&r instanceof s.Eb&&t(r)}}return t.addBinding({key:"p l",onTrigger:a(e,Ce)}),t.addBinding({key:"a l",onTrigger:function(e,t){return()=>{s.jh.findAllObjects(e,(e=>e instanceof s.Eb&&e.isActive)).forEach((e=>{e&&e instanceof s.Eb&&t(e)}))}}(e,Ce)}),t.addBinding({key:"p x",onTrigger:a(e,function(){var e=Se((function*(e){const t=(0,fe.iD)(e);t&&$.locationService.push(t)}));return function(t){return e.apply(this,arguments)}}())}),t.addBinding({key:"t c",onTrigger:()=>{var t;t=s.jh.getTimeRange(e),window.__grafanaSceneContext,window.__grafanaSceneContext=t,Oe.publish(new Le)}}),t.addBinding({key:"t v",onTrigger:()=>{const t=new ke({updateUrl:!1});e.publishEvent(t),Oe.publish(t)}}),t.addBinding({key:"d r",onTrigger:()=>s.jh.getTimeRange(e).onRefresh()}),t.addBinding({key:"t z",onTrigger:()=>{Ee(e)}}),t.addBinding({key:"ctrl+z",onTrigger:()=>{Ee(e)}}),t.addBinding({key:"t a",onTrigger:()=>{const t=(0,z.m0)(e);null==t||t.toAbsolute()}}),t.addBinding({key:"t left",onTrigger:()=>{xe(e,"left")}}),t.addBinding({key:"t right",onTrigger:()=>{xe(e,"right")}}),()=>{t.removeAll(),r.unsubscribe()}}(this);return()=>{a()}}setVariableOperators(){const e=(0,B.ir)(this);e._getOperators=function(){return e.state.filters.some((e=>Ae.includes(e.operator)))?[...Ne,...Ie]:Ne}}setTagProviders(){const e=(0,B.cR)(this);e._getOperators=function(){const t=e.state._wip;return t&&e.state.filters.some((e=>e.key===t.key&&e.operator===G.w.Equal))?$e:Ne},e.setState({getTagKeysProvider:te,getTagValuesProvider:K})}limitMaxInterval(e){return(t,n)=>{const{jsonData:r}=W.plugin.meta;if(null==r?void 0:r.interval)try{var a;const o=i.rangeUtil.intervalToSeconds(null!==(a=null==r?void 0:r.interval)&&void 0!==a?a:"");if(!o)return;const l=t.value.to.diff(t.value.from,"seconds");if(l>o){if(l<=n.value.to.diff(n.value.from,"seconds"))e.setState({value:n.value,from:n.from,to:n.to});else{const t=new s.JZ(V.sp);e.setState({value:t.state.value,from:t.state.from,to:t.state.to})}(0,$.getAppEvents)().publish({type:i.AppEvents.alertWarning.name,payload:["Time range interval exceeds maximum interval configured by the administrator."]}),(0,f.EE)("all","interval_too_long",{attempted_duration_seconds:l,configured_max_interval:o})}}catch(e){console.error(e)}}}setVariableTagValuesProviders(){const e=(0,B.ir)(this),t=(0,B.iw)(this),n=(0,B.oY)(this);e.setState({getTagValuesProvider:this.getFieldsTagValuesProvider(o.mB)}),t.setState({getTagValuesProvider:this.getFieldsTagValuesProvider(o._Y)}),n.setState({getTagValuesProvider:this.getFieldsTagValuesProvider(o._P)})}getFieldsTagValuesProvider(e){return(t,n)=>{const r=t.state.filters.filter((e=>e.key!==n.key)).map((t=>{const n=e===o.mB?(0,B.bu)(t,e):{value:t.value};return`${t.key}${t.operator}\`${(0,X.ZD)(n.value)}\``})),a=r.length?"| "+r.join(" |"):"",i=this.getFieldsTagValuesExpression(e).replace(o.Gd,a),l=s.jh.interpolate(this,i);return J(n,l,this,s.jh.getTimeRange(this).state.value,e)}}getFieldsTagValuesExpression(e){switch(e){case o.mB:return o.Do;case o._P:return o.mz;case o._Y:return o.Sy;default:const t=new Error(`Unknown variable type: ${e}`);throw H.v.error(t,{variableType:e,msg:`getFieldsTagValuesExpression: Unknown variable type: ${e}`}),t}}resetVariablesIfNotInUrl(e,t){const n=$.locationService.getLocation();null===new URLSearchParams(n.search).get(t)&&e.setState({filters:[]})}updatePatterns(e,t){var n;const r=(0,A.M3)(null!==(n=e.patterns)&&void 0!==n?n:[]);t.changeValueTo(r)}getUrlState(){return{patterns:JSON.stringify(this.state.patterns)}}updateFromUrl(e){const t={};e.patterns&&"string"==typeof e.patterns&&(t.patterns=JSON.parse(e.patterns)),this.setState(t)}constructor(e){var t,n;const{variablesScene:r,unsub:a}=function(e,t){const n=new s.H9({name:o.MB,datasource:o.eL,layout:"combobox",label:"Labels",filters:null!=t?t:[],expressionBuilder:A.VW,hide:I.zL.dontHide,key:"adhoc_service_filter"});n._getOperators=function(){return Ne};const r=new s.H9({name:o.mB,label:"Fields",applyMode:"manual",layout:"vertical",getTagKeysProvider:()=>Promise.resolve({replace:!0,values:[]}),getTagValuesProvider:()=>Promise.resolve({replace:!0,values:[]}),expressionBuilder:A.ZX,hide:I.zL.hideLabel});r._getOperators=()=>Ne;const a=new s.H9({name:o._P,label:"Metadata",applyMode:"manual",layout:"vertical",getTagKeysProvider:()=>Promise.resolve({replace:!0,values:[]}),getTagValuesProvider:()=>Promise.resolve({replace:!0,values:[]}),expressionBuilder:A.E3,hide:I.zL.hideLabel});a._getOperators=()=>Ne;const i=new s.H9({name:o._Y,label:"Filters",applyMode:"manual",layout:"vertical",getTagKeysProvider:()=>Promise.resolve({replace:!0,values:[]}),getTagValuesProvider:()=>Promise.resolve({replace:!0,values:[]}),expressionBuilder:A.E3,hide:I.zL.hideLabel});i._getOperators=()=>Ne;const c=new s.mI({name:o.EY,label:"Data source",value:e,pluginId:"loki"}),d=c.subscribeToState((e=>{const t=`${e.value}`;e.value&&(0,l.ke)(t)}));return{variablesScene:new s.Pj({variables:[c,n,r,i,a,new s.yP({name:o.uw,value:"",hide:I.zL.hideVariable}),new s.yP({name:o.WM,value:"",hide:I.zL.hideVariable}),new M.m({name:o.QE,value:o.YN,skipUrlSync:!0,hide:I.zL.hideVariable,options:[{value:o.YN,label:o.YN}]})]}),unsub:d}}(null!==(n=(0,l.QB)())&&void 0!==n?n:"grafanacloud-logs",e.initialFilters),c=[new s.G1({direction:"row",children:[new s.vA({body:new j({layout:"vertical",include:[o.MB,o.EY]})}),new re.H({key:Fe,disabled:!0})]}),new j({layout:"vertical",exclude:[o.MB,o.EY]}),new s.KE({}),new s.WM({})];var d,u,p,g,h;"explore"===(0,D.FT)()&&$.config.featureToggles.exploreLogsAggregatedMetrics&&c.push(new R.s({isOpen:!1})),super((g=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Te(e,t,n[t])}))}return e}({$timeRange:null!==(d=e.$timeRange)&&void 0!==d?d:new s.JZ({}),$variables:null!==(u=e.$variables)&&void 0!==u?u:r,controls:null!==(p=e.controls)&&void 0!==p?p:c,patterns:[]},e),h=null!=(h={body:new T({})})?h:{},Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(h)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(h)).forEach((function(e){Object.defineProperty(g,e,Object.getOwnPropertyDescriptor(h,e))})),g)),t=this,Te(this,"_urlSync",new s.So(this,{keys:["patterns"]})),Te(this,"subscribeToPasteTimeEvent",_e((function*(){const e=yield function(){return je.apply(this,arguments)}();if(e.isError)return;const n=s.jh.getTimeRange(t),r="string"==typeof e.range.to?e.range.to:void 0,a="string"==typeof e.range.from?e.range.from:void 0,o=i.rangeUtil.convertRawToRange(e.range);n&&o?n.setState({value:o,to:r,from:a}):H.v.error(new Error("Invalid time range from clipboard"),{msg:"Invalid time range from clipboard",sceneTimeRange:typeof n,to:null!=r?r:"",from:null!=a?a:""})}))),this._subs.add(a),this.addActivationHandler(this.onActivate.bind(this)),(0,z.hJ)(this).then((e=>{this.setState({ds:e})}))}}Te(De,"Component",(({model:e})=>{const{body:t}=e.useState();return t?a().createElement(t.Component,{model:t}):a().createElement(d.LoadingPlaceholder,{text:"Loading..."})}));const Ne=[G.w.Equal,G.w.NotEqual].map((e=>({label:e,value:e}))),$e=[G.w.Equal].map((e=>({label:e,value:e}))),Ae=[G.w.gt,G.w.gte,G.w.lt,G.w.lte],Ie=Ae.map((e=>({label:e,value:e})))},6059:(e,t,n)=>{n.d(t,{H:()=>g});var r=n(7141),a=n(2007),i=n(5959),s=n.n(i),o=n(6089),l=n(8835),c=n(4750),d=n(4793),u=n(1220);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends r.Bs{onActivate(){const e=(0,c.cR)(this),t=e.state.filters.some((e=>e.operator===d.w.Equal));this.setState({disabled:!t}),e.subscribeToState((e=>{const t=e.filters.some((e=>e.operator===d.w.Equal));this.setState({disabled:!t})}))}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){p(e,t,n[t])}))}return e}({},e)),p(this,"onClick",(()=>{const e=(0,c.cR)(this).state.filters.find((e=>e.operator===d.w.Equal));e&&(0,l.jY)(e.key,e.value)})),this.addActivationHandler(this.onActivate.bind(this))}}function h(e){return{button:(0,o.css)({[e.breakpoints.down("lg")]:{alignSelf:"flex-end"},[e.breakpoints.down("md")]:{marginTop:e.spacing(1),alignSelf:"flex-start"},alignSelf:"flex-start",marginTop:"22px"})}}p(g,"Component",(({model:e})=>{const{disabled:t,hidden:n}=e.useState(),r=(0,a.useStyles2)(h);return!0===n?null:s().createElement(a.Button,{"data-testid":u.b.index.header.showLogsButton,disabled:t,fill:"outline",className:r.button,onClick:e.onClick},"Show logs")}))},4002:(e,t,n)=>{n.d(t,{s:()=>v});var r=n(7141),a=n(2007),i=n(5959),s=n.n(i),o=n(6089),l=n(8531),c=n(2718),d=n(6939),u=n(2533),p=n(1220);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h=`${u.id}.serviceSelection.aggregatedMetrics`;class v extends r.Bs{constructor(e){const t=localStorage.getItem(h),n=l.config.featureToggles.exploreLogsAggregatedMetrics&&"false"!==t;var r;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){g(e,t,n[t])}))}return e}({isOpen:!1,options:{aggregatedMetrics:{active:null!=n&&n,userOverride:null!==(r="true"===t)&&void 0!==r&&r,disabled:!1}}},e)),g(this,"toggleAggregatedMetricsOverride",(()=>{const e=!this.state.options.aggregatedMetrics.active;(0,c.EE)(c.NO.service_selection,c.ir.service_selection.aggregated_metrics_toggled,{enabled:e}),localStorage.setItem(h,e.toString()),this.setState({options:{aggregatedMetrics:{active:e,disabled:this.state.options.aggregatedMetrics.disabled,userOverride:e}}})})),g(this,"onToggleOpen",(e=>{this.setState({isOpen:e})}))}}function m(e){return{popover:(0,o.css)({display:"flex",padding:e.spacing(2),flexDirection:"column",background:e.colors.background.primary,boxShadow:e.shadows.z3,borderRadius:e.shape.radius.default,border:`1px solid ${e.colors.border.weak}`,zIndex:1,marginRight:e.spacing(2)}),heading:(0,o.css)({fontWeight:e.typography.fontWeightMedium,paddingBottom:e.spacing(2)}),options:(0,o.css)({display:"grid",gridTemplateColumns:"1fr 50px",rowGap:e.spacing(1),columnGap:e.spacing(2),alignItems:"center"})}}g(v,"Component",(({model:e})=>{const{isOpen:t,options:n}=e.useState(),r=(0,a.useStyles2)(m);return n.aggregatedMetrics?s().createElement(a.Dropdown,{overlay:()=>s().createElement("div",{className:r.popover,onClick:e=>e.stopPropagation()},s().createElement("div",{className:r.heading},"Query options"),s().createElement("div",{className:r.options},s().createElement("div",{title:"Aggregated metrics will return service queries results much more quickly, but with lower resolution"},"Aggregated metrics"),s().createElement("span",{title:n.aggregatedMetrics.disabled?`Aggregated metrics can only be enabled for queries starting after ${d.XU.toLocaleString()}`:""},s().createElement(a.Switch,{label:"Toggle aggregated metrics","data-testid":p.b.index.aggregatedMetricsToggle,value:n.aggregatedMetrics.active,disabled:n.aggregatedMetrics.disabled,onChange:e.toggleAggregatedMetricsOverride})))),placement:"bottom",onVisibleChange:e.onToggleOpen},s().createElement(a.ToolbarButton,{icon:"cog",variant:"canvas",isOpen:t,"data-testid":p.b.index.aggregatedMetricsMenu})):s().createElement(s().Fragment,null)}))},4106:(e,t,n)=>{n.d(t,{Oo:()=>h,c:()=>g,sp:()=>u});var r=n(7141),a=n(892),i=n(7781),s=n(4235),o=n(8835),l=n(2871),c=n(8315),d=n(8831);const u={from:"now-15m",to:"now"};function p(e){return new r.P1({body:new s.PR({$timeRange:new r.JZ(u),routeMatch:e})})}function g(){return new r.jD({title:"Logs",url:(0,d._F)(a.G3.explore),layout:i.PageLayoutType.Custom,preserveUrlKeys:a.Zt,routePath:(0,d._F)(a.G3.explore),getScene:e=>p(e),drilldowns:[{routePath:a.HU.logs,getPage:(e,t)=>v(e,t,a.G3.logs),defaultRoute:!0},{routePath:a.HU.labels,getPage:(e,t)=>v(e,t,a.G3.labels)},{routePath:a.HU.patterns,getPage:(e,t)=>v(e,t,a.G3.patterns)},{routePath:a.HU.fields,getPage:(e,t)=>v(e,t,a.G3.fields)},{routePath:a.KL.label,getPage:(e,t)=>m(e,t,a._J.label)},{routePath:a.KL.field,getPage:(e,t)=>m(e,t,a._J.field)},{routePath:"*",getPage:()=>h()}]})}function h(){return new r.jD({title:"",url:d.Gy,getScene:()=>new r.P1({body:new r.G1({direction:"column",children:[]})}),hideFromBreadcrumbs:!0,routePath:"*",$behaviors:[()=>{(0,o.Ns)()}]})}function v(e,t,n){const{labelName:s,labelValue:o}=(0,a.XJ)(e);return new r.jD({title:(0,c.Zr)(n),layout:i.PageLayoutType.Custom,url:a.bw[n](o,s),preserveUrlKeys:a.tm,getParentPage:()=>t,getScene:e=>p(e)})}function m(e,t,n){const{labelName:s,labelValue:o,breakdownLabel:d}=(0,a.XJ)(e);if(!d){const e=new Error("Breakdown value missing!");throw l.v.error(e,{msg:"makeBreakdownValuePage: Breakdown value missing!",labelName:s,labelValue:o,breakdownLabel:null!=d?d:""}),e}return new r.jD({title:(0,c.Zr)(d),layout:i.PageLayoutType.Custom,url:a.mC[n](o,s,d),preserveUrlKeys:a.tm,getParentPage:()=>t,getScene:e=>p(e)})}},4861:(e,t,n)=>{n.d(t,{ls:()=>T,Ci:()=>F,GD:()=>D,iD:()=>N,K_:()=>B});var r=n(7141),a=n(5959),i=n.n(a),s=n(7781),o=n(8531),l=n(2007),c=n(9829),d=(n(1220),n(2718)),u=n(227),p=n(4011);var g=n(4235),h=n(2871),v=n(7608);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){m(e,t,n[t])}))}return e}function b(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class y extends r.Bs{constructor(e){super(b(f({},e),{queries:[]})),m(this,"onActivate",(()=>{(0,c.hJ)(this).then((e=>{this.setState({ds:e})})),this._subs.add(this.subscribeToState(((e,t)=>{this.state.queries.length||this.getQueries(),!this.state.context&&this.state.queries.length&&this.getContext()})))})),m(this,"getQueries",(()=>{const e=r.jh.getData(this),t=(0,c.UX)(e,(e=>e instanceof r.dt),r.dt);if(t){const e=this.state.frame?S(this.state.frame):null,n=t.state.queries.map((n=>{var a;return b(f({},n),{expr:r.jh.interpolate(t,n.expr),legendFormat:(null==e?void 0:e.name)?`{{ ${e.name} }}`:r.jh.interpolate(t,n.legendFormat),datasource:null!==(a=n.datasource)&&void 0!==a?a:void 0})}));JSON.stringify(n)!==JSON.stringify(this.state.queries)&&this.setState({queries:n})}})),m(this,"getContext",(()=>{const{queries:e,ds:t,labelName:n,fieldName:a}=this.state,i=r.jh.getTimeRange(this);if(!i||!e||!(null==t?void 0:t.uid))return;const s={origin:"Explore Logs",type:"timeseries",queries:e,timeRange:f({},i.state.value),datasource:{uid:t.uid},url:window.location.href,id:`${JSON.stringify(e)}${n}${a}`,title:`${n}${a?` > ${a}`:""}`,logoPath:"public/plugins/grafana-lokiexplore-app/img/3d96a93cfcb32df74eef.svg",drillDownLabel:a};JSON.stringify(s)!==JSON.stringify(this.state.context)&&this.setState({context:s})})),this.addActivationHandler(this.onActivate)}}m(y,"Component",(({model:e})=>{const{context:t}=e.useState(),{links:n}=(0,o.usePluginLinks)({extensionPointId:v.R6.MetricExploration,context:t});return i().createElement(i().Fragment,null,n.filter((e=>"grafana-explorations-app"===e.pluginId&&e.onClick)).map((e=>{var t;return i().createElement(l.IconButton,{tooltip:e.description,"aria-label":"extension-link-to-open-exploration",key:e.id,name:null!==(t=e.icon)&&void 0!==t?t:"panel-add",onClick:t=>{e.onClick&&e.onClick(t)}})})))}));const S=e=>{var t,n;const r=null!==(n=null===(t=e.fields[1])||void 0===t?void 0:t.labels)&&void 0!==n?n:{};if(1!==Object.keys(r).length)return;const a=Object.keys(r)[0];return{name:a,value:r[a]}};var w=n(5183),O=n(3102),E=n(8516),x=n(4836),C=n(3630),L=n(6089);function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const j="Add to investigation",P="investigations_divider",_="Investigations";var T=function(e){return e.timeseries="timeseries",e.histogram="histogram",e}({}),F=function(e){return e.collapsed="Collapse",e.expanded="Expand",e}({});class D extends r.Bs{addItem(e){this.state.body&&this.state.body.addItem(e)}setItems(e){this.state.body&&this.state.body.setItems(e)}constructor(e){var t,n,a;super((n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){k(e,t,n[t])}))}return e}({},e),a=null!=(a={addExplorationsLink:null===(t=e.addExplorationsLink)||void 0===t||t})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(a)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))})),n)),this.addActivationHandler((()=>{var e;const t=[{text:"Navigation",type:"group"},{text:"Explore",iconClassName:"compass",href:N(this),onClick:()=>$(),shortcut:"p x"}];let n;try{n=r.jh.getAncestor(this,r.Eb)}catch(e){return void this.setState({body:new r.Lw({items:t})})}var a;this.setState({explorationsButton:new y({labelName:this.state.labelName,fieldName:this.state.fieldName,frame:this.state.frame})}),this.state.addExplorationsLink&&(null===(a=this.state.explorationsButton)||void 0===a||a.activate()),(this.state.panelType||(null==n?void 0:n.state.collapsible))&&function(e){e.push({text:"",type:"divider"}),e.push({text:"Visualization",type:"group"})}(t),(null==n?void 0:n.state.collapsible)&&function(e,t){const n=r.jh.getAncestor(t,r.Eb);e.push({text:n.state.collapsed?"Expand":"Collapse",iconClassName:n.state.collapsed?"table-collapse-all":"table-expand-all",onClick:()=>{const e=n.state.collapsed?"Expand":"Collapse",a=r.jh.getAncestor(t,r.G1);(0,E.Zb)(a,e),n.setState({collapsed:!n.state.collapsed}),(0,u.IW)("collapsed",e)}})}(t,this),this.state.panelType&&function(e,t){e.push({text:"histogram"!==t.state.panelType?"Histogram":"Time series",iconClassName:"histogram"!==t.state.panelType?"graph-bar":"chart-line",onClick:()=>{const e=r.jh.getAncestor(t,r.xK),n=r.jh.getAncestor(t,r.Eb).clone(),a=r.jh.getData(t).clone(),i=t.clone(),s=Array.isArray(n.state.headerActions)?n.state.headerActions.map((e=>e.clone())):n.state.headerActions;let o;o="histogram"!==t.state.panelType?r.d0.timeseries().setOverrides(w.jC):r.d0.histogram(),e.setState({body:o.setMenu(i).setTitle(n.state.title).setHeaderActions(s).setData(a).build()});const l="timeseries"!==t.state.panelType?"timeseries":"histogram";(0,u.IW)("panelType",l),i.setState({panelType:l});const d=(0,c.UX)(e,(e=>e instanceof O.E),O.E);d&&d.rebuildAvgFields(),A(l)}})}(t,this),this.setState({body:new r.Lw({items:t})}),this._subs.add(null===(e=this.state.explorationsButton)||void 0===e?void 0:e.subscribeToState((()=>{!function(e){const t=e.state.explorationsButton;if(t){var n;const l=I(t);var r;const c=null!==(r=null===(n=e.state.body)||void 0===n?void 0:n.state.items)&&void 0!==r?r:[],d=c.find((e=>e.text===j));var a,i,s,o;l&&(d?d&&(null===(a=e.state.body)||void 0===a||a.setItems(c.filter((e=>!1===[P,_,j].includes(e.text))))):(null===(i=e.state.body)||void 0===i||i.addItem({text:P,type:"divider"}),null===(s=e.state.body)||void 0===s||s.addItem({text:_,type:"group"}),null===(o=e.state.body)||void 0===o||o.addItem({text:j,iconClassName:"plus-square",onClick:e=>M(e,t)})))}}(this)})))}))}}k(D,"Component",(({model:e})=>{const{body:t}=e.useState();return t?i().createElement(t.Component,{model:t}):i().createElement(i().Fragment,null)}));const N=e=>{const t=r.jh.getAncestor(e,g.PR),n=r.jh.getData(e);let a=n instanceof r.dt?n:(0,c.oh)(n)[0];if(!a){const t=r.jh.findObject(e,(e=>e instanceof x.u||e instanceof C.u));if(t){const e=r.jh.getData(t);a=e instanceof r.dt?e:(0,c.oh)(e)[0]}else h.v.error(new Error("Unable to locate query runner!"),{msg:"PanelMenu - getExploreLink: Unable to locate query runner!"})}const i=a.state.queries[0].expr;return((e,t,n=!1)=>{t||(t=(0,c.u9)(e)),t=t.replace(/\s+/g," ").trimEnd();const a=(0,c.U4)(e),i=r.jh.getTimeRange(e).state.value,l=(0,u.N$)(e),d=(0,u.k5)(),g=function(){const e=new URLSearchParams(window.location.search).get("urlColumns");if(e)try{const t=(0,p.aJ)(JSON.parse(e));let n={};for(const e in t)n[e]=t[e];return n}catch(e){console.error(e)}}(),h=JSON.stringify({"loki-explore":{range:(0,s.toURLRange)(i.raw),queries:[{refId:"logs",expr:t,datasource:a}],panelsState:{logs:{displayedFields:l,visualisationType:d,columns:g}},datasource:a}});var v;const m=null!==(v=o.config.appSubUrl)&&void 0!==v?v:"",f=s.urlUtil.renderUrl(`${m}/explore`,{panes:h,schemaVersion:1});return n&&window.open(f,"_blank"),f})(t,r.jh.interpolate(e,i))},$=()=>{(0,d.EE)(d.NO.all,d.ir.all.open_in_explore_menu_clicked)},A=e=>{(0,d.EE)(d.NO.service_details,d.ir.service_details.change_viz_type,{newVizType:e})},I=e=>(0,o.getPluginLinkExtensions)({extensionPointId:v.R6.MetricExploration,context:e.state.context}).extensions[0],M=(e,t)=>{const n=I(t);n&&n.onClick&&n.onClick(e)},B=e=>({panelWrapper:(0,L.css)({width:"100%",height:"100%",label:"panel-wrapper",position:"absolute",display:"flex","button.show-on-hover":{opacity:1,visibility:"visible",background:"none","&:hover":{background:e.colors.secondary.shade}}})})},558:(e,t,n)=>{n.d(t,{Of:()=>f,PT:()=>C,Qt:()=>x,VT:()=>O,XI:()=>y,hi:()=>S,oR:()=>j,ts:()=>L,vn:()=>E});var r=n(5959),a=n.n(r),i=n(7781),s=n(7141),o=n(5435),l=n(2718),c=n(3143),d=n(5218),u=n(1766),p=n(7097),g=n(4750),h=n(4793),v=n(9055);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class f extends i.BusEventBase{constructor(e,t,n){super(),m(this,"operator",void 0),m(this,"key",void 0),m(this,"value",void 0),this.operator=e,this.key=t,this.value=n}}m(f,"type","add-filter");class b extends i.BusEventBase{constructor(e,t,n){super(),m(this,"key",void 0),m(this,"value",void 0),m(this,"operator",void 0),this.key=e,this.value=t,this.operator=n}}function y(e,t,n){const r="="===e.operator?"include":"exclude";x(e.key,e.value,r,t,n)}function S(e,t,n,r,a){n||(n=k(e,t));const i=(0,g.bY)(L(e,n),t);let s=i.state.filters.filter((t=>{const n=(0,g.z2)(i,t);return r&&a?!(t.key===e&&n.value===r&&t.operator===a):r?!(t.key===e&&n.value===r):a?!(t.key===e&&t.operator===a):!(t.key===e)}));t.publishEvent(new b(e,r,a),!0),i.setState({filters:s})}m(b,"type","add-filter");const w=e=>e===h.w.gt||e===h.w.gte?"greater":e===h.w.lt||e===h.w.lte?"lesser":void 0;function O(e,t,n,r){r||(r=k(e,t));const a=(0,g.bY)(L(e,r),t),i=n?w(n):void 0;let s=a.state.filters.filter((t=>!(t.key===e&&(w(t.operator)===i||t.operator===h.w.NotEqual))));a.setState({filters:s})}function E(e,t,n,r,a){const i=w(n);a||(a=k(e,r));const s=(0,g.bY)(L(e,a),r);let o;a===c.mB&&(o=JSON.stringify({value:t,parser:(0,p.Ri)(e,r)}));let l=s.state.filters.filter((t=>!(t.key===e&&(w(t.operator)===i||t.operator===h.w.NotEqual))));l=[...l,{key:e,operator:n,value:o||t,valueLabels:[t]}],r.publishEvent(new f(n,e,t),!0),s.setState({filters:l})}function x(e,t,n,r,a){a||(a=k(e,r)),a===c.MB&&(0,v._J)(e,t,r);const i=(0,g.bY)(L(e,a),r);let s;a===c.mB&&(s=JSON.stringify({value:t,parser:(0,p.Ri)(e,r)}));let o=i.state.filters.filter((r=>{const a=(0,g.z2)(i,r);return"include"===n?!(r.key===e&&r.operator!==h.w.Equal):!(r.key===e&&a.value===t)}));const l=o.length!==i.state.filters.length;("include"===n||"exclude"===n||!l&&"toggle"===n)&&(o=[...o,{key:e,operator:"exclude"===n?h.w.NotEqual:h.w.Equal,value:s||t,valueLabels:[t]}]),r.publishEvent(new f(n,e,t),!0),i.setState({filters:o})}function C(e,t,n,r){(0,g.bY)(L(e,k(e,r)),r).setState({filters:[{key:e,operator:"exclude"===n?h.w.NotEqual:h.w.Equal,value:t}],hide:o.zL.hideLabel})}function L(e,t){return e===c.e4?c._Y:t}function k(e,t){var n,r;return(null===(r=(0,u.TG)(t))||void 0===r||null===(n=r.fields)||void 0===n?void 0:n.find((t=>t.name===e)))?c.MB:c.mB}class j extends s.Bs{constructor(...e){super(...e),m(this,"onClick",(e=>{const t=P(this.state.frame);if(!t)return;x(t.name,t.value,e,this,this.state.variableName);const n=(0,g.bY)(L(t.name,this.state.variableName),this);(0,l.EE)(l.NO.service_details,l.ir.service_details.add_to_filters_in_breakdown_clicked,{filterType:this.state.variableName,key:t.name,action:e,filtersLength:(null==n?void 0:n.state.filters.length)||0})})),m(this,"isSelected",(()=>{const e=P(this.state.frame);if(!e)return{isIncluded:!1,isExcluded:!1};const t=(0,g.bY)(L(e.name,this.state.variableName),this),n=t.state.filters.find((n=>{const r=(0,g.z2)(t,n);return n.key===e.name&&r.value===e.value}));return n?{isIncluded:n.operator===h.w.Equal,isExcluded:n.operator===h.w.NotEqual}:{isIncluded:!1,isExcluded:!1}}))}}m(j,"Component",(({model:e})=>{const{isIncluded:t,isExcluded:n}=e.isSelected();return a().createElement(d.F,{buttonFill:"outline",isIncluded:t,isExcluded:n,onInclude:()=>e.onClick("include"),onClear:()=>e.onClick("clear"),onExclude:()=>e.onClick("exclude")})}));const P=e=>{var t,n;const r=null!==(n=null===(t=e.fields[1])||void 0===t?void 0:t.labels)&&void 0!==n?n:{};if(1!==Object.keys(r).length)return;const a=Object.keys(r)[0];return{name:a,value:r[a]}}},1022:(e,t,n)=>{n.d(t,{G:()=>v,x:()=>g});var r=n(7141),a=n(5959),i=n.n(a),s=n(5631),o=n(6261),l=n(8810),c=n(4105),d=n(7781),u=n(2871);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends d.BusEventBase{}p(g,"type","breakdown-search-reset");const h={};class v extends r.Bs{filterValues(e){const t=r.jh.findObject(this,(e=>e instanceof l.O||e instanceof c.J6));if(t instanceof l.O||t instanceof c.J6){h[this.cacheKey]=e;const n=r.jh.findDescendents(t,s.h);null==n||n.forEach((t=>{t.state.body.isActive&&t.filterByString(e)}))}else u.v.warn("unable to find Breakdown scene",{typeofBody:typeof t,filter:e})}constructor(e){var t;super({filter:null!==(t=h[e])&&void 0!==t?t:""}),p(this,"cacheKey",void 0),p(this,"onValueFilterChange",(e=>{this.setState({filter:e.target.value}),this.filterValues(e.target.value)})),p(this,"clearValueFilter",(()=>{this.setState({filter:""}),this.filterValues("")})),p(this,"reset",(()=>{this.setState({filter:""}),h[this.cacheKey]=""})),this.cacheKey=e}}p(v,"Component",(({model:e})=>{const{filter:t}=e.useState();return i().createElement(o.D,{value:t,onChange:e.onValueFilterChange,onClear:e.clearValueFilter,placeholder:"Search for value"})}))},5631:(e,t,n)=>{n.d(t,{h:()=>b});var r=n(5959),a=n.n(r),i=n(7781),s=n(7141),o=n(5722),l=n(4932),c=n(4144),d=n(2007),u=n(6089),p=n(1022),g=n(1269),h=n(738),v=n(8516),m=n(2871);function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class b extends s.Bs{performRepeat(e){const t=[],n=(0,o.sortSeries)(e.series,this.sortBy,this.direction);for(let e=0;e<n.length;e++){const r=this.state.getLayoutChild(n[e],e);t.push(r)}this.sortedSeries=n,this.unfilteredChildren=t,this.getFilter()?(this.state.body.setState({children:[]}),this.filterByString(this.getFilter())):this.state.body.setState({children:t})}filterSummaryChart(e){const t=s.jh.getAncestor(this,h.U);if(t){const n=s.jh.findAllObjects(t,(e=>e.isActive&&e.state.key===v.s$));if(n[0]instanceof s.G1){const t=s.jh.findDescendents(n[0],s.Eb)[0];t instanceof s.Eb?t.setState({$data:new s.Es({transformations:[()=>{return t=e[0],e=>e.pipe((0,g.map)((e=>{if(!t||!t.length)return e;let n=[];return e.forEach((e=>{const r=(0,c.ee)(e);t.includes(r)&&n.push(e)})),n})));var t}]})}):m.v.warn("filterSummaryChart: VizPanel not found",{typeofPanel:typeof t})}else m.v.warn("filterSummaryChart: SceneFlexItem not found",{typeofGraphParent:typeof n})}}constructor(e){var{sortBy:t,direction:n,getFilter:r}=e;super(function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(e,["sortBy","direction","getFilter"])),f(this,"unfilteredChildren",[]),f(this,"sortBy",void 0),f(this,"direction",void 0),f(this,"sortedSeries",[]),f(this,"getFilter",void 0),f(this,"sort",((e,t)=>{const n=s.jh.getData(this);this.sortBy=e,this.direction=t,n.state.data&&this.performRepeat(n.state.data)})),f(this,"iterateFrames",(e=>{if(s.jh.getData(this).state.data)for(let t=0;t<this.sortedSeries.length;t++)e(this.sortedSeries,t)})),f(this,"filterByString",(e=>{let t=[];this.iterateFrames(((e,n)=>{const r=(0,c.ee)(e[n]);t.push(r)})),(0,l.X)(t,e,(e=>{e&&e[0]?this.filterFrames((t=>{const n=(0,c.ee)(t);return e[0].includes(n)})):this.filterFrames((()=>!0)),this.filterSummaryChart(e)}))})),f(this,"filterFrames",(e=>{const t=[];if(this.iterateFrames(((n,r)=>{e(n[r])&&t.push(this.unfilteredChildren[r])})),0===t.length){const e=this.getFilter();this.state.body.setState({children:[y(e,this.clearFilter)]})}else this.state.body.setState({children:t})})),f(this,"clearFilter",(()=>{this.publishEvent(new p.x,!0)})),this.sortBy=t,this.direction=n,this.getFilter=r,this.addActivationHandler((()=>{const e=s.jh.getData(this);this._subs.add(e.subscribeToState(((e,t)=>{var n,r,a,s;((null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Done||(null===(r=e.data)||void 0===r?void 0:r.state)===i.LoadingState.Streaming&&e.data.series.length>(null!==(s=null===(a=t.data)||void 0===a?void 0:a.series.length)&&void 0!==s?s:0))&&this.performRepeat(e.data)}))),e.state.data&&this.performRepeat(e.state.data)}))}}function y(e,t){return new s.G1({direction:"row",children:[new s.vA({body:new s.dM({reactNode:a().createElement("div",{className:S.alertContainer},a().createElement(d.Alert,{title:"",severity:"info",className:S.noResultsAlert},"No values found matching “",e,"”",a().createElement(d.Button,{className:S.clearButton,onClick:t},"Clear filter")))})})]})}f(b,"Component",(({model:e})=>{const{body:t}=e.useState();return a().createElement(t.Component,{model:t})}));const S={alertContainer:(0,u.css)({flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"}),noResultsAlert:(0,u.css)({minWidth:"30vw",flexGrow:0}),clearButton:(0,u.css)({marginLeft:"1.5rem"})}},3782:(e,t,n)=>{n.d(t,{a:()=>c});var r=n(7141),a=n(4482),i=n(2007),s=n(5959),o=n.n(s),l=n(4105);class c extends r.Bs{static Component({model:e}){const{type:t}=e.useState();return o().createElement(a.R,null,o().createElement(i.Alert,{title:"",severity:"warning"},"We did not find any ",t," for the given timerange. Please"," ",o().createElement("a",{className:l.ZI.link,href:"https://forms.gle/1sYWCTPvD72T1dPH9",target:"_blank",rel:"noopener noreferrer"},"let us know")," ","if you think this is a mistake."))}}},4462:(e,t,n)=>{n.d(t,{f:()=>u,u:()=>d});var r=n(6089),a=n(5959),i=n.n(a),s=n(2007),o=n(1220),l=n(7918);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d({options:e,value:t,onChange:n,label:r}){const o=(0,s.useStyles2)(p),[l,c]=(0,a.useState)(!1),d=e.map((e=>({label:e.label,value:e.value})));return i().createElement(s.InlineField,{className:o.selectWrapper,label:r},i().createElement(s.Select,{options:d,value:t,onOpenMenu:()=>c(!0),onCloseMenu:()=>c(!1),onChange:e=>n(e.value),className:o.select,prefix:l?void 0:i().createElement(s.Icon,{name:"search"})}))}function u({options:e,value:t,onChange:n,label:r,selectOption:d,isLoading:u,initialFilter:g}){var h;const v=(0,s.useStyles2)(p),[m,f]=(0,a.useState)(!1),[b,y]=(0,a.useState)(g),S=e.map((e=>({label:e.label,value:e.value}))),w=b&&t&&(null===(h=b.value)||void 0===h?void 0:h.includes(t))?[b,...S]:S,O=null==w?void 0:w.find((e=>e.value===t));return i().createElement(s.InlineField,{className:v.serviceSceneSelectWrapper,label:r},i().createElement(s.Select,{isLoading:u,"data-testid":o.b.exploreServiceSearch.search,placeholder:"Search values",options:w,isClearable:!0,value:t,onOpenMenu:()=>f(!0),onCloseMenu:()=>f(!1),allowCustomValue:!0,prefix:m||(null==O?void 0:O.__isNew__)?void 0:i().createElement(s.Icon,{name:"search"}),onChange:(e,t)=>{return(null==e?void 0:e.__isNew__)||(null==e?void 0:e.icon)?(y((r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){c(e,t,n[t])}))}return e}({},e),a=null!=(a={icon:"filter"})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(a)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(a,e))})),r)),n(e.value)):"clear"===t.action?n(""):void("select-option"===t.action&&e.value&&!e.__isNew__&&d(e.value));var r,a},onInputChange:(e,t)=>{const r=t;return"input-change"===r.action?n(e):"menu-close"===r.action&&r.prevInputValue?(y({value:(0,l.vC)(r.prevInputValue),label:r.prevInputValue,icon:"filter",__isNew__:!0}),n(r.prevInputValue)):void 0}}))}function p(e){return{input:(0,r.css)({marginBottom:0}),select:(0,r.css)({maxWidth:e.spacing(64),minWidth:e.spacing(20)}),selectWrapper:(0,r.css)({label:"field-selector-select-wrapper",maxWidth:e.spacing(62.5),minWidth:e.spacing(20),marginRight:e.spacing.x1,marginBottom:0}),serviceSceneSelectWrapper:(0,r.css)({label:"service-select-wrapper",maxWidth:e.spacing(62.5),minWidth:e.spacing(20),marginRight:e.spacing.x1,marginBottom:0})}}},4836:(e,t,n)=>{n.d(t,{u:()=>j});var r,a,i,s=n(7141),o=n(7918),l=n(227),c=n(7781),d=n(738),u=n(5183),p=n(5631),g=n(2007),h=n(7097),v=n(4144),m=n(3143),f=n(5959),b=n.n(f),y=n(4105),S=n(558),w=n(8835),O=n(892),E=n(1766),x=n(5722),C=n(4750),L=n(4861),k=n(8516);class j extends s.Bs{static Selector({model:e}){const{body:t}=e.useState();return t instanceof d.U?b().createElement(b().Fragment,null,t&&b().createElement(d.U.Selector,{model:t})):b().createElement(b().Fragment,null)}onActivate(){var e;const t=(0,C.Hj)(this),n=String(t.state.value),r=(0,C.ir)(this),a=(0,E.rD)(this),i=(0,h.Jl)(n,r,a),l=(0,o.l)(i,{legendFormat:`{{${n}}}`,refId:n});this.setState({body:this.build(l),$data:new s.Es({$data:(0,u.rS)([l]),transformations:[]})}),this._subs.add(this.subscribeToEvent(S.Of,(e=>{this.setState({lastFilterEvent:e})}))),this._subs.add(null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState((e=>{this.onValuesDataQueryChange(e,l)})))}onValuesDataQueryChange(e,t){var n,r;if((null===(n=e.data)||void 0===n?void 0:n.state)===c.LoadingState.Done){var a;const n=this.state.lastFilterEvent;(null===(a=e.data)||void 0===a?void 0:a.state)===c.LoadingState.Done&&n&&("exclude"===n.operator&&e.data.series.length<1&&this.navigateToFields(),"include"===n.operator&&e.data.series.length<=1&&this.navigateToFields()),this.state.body instanceof s.dM&&this.setState({body:this.build(t)})}(null===(r=e.data)||void 0===r?void 0:r.state)===c.LoadingState.Error&&this.setErrorState(e.data.errors)}setErrorState(e){this.setState({body:new s.dM({reactNode:b().createElement(g.Alert,{title:"Something went wrong with your request",severity:"error"},null==e?void 0:e.map(((e,t)=>b().createElement("div",{key:t},e.status&&b().createElement(b().Fragment,null,b().createElement("strong",null,"Status"),": ",e.status," ",b().createElement("br",null)),e.message&&b().createElement(b().Fragment,null,b().createElement("strong",null,"Message"),": ",e.message," ",b().createElement("br",null)),e.traceId&&b().createElement(b().Fragment,null,b().createElement("strong",null,"TraceId"),": ",e.traceId)))))})})}navigateToFields(){this.setState({lastFilterEvent:void 0}),(0,w.Vt)(O.G3.fields,s.jh.getAncestor(this,E.Mn))}build(e){const t=(0,C.Hj)(this),n=String(t.state.value),{sortBy:r,direction:a}=(0,l.vs)("fields",x.DEFAULT_SORT_BY,"desc"),i=s.jh.getAncestor(this,y.J6),o=()=>{var e;return null!==(e=i.state.search.state.filter)&&void 0!==e?e:""},c=(0,h.Ri)(n,this);return new d.U({options:[{value:"single",label:"Single"},{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new s.G1({direction:"column",children:[new s.dM({reactNode:b().createElement(y.J6.LabelsMenu,{model:i})}),new s.vA({minHeight:300,body:s.d0.timeseries().setTitle(n).setMenu(new L.GD({})).build()})]}),new s.G1({direction:"column",children:[new s.dM({reactNode:b().createElement(y.J6.LabelsMenu,{model:i})}),new k.s7({title:n}),new s.dM({reactNode:b().createElement(y.J6.ValuesMenu,{model:i})}),new p.h({body:new s.gF({templateColumns:y.OK,autoRows:"200px",children:[new s.vA({body:new s.dM({reactNode:b().createElement(g.LoadingPlaceholder,{text:"Loading..."})})})],isLazy:!0}),getLayoutChild:(0,h.Zp)(v.ee,(null==e?void 0:e.expr.includes("count_over_time"))?g.DrawStyle.Bars:g.DrawStyle.Line,"structuredMetadata"===c?m._P:m.mB,s.jh.getAncestor(this,y.J6).state.sort,n),sortBy:r,direction:a,getFilter:o})]}),new s.G1({direction:"column",children:[new s.dM({reactNode:b().createElement(y.J6.LabelsMenu,{model:i})}),new k.s7({title:n}),new s.dM({reactNode:b().createElement(y.J6.ValuesMenu,{model:i})}),new p.h({body:new s.gF({templateColumns:"1fr",autoRows:"200px",children:[new s.vA({body:new s.dM({reactNode:b().createElement(g.LoadingPlaceholder,{text:"Loading..."})})})],isLazy:!0}),getLayoutChild:(0,h.Zp)(v.ee,(null==e?void 0:e.expr.includes("count_over_time"))?g.DrawStyle.Bars:g.DrawStyle.Line,"structuredMetadata"===c?m._P:m.mB,s.jh.getAncestor(this,y.J6).state.sort,n),sortBy:r,direction:a,getFilter:o})]})]})}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}i=({model:e})=>{const{body:t}=e.useState(),n=(0,g.useStyles2)(L.K_);return t?b().createElement("span",{className:n.panelWrapper},t&&b().createElement(t.Component,{model:t})):b().createElement(g.LoadingPlaceholder,{text:"Loading..."})},(a="Component")in(r=j)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i},3102:(e,t,n)=>{n.d(t,{E:()=>E});var r=n(7141),a=n(3143),i=n(7918),s=n(5183),o=n(2007),l=n(738),c=n(4105),d=n(1766),u=n(5959),p=n.n(u),g=n(9016),h=n(892),v=n(7781),m=n(7097),f=n(4750),b=n(4861),y=n(2871),S=n(227),w=n(1752);function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class E extends r.Bs{updateChildren(e,t=void 0){var n;const a=(0,d.UO)(e),i=(0,d.nU)(e),s=(0,d.dB)(e),o=this.calculateCardinalityMap(e);null===(n=this.state.body)||void 0===n||n.state.layouts.forEach((e=>{if(e instanceof r.gF){const n=new Set(null==i?void 0:i.values),l=e.state.children;for(let o=0;o<l.length;o++){const c=e.state.children[o];if(c instanceof r.xK){const e=c.state.body;if(e instanceof r.Eb){if(t){const n=null==i?void 0:i.values.indexOf(e.state.title);if((n&&-1!==n?null==s?void 0:s.values[n]:void 0)!==t){const t=(0,m.ph)(e.state.title,a),n=this.getQueryRunnerForPanel(e.state.title,a,t);e.setState({$data:n})}}n.has(e.state.title)?n.delete(e.state.title):(l.splice(o,1),o--)}else y.v.warn("panel is not VizPanel!")}else y.v.warn("gridItem is not SceneCSSGridItem")}const c=Array.from(n).map((e=>e));l.push(...this.buildChildren(c)),l.sort(this.sortChildren(o)),l.map((e=>{this.subscribeToPanel(e)})),e.setState({children:l})}else y.v.warn("Layout is not SceneCSSGridLayout")}))}sortChildren(e){return(t,n)=>{const r=t.state.body,a=n.state.body;var i;const s=null!==(i=e.get(r.state.title))&&void 0!==i?i:0;var o;return(null!==(o=e.get(a.state.title))&&void 0!==o?o:0)-s}}calculateCardinalityMap(e){const t=(0,d.UO)(e),n=new Map;if(null==t?void 0:t.length)for(let e=0;e<(null==t?void 0:t.length);e++){const r=t.fields[0].values[e],a=t.fields[1].values[e];n.set(r,a)}return n}onActivate(){var e;this.setState({body:this.build()});const t=r.jh.getAncestor(this,d.Mn);void 0===t.state.fieldsCount&&this.updateFieldCount(),this._subs.add(null===(e=t.state.$detectedFieldsData)||void 0===e?void 0:e.subscribeToState(this.onDetectedFieldsChange)),this._subs.add(this.subscribeToFieldsVar())}subscribeToFieldsVar(){return(0,f.ir)(this).subscribeToState(((e,t)=>{const n=r.jh.getAncestor(this,d.Mn),a=e.filters.map((e=>(0,f.bu)(e).parser)),i=t.filters.map((e=>(0,f.bu)(e).parser)),s=(0,m.Qg)(a);if(s!==(0,m.Qg)(i)){var o;const e=null===(o=n.state.$detectedFieldsData)||void 0===o?void 0:o.state;e&&this.updateChildren(e,s)}}))}build(){var e;const t=(0,f.Hj)(this).state.options.map((e=>String(e.value)));r.jh.getAncestor(this,c.J6).state.search.reset();const n=this.buildChildren(t),a=r.jh.getAncestor(this,d.Mn),i=this.calculateCardinalityMap(null===(e=a.state.$detectedFieldsData)||void 0===e?void 0:e.state);n.sort(this.sortChildren(i));const s=n.map((e=>e.clone()));return[...n,...s].map((e=>{this.subscribeToPanel(e)})),new l.U({options:[{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new r.gF({templateColumns:c.OK,autoRows:"200px",children:n,isLazy:!0}),new r.gF({templateColumns:"1fr",autoRows:"200px",children:s,isLazy:!0})]})}subscribeToPanel(e){const t=e.state.body;var n;t&&this._subs.add(null==t||null===(n=t.state.$data)||void 0===n?void 0:n.getResultsStream().subscribe((t=>{t.data.errors&&t.data.errors.length>0&&(e.setState({isHidden:!0}),this.updateFieldCount())})))}rebuildAvgFields(){const e=(0,d.rD)(this),t=this.getActiveGridLayouts(),n=[];var a;const i=null!==(a=(0,S.ex)("panelType",[b.ls.histogram,b.ls.timeseries]))&&void 0!==a?a:b.ls.timeseries;null==t||t.state.children.forEach((t=>{if(t instanceof r.xK&&!t.state.isHidden){const a=r.jh.findDescendents(t,r.Eb);if(a.length){const r=a[0].state.title,s=(0,m.ph)(r,e);if((0,m.JI)(s)){const t=this.buildChild(r,e,i);t&&n.push(t)}else n.push(t)}}})),n.length&&(null==t||t.setState({children:n}))}buildChildren(e){const t=[],n=(0,d.rD)(this);var r;const i=null!==(r=(0,S.ex)("panelType",[b.ls.timeseries,b.ls.histogram]))&&void 0!==r?r:b.ls.timeseries;for(const r of e){if(r===a.To||!r)continue;const e=this.buildChild(r,n,i);e&&t.push(e)}return t}buildChild(e,t,n){if(e===a.To||!e)return;const i=(0,m.ph)(e,t),l=this.getQueryRunnerForPanel(e,t,i);let c;const d=[];(0,m.JI)(i)?(c="histogram"===n?r.d0.histogram():r.d0.timeseries(),c.setTitle(e).setData(l).setMenu(new b.GD({labelName:e,panelType:n})),d.push(new g.X({labelName:String(e),hideValueDrilldown:!0,fieldType:h._J.field}))):(c=r.d0.timeseries().setTitle(e).setData(l).setMenu(new b.GD({labelName:e})).setCustomFieldConfig("stacking",{mode:o.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",o.DrawStyle.Bars).setOverrides(s.jC),d.push(new g.X({labelName:String(e),fieldType:h._J.field}))),c.setHeaderActions(d),c.setSeriesLimit(w.l);const u=c.build();return new r.xK({body:u})}getQueryRunnerForPanel(e,t,n){const r=(0,f.ir)(this),a=(0,m.Jl)(e,r,t),o=(0,i.l)(a,{legendFormat:(0,m.JI)(n)?e:`{{${e}}}`,refId:e});return(0,s.rS)([o])}getActiveGridLayouts(){var e,t,n;return null!==(n=null===(e=this.state.body)||void 0===e?void 0:e.state.layouts.find((e=>e.isActive)))&&void 0!==n?n:null===(t=this.state.body)||void 0===t?void 0:t.state.layouts[0]}updateFieldCount(){var e,t;const n=this.getActiveGridLayouts(),a=null==n?void 0:n.state.children,i=null==a?void 0:a.filter((e=>!e.state.isHidden));var s;null===(e=(t=r.jh.getAncestor(this,c.J6).state).changeFieldCount)||void 0===e||e.call(t,null!==(s=null==i?void 0:i.length)&&void 0!==s?s:0)}static Selector({model:e}){const{body:t}=e.useState();return p().createElement(p().Fragment,null,t&&p().createElement(l.U.Selector,{model:t}))}constructor(e){super(e),O(this,"onDetectedFieldsChange",(e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===v.LoadingState.Done&&this.updateChildren(e)})),this.addActivationHandler(this.onActivate.bind(this))}}O(E,"Component",(({model:e})=>{const{body:t}=e.useState(),n=(0,o.useStyles2)(b.K_);return t?p().createElement("span",{className:n.panelWrapper},t&&p().createElement(t.Component,{model:t})):p().createElement(o.LoadingPlaceholder,{text:"Loading..."})}))},4105:(e,t,n)=>{n.d(t,{J6:()=>N,OK:()=>D,ZI:()=>$});var r=n(6089),a=n(5959),i=n.n(a),s=n(7781),o=n(7141),l=n(2007),c=n(2718),d=n(227),u=n(3143),p=n(833),g=n(5431),h=n(8835),v=n(892),m=n(5722),f=n(4235),b=n(1766),y=n(1022),S=n(5631),w=n(3102),O=n(4462),E=n(4836),x=n(738),C=n(4144),L=n(9570),k=n(6001),j=n(3782),P=n(4750),_=n(9558),T=n(1863);function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const D="repeat(auto-fit, minmax(400px, 1fr))";class N extends o.Bs{onActivate(){var e,t,n;const r=(0,P.Hj)(this),a=o.jh.getAncestor(this,b.Mn);this.setState({loading:(null===(t=a.state.$detectedLabelsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)!==s.LoadingState.Done}),this._subs.add(this.subscribeToEvent(y.x,(()=>{this.state.search.clearValueFilter()}))),this._subs.add(this.subscribeToEvent(C.gf,this.handleSortByChange)),this._subs.add(r.subscribeToState(this.variableChanged)),this._subs.add((0,P.cR)(this).subscribeToState(((e,t)=>{const n=(0,P.Hj)(this);let{labelName:r}=(0,v.W6)();const a=e.filters.find((e=>e.key===r)),i=t.filters.find((e=>e.key===r));n.state.value===u.To&&a!==i&&this.setState({loading:!0,body:void 0})}))),this._subs.add(null===(n=a.state.$detectedFieldsData)||void 0===n?void 0:n.subscribeToState(((e,t)=>{var n,r,a;(null===(n=e.data)||void 0===n?void 0:n.state)===s.LoadingState.Done&&(null===(r=e.data.series)||void 0===r?void 0:r[0])&&this.updateOptions(null===(a=e.data.series)||void 0===a?void 0:a[0])})));const i=(0,b.rD)(this);i&&this.updateOptions(i),(0,v.NX)(this)}updateOptions(e){if(!e||!e.length){const e=o.jh.getAncestor(this,f.PR);let r;var t,n;return(0,T.m)(e).length>1?(null===(t=(n=this.state).changeFieldCount)||void 0===t||t.call(n,0),r=new _.W({clearCallback:()=>(0,T.r)(this)})):r=new j.a({type:"fields"}),void this.setState({loading:!1,body:r})}const r=o.jh.getAncestor(this,b.Mn);var a;(0,P.Hj)(this).setState({options:(0,k.rd)(e.fields[0].values.map((e=>String(e)))),loading:!1,value:null!==(a=r.state.drillDownLabel)&&void 0!==a?a:u.To}),this.setState({loading:!1})}updateBody(e){const t=(0,P.Hj)(this);if(!t.state.options||!t.state.options.length)return;const n={};if(t.state.options&&t.state.options.length<=1){const e=o.jh.getAncestor(this,f.PR);var r,a;(0,T.m)(e).length>1?(null===(r=(a=this.state).changeFieldCount)||void 0===r||r.call(a,0),n.body=new _.W({clearCallback:()=>(0,T.r)(this)})):n.body=new j.a({type:"fields"})}else e.value===u.To&&this.state.body instanceof E.u?n.body=new w.E({}):e.value!==u.To&&this.state.body instanceof w.E?n.body=new E.u({}):(void 0===this.state.body||this.state.body instanceof j.a||this.state.body instanceof _.W)&&(n.body=e.value===u.To?new w.E({}):new E.u({}));this.setState(n)}constructor(e){var t,n,r,a;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){F(e,t,n[t])}))}return e}({$variables:null!==(r=e.$variables)&&void 0!==r?r:new o.Pj({variables:[new g.m({name:u.LI,defaultToAll:!1,includeAll:!0,value:null!==(t=e.value)&&void 0!==t?t:u.To,options:null!==(n=e.options)&&void 0!==n?n:[]})]}),loading:!0,sort:new C.wd({target:"fields"}),search:new y.G("fields"),value:null!==(a=e.value)&&void 0!==a?a:u.To},e)),F(this,"_variableDependency",new o.Sh(this,{variableNames:[u.MB]})),F(this,"variableChanged",((e,t)=>{(e.value!==t.value||!(0,p.B)(e.options,t.options)||void 0===this.state.body||this.state.body instanceof j.a||this.state.body instanceof _.W)&&this.updateBody(e)})),F(this,"handleSortByChange",(e=>{if("fields"!==e.target)return;const t=this.state.body;var n;t instanceof E.u&&t.state.body instanceof x.U&&(null===(n=t.state.body)||void 0===n||n.state.layouts.forEach((n=>{o.jh.findDescendents(t,S.h).forEach((t=>t.sort(e.sortBy,e.direction)))}))),(0,c.EE)(c.NO.service_details,c.ir.service_details.value_breakdown_sort_change,{target:"fields",criteria:e.sortBy,direction:e.direction})})),F(this,"onFieldSelectorChange",(e=>{if(!e)return;const t=(0,P.Hj)(this),{sortBy:n,direction:r}=(0,d.vs)("fields",m.DEFAULT_SORT_BY,"desc");(0,c.EE)(c.NO.service_details,c.ir.service_details.select_field_in_breakdown_clicked,{field:e,previousField:t.getValueText(),view:"fields",sortBy:n,sortByDirection:r});const a=o.jh.getAncestor(this,b.Mn);(0,h.fg)(v._J.field,e,a)})),this.addActivationHandler(this.onActivate.bind(this))}}F(N,"LabelsMenu",(({model:e})=>{const{body:t,loading:n,search:r}=e.useState(),a=(0,l.useStyles2)(A),s=(0,P.Hj)(e),{options:o,value:c}=s.useState();return i().createElement("div",{className:a.labelsMenuWrapper},t instanceof w.E&&i().createElement(w.E.Selector,{model:t}),t instanceof E.u&&i().createElement(E.u.Selector,{model:t}),t instanceof E.u&&i().createElement(r.Component,{model:r}),!n&&o.length>1&&i().createElement(O.u,{label:"Field",options:o,value:String(c),onChange:e.onFieldSelectorChange}))})),F(N,"ValuesMenu",(({model:e})=>{const{loading:t,sort:n}=e.useState(),r=(0,l.useStyles2)(A),a=(0,P.Hj)(e),{value:s}=a.useState();return i().createElement("div",{className:r.valuesMenuWrapper},!t&&s!==u.To&&i().createElement(i().Fragment,null,i().createElement(n.Component,{model:n})))})),F(N,"Component",(({model:e})=>{const{body:t,loading:n,blockingMessage:r}=e.useState(),a=(0,l.useStyles2)(A);return i().createElement("div",{className:a.container},i().createElement(L.O,{isLoading:n,blockingMessage:r},t instanceof w.E&&e&&i().createElement(N.LabelsMenu,{model:e}),i().createElement("div",{className:a.content},t&&i().createElement(t.Component,{model:t}))))}));const $={link:(0,r.css)({textDecoration:"underline"}),button:(0,r.css)({marginLeft:"1.5rem"})};function A(e){return{container:(0,r.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column",gap:e.spacing(1)}),content:(0,r.css)({flexGrow:1,display:"flex",paddingTop:e.spacing(0)}),labelsMenuWrapper:(0,r.css)({flexGrow:0,display:"flex",alignItems:"top",justifyContent:"space-between",flexDirection:"row-reverse",gap:e.spacing(2)}),valuesMenuWrapper:(0,r.css)({flexGrow:0,display:"flex",alignItems:"top",gap:e.spacing(2),flexDirection:"row"})}}},8810:(e,t,n)=>{n.d(t,{O:()=>I});var r=n(6089),a=n(5959),i=n.n(a),s=n(7781),o=n(7141),l=n(2007),c=n(2718),d=n(892),u=n(3143),p=n(5631),g=n(4462),h=n(9570),v=n(6001),m=n(1022),f=n(227),b=n(4144),y=n(1766),S=n(5431),w=n(8835),O=n(833),E=n(3630),x=n(738),C=n(5183),L=n(9016),k=n(4119),j=n(4750),P=n(4861),_=n(1752);function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class F extends o.Bs{onActivate(){var e;const t=(0,j.ir)(this),n=o.jh.getAncestor(this,y.Mn).state.$detectedLabelsData;this.state.body?(null==n||null===(e=n.state.data)||void 0===e?void 0:e.state)===s.LoadingState.Done&&this.update(null==n?void 0:n.state.data.series[0]):this.setState({body:this.build()}),this._subs.add(null==n?void 0:n.subscribeToState(((e,t)=>{var n;(null===(n=e.data)||void 0===n?void 0:n.state)===s.LoadingState.Done&&this.update(e.data.series[0])}))),this._subs.add(t.subscribeToState((()=>{this.updateQueriesOnFieldsVariableChange()})))}getPanelByIndex(e,t){const n=e.state.children[t].state.body;return{panel:n,title:n.state.title}}update(e){var t;const n=(0,j.P4)(this).state.options.filter((e=>e.value!==u.To)).map((e=>e.label));null===(t=this.state.body)||void 0===t||t.state.layouts.forEach((t=>{let r=[];const a=t,i=new Set(n),s=a.state.children;for(let e=0;e<s.length;e++){const{title:t}=this.getPanelByIndex(a,e);i.has(t)?i.delete(t):(s.splice(e,1),e--),r.push(t)}const o=Array.from(i).map((e=>({label:e,value:e})));s.push(...this.buildChildren(o));const l=this.calculateCardinalityMap(e);s.sort(this.sortChildren(l)),a.setState({children:s})}))}calculateCardinalityMap(e){const t=new Map;if(null==e?void 0:e.length)for(let n=0;n<(null==e?void 0:e.fields.length);n++){const r=e.fields[n].name,a=e.fields[n].values[0];t.set(r,a)}return t}build(){var e;const t=(0,j.P4)(this);o.jh.getAncestor(this,I).state.search.reset();const n=this.buildChildren(t.state.options),r=o.jh.getAncestor(this,y.Mn).state.$detectedLabelsData;if((null==r||null===(e=r.state.data)||void 0===e?void 0:e.state)===s.LoadingState.Done){const e=this.calculateCardinalityMap(null==r?void 0:r.state.data.series[0]);n.sort(this.sortChildren(e))}const a=n.map((e=>e.clone()));return new x.U({options:[{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new o.gF({isLazy:!0,templateColumns:k.d,autoRows:"200px",children:n}),new o.gF({isLazy:!0,templateColumns:"1fr",autoRows:"200px",children:a})]})}buildChildren(e){const t=[];for(const n of e){const{value:e}=n,r=String(e);if(e===u.To||!e)continue;const a=(0,k.o)(this,String(n.value),String(n.value)),i=(0,C.rS)([a]);t.push(new o.xK({body:o.d0.timeseries().setTitle(r).setData(i).setHeaderActions([new L.X({labelName:r,fieldType:d._J.label})]).setCustomFieldConfig("stacking",{mode:l.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",l.DrawStyle.Bars).setHoverHeader(!1).setOverrides(C.jC).setMenu(new P.GD({labelName:r})).setSeriesLimit(_.l).build()}))}return t}sortChildren(e){return(t,n)=>{const r=t.state.body,a=n.state.body;if(r.state.title===u.e4)return-1;if(a.state.title===u.e4)return 1;var i;const s=null!==(i=e.get(r.state.title))&&void 0!==i?i:0;var o;return(null!==(o=e.get(a.state.title))&&void 0!==o?o:0)-s}}static Selector({model:e}){const{body:t}=e.useState();return i().createElement(i().Fragment,null,t&&i().createElement(x.U.Selector,{model:t}))}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){T(e,t,n[t])}))}return e}({},e)),T(this,"updateQueriesOnFieldsVariableChange",(()=>{var e;null===(e=this.state.body)||void 0===e||e.state.layouts.forEach((e=>{const t=e;for(let e=0;e<t.state.children.length;e++){const{panel:a,title:i}=this.getPanelByIndex(t,e),s=a.state.$data,l=(0,k.o)(this,i,i);var n,r;if(s instanceof o.dt&&l.expr===(null==s||null===(r=s.state.queries)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.expr))break;a.setState({$data:(0,C.rS)([l])})}}))})),this.addActivationHandler(this.onActivate.bind(this))}}T(F,"Component",(({model:e})=>{const{body:t}=e.useState(),n=(0,l.useStyles2)(P.K_);return t?i().createElement("span",{className:n.panelWrapper},t&&i().createElement(t.Component,{model:t})):i().createElement(l.LoadingPlaceholder,{text:"Loading..."})}));var D=n(5722),N=n(3782);function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$(e,t,n[t])}))}return e}class I extends o.Bs{onActivate(){var e,t,n,r,a;const i=o.jh.getAncestor(this,y.Mn),l=(0,j.P4)(this);this.setState({loading:(null===(t=i.state.$detectedLabelsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)!==s.LoadingState.Done,error:(null===(r=i.state.$detectedLabelsData)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.state)===s.LoadingState.Error}),this._subs.add(this.subscribeToEvent(m.x,(()=>{this.state.search.clearValueFilter()}))),this._subs.add(this.subscribeToEvent(b.gf,this.handleSortByChange)),this._subs.add(null===(a=i.state.$detectedLabelsData)||void 0===a?void 0:a.subscribeToState(this.onDetectedLabelsDataChange)),this._subs.add((0,j.cR)(this).subscribeToState(((e,t)=>{this.onLabelsVariableChange(e,t)}))),this._subs.add(l.subscribeToState(((e,t)=>{this.onGroupByVariableChange(e,t)})));const c=(0,y.TG)(this);c&&this.updateOptions(c),(0,d.NX)(this)}onGroupByVariableChange(e,t){(e.value!==t.value||!(0,O.B)(e.options,t.options)||void 0===this.state.body||this.state.body instanceof N.a)&&this.updateBody()}onLabelsVariableChange(e,t){let{labelName:n}=(0,d.W6)();n===u.ky&&(n=u.OX);const r=(0,j.P4)(this),a=e.filters.find((e=>e.key===n)),i=t.filters.find((e=>e.key===n));r.state.value===u.To&&a!==i&&this.setState({loading:!0,body:void 0,error:void 0})}updateOptions(e){if(!e||!e.length)return void this.setState({loading:!1,body:new N.a({type:"labels"})});const t=(0,j.P4)(this),n=(0,v.dD)(e.fields.map((e=>e.name)));var r;t.setState({loading:!1,options:n,value:null!==(r=this.state.value)&&void 0!==r?r:u.To})}updateBody(){const e=(0,j.P4)(this);if(!e.state.options||!e.state.options.length)return;const t={loading:!1,blockingMessage:void 0,error:!1};e.hasAllValue()&&this.state.body instanceof E.u?t.body=new F({}):!e.hasAllValue()&&this.state.body instanceof F?t.body=new E.u({}):void 0===this.state.body?e.state.options.length>0?t.body=e.hasAllValue()?new F({}):new E.u({}):t.body=new N.a({type:"labels"}):this.state.body instanceof N.a&&e.state.options.length>0&&(t.body=e.hasAllValue()?new F({}):new E.u({})),this.setState(A({},t))}constructor(e){var t,n,r,a,i;super((a=A({},e),i=null!=(i={$variables:null!==(r=e.$variables)&&void 0!==r?r:new o.Pj({variables:[new S.m({name:u.Jg,defaultToAll:!1,includeAll:!0,value:null!==(t=e.value)&&void 0!==t?t:u.To,options:null!==(n=e.options)&&void 0!==n?n:[]})]}),loading:!0,sort:new b.wd({target:"labels"}),search:new m.G("labels"),value:e.value})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(i)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))})),a)),$(this,"_variableDependency",new o.Sh(this,{variableNames:[u.MB]})),$(this,"onDetectedLabelsDataChange",((e,t)=>{var n,r,a,i,o,l,c,d,u;(null===(n=e.data)||void 0===n?void 0:n.state)===s.LoadingState.Done&&(null===(r=e.data.series)||void 0===r?void 0:r[0])&&!(0,O.B)(null===(i=e.data.series)||void 0===i||null===(a=i[0])||void 0===a?void 0:a.fields,null===(c=t.data)||void 0===c||null===(l=c.series)||void 0===l||null===(o=l[0])||void 0===o?void 0:o.fields)?this.updateOptions(null===(u=e.data.series)||void 0===u?void 0:u[0]):(null===(d=e.data)||void 0===d?void 0:d.state)===s.LoadingState.Done&&(0,j.P4)(this).setState({loading:!1})})),$(this,"handleSortByChange",(e=>{if("labels"!==e.target)return;const t=this.state.body;t instanceof E.u&&o.jh.findDescendents(t,p.h).forEach((t=>{t.sort(e.sortBy,e.direction)})),(0,c.EE)(c.NO.service_details,c.ir.service_details.value_breakdown_sort_change,{target:"labels",criteria:e.sortBy,direction:e.direction})})),$(this,"onChange",(e=>{if(!e)return;const t=(0,j.P4)(this);t.changeValueTo(e);const{sortBy:n,direction:r}=(0,f.vs)("labels",D.DEFAULT_SORT_BY,"desc");(0,c.EE)(c.NO.service_details,c.ir.service_details.select_field_in_breakdown_clicked,{label:e,previousLabel:t.getValueText(),view:"labels",sortBy:n,sortByDirection:r});const a=o.jh.getAncestor(this,y.Mn);(0,w.fg)(d._J.label,e,a)})),this.addActivationHandler(this.onActivate.bind(this))}}function M(e){return{container:(0,r.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column",gap:e.spacing(1)}),content:(0,r.css)({flexGrow:1,display:"flex",paddingTop:e.spacing(0)}),labelsMenuWrapper:(0,r.css)({flexGrow:0,display:"flex",alignItems:"top",justifyContent:"space-between",flexDirection:"row-reverse",gap:e.spacing(2)}),valuesMenuWrapper:(0,r.css)({flexGrow:0,display:"flex",alignItems:"top",gap:e.spacing(2),flexDirection:"row"})}}$(I,"LabelsMenu",(({model:e})=>{const{body:t,loading:n,search:r}=e.useState(),a=(0,j.P4)(e),{options:s,value:o}=a.useState(),c=(0,l.useStyles2)(M);return i().createElement("div",{className:c.labelsMenuWrapper},t instanceof E.u&&i().createElement(E.u.Selector,{model:t}),t instanceof F&&i().createElement(F.Selector,{model:t}),t instanceof E.u&&i().createElement(r.Component,{model:r}),!n&&s.length>0&&i().createElement(g.u,{label:"Label",options:s,value:String(o),onChange:e.onChange}))})),$(I,"ValuesMenu",(({model:e})=>{const{loading:t,sort:n}=e.useState(),r=(0,j.P4)(e),{value:a}=r.useState(),s=(0,l.useStyles2)(M);return i().createElement("div",{className:s.valuesMenuWrapper},!t&&a!==u.To&&i().createElement(i().Fragment,null,i().createElement(n.Component,{model:n})))})),$(I,"Component",(({model:e})=>{const{body:t,loading:n,blockingMessage:r,error:a}=e.useState(),s=(0,l.useStyles2)(M);return i().createElement("div",{className:s.container},i().createElement(h.O,{isLoading:n,blockingMessage:r},a&&i().createElement(l.Alert,{title:"",severity:"warning"},"The labels are not available at this moment. Try using a different time range or check again later."),t instanceof F&&e&&i().createElement(I.LabelsMenu,{model:e}),i().createElement("div",{className:s.content},t&&i().createElement(t.Component,{model:t}))))}))},3630:(e,t,n)=>{n.d(t,{u:()=>D});var r=n(7141),a=n(738),i=n(4144),s=n(2007),o=n(5183),l=n(227),c=n(7781),d=n(5631),u=n(7097),p=n(3143),g=n(5959),h=n.n(g),v=n(8810),m=n(8835),f=n(892),b=n(1766),y=n(558),S=n(5722),w=n(4119),O=n(8531),E=n(4750),x=n(4861),C=n(9558),L=n(3782),k=n(4235),j=n(1863),P=n(8516);function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){_(e,t,n[t])}))}return e}function F(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class D extends r.Bs{onActivate(){var e;this.setState({$data:(0,o.rS)([(0,w.o)(this,p.zp,String((0,E.P4)(this).state.value))]),body:this.build()});const t=(0,E.P4)(this);this._subs.add(t.subscribeToState((e=>{e.value===p.To&&this.setState({$data:void 0,body:void 0})}))),this.subscribeToEvent(y.Of,(e=>{this.setState({lastFilterEvent:e})})),this._subs.add(null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState(((e,t)=>{this.onValuesDataQueryChange(e,t)})))}onValuesDataQueryChange(e,t){this.setEmptyStates(e),this.setErrorStates(e),this.navigateOnLastFilter(e)}navigateOnLastFilter(e){var t,n;if((null===(t=e.data)||void 0===t?void 0:t.state)===c.LoadingState.Done||(null===(n=e.data)||void 0===n?void 0:n.state)===c.LoadingState.Streaming){const t=this.state.lastFilterEvent;t&&("exclude"===t.operator&&e.data.series.length<1&&this.navigateToLabels(),"include"===t.operator&&e.data.series.length<=1&&this.navigateToLabels())}}setErrorStates(e){var t,n;if((null==e||null===(t=e.data)||void 0===t?void 0:t.errors)&&(null===(n=e.data)||void 0===n?void 0:n.state)!==c.LoadingState.Done){var r;const t=this.state.errors;null==e||null===(r=e.data)||void 0===r||r.errors.forEach((e=>{const n=`${e.status}_${e.traceId}_${e.message}`;void 0===t[n]&&(t[n]=F(T({},e),{displayed:!1}))})),this.setState({errors:t}),this.showErrorToast(this.state.errors)}}setEmptyStates(e){var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===c.LoadingState.Done)if(e.data.series.length>0&&!(this.state.body instanceof a.U))this.setState({body:this.build()});else if(0===e.data.series.length){const e=r.jh.getAncestor(this,k.PR);(0,j.m)(e).length>1?this.setState({body:new C.W({clearCallback:()=>(0,j.r)(this)})}):this.setState({body:new L.a({type:"fields"})})}}getActiveLayout(){const e=this.state.body;if(e instanceof a.U){const t=null==e?void 0:e.state.layouts.find((e=>e.isActive));if(t instanceof r.G1)return t}}activeLayoutContainsNoPanels(){const e=this.getActiveLayout();return!!e&&r.jh.findDescendents(e,d.h).some((e=>{const t=e.state.body.state.children[0];return t instanceof r.vA||t instanceof r.dM}))}navigateToLabels(){this.setState({lastFilterEvent:void 0}),(0,m.Vt)(f.G3.labels,r.jh.getAncestor(this,b.Mn))}build(){const e=(0,E.P4)(this).state,t=r.jh.getAncestor(this,v.O),n=String(null==e?void 0:e.value);let c=r.d0.timeseries();c=c.setCustomFieldConfig("stacking",{mode:s.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",s.DrawStyle.Bars).setOverrides(o.jC).setMenu(new x.GD({})).setTitle(n);const g=c.build(),{sortBy:m,direction:f}=(0,l.vs)("labels",S.DEFAULT_SORT_BY,"desc"),b=()=>{var e;return null!==(e=t.state.search.state.filter)&&void 0!==e?e:""};return new a.U({options:[{value:"single",label:"Single"},{value:"grid",label:"Grid"},{value:"rows",label:"Rows"}],active:"grid",layouts:[new r.G1({direction:"column",children:[new r.dM({reactNode:h().createElement(v.O.LabelsMenu,{model:t})}),new r.vA({minHeight:300,body:g})]}),new r.G1({direction:"column",children:[new r.dM({reactNode:h().createElement(v.O.LabelsMenu,{model:t})}),new P.s7({title:n,levelColor:!0}),new r.dM({reactNode:h().createElement(v.O.ValuesMenu,{model:t})}),new d.h({body:new r.gF({isLazy:!0,templateColumns:w.d,autoRows:"200px",children:[new r.vA({body:new r.dM({reactNode:h().createElement(s.LoadingPlaceholder,{text:"Loading..."})})})]}),getLayoutChild:(0,u.Zp)(i.ee,s.DrawStyle.Bars,p.MB,r.jh.getAncestor(this,v.O).state.sort,n),sortBy:m,direction:f,getFilter:b})]}),new r.G1({direction:"column",children:[new r.dM({reactNode:h().createElement(v.O.LabelsMenu,{model:t})}),new P.s7({title:n,levelColor:!0}),new r.dM({reactNode:h().createElement(v.O.ValuesMenu,{model:t})}),new d.h({body:new r.gF({templateColumns:"1fr",autoRows:"200px",children:[new r.vA({body:new r.dM({reactNode:h().createElement(s.LoadingPlaceholder,{text:"Loading..."})})})]}),getLayoutChild:(0,u.Zp)(i.ee,s.DrawStyle.Bars,p.MB,r.jh.getAncestor(this,v.O).state.sort,n),sortBy:m,direction:f,getFilter:b})]})]})}showErrorToast(e){const t=(0,O.getAppEvents)();let n=[];for(const t in e){const r=e[t];r.displayed||(n.push(r),r.displayed=!0)}n.length&&(this.activeLayoutContainsNoPanels()||t.publish({type:c.AppEvents.alertError.name,payload:null==n?void 0:n.map(((e,t)=>this.renderError(t,e)))}),this.setState({errors:e}))}renderError(e,t){return h().createElement("div",{key:e},t.status&&h().createElement(h().Fragment,null,h().createElement("strong",null,"Status"),": ",t.status," ",h().createElement("br",null)),t.message&&h().createElement(h().Fragment,null,h().createElement("strong",null,"Message"),": ",t.message," ",h().createElement("br",null)),t.traceId&&h().createElement(h().Fragment,null,h().createElement("strong",null,"TraceId"),": ",t.traceId))}static Selector({model:e}){const{body:t}=e.useState();return h().createElement(h().Fragment,null,t&&t instanceof a.U&&h().createElement(a.U.Selector,{model:t}))}constructor(e){super(F(T({},e),{errors:{}})),this.addActivationHandler(this.onActivate.bind(this))}}_(D,"Component",(({model:e})=>{const{body:t}=e.useState(),n=(0,s.useStyles2)(x.K_);return t?h().createElement("span",{className:n.panelWrapper},t&&h().createElement(t.Component,{model:t})):h().createElement(s.LoadingPlaceholder,{text:"Loading..."})}))},738:(e,t,n)=>{n.d(t,{U:()=>u});var r=n(5959),a=n.n(r),i=n(7141),s=n(2007),o=n(2718),l=n(892),c=n(6089);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class u extends i.Bs{constructor(...e){super(...e),d(this,"onLayoutChange",(e=>{(0,o.EE)(o.NO.service_details,o.ir.service_details.layout_type_changed,{layout:e,view:(0,l.FT)()}),this.setState({active:e})}))}}d(u,"Selector",(function({model:e}){const{active:t,options:n}=e.useState(),r=(0,s.useStyles2)(p);return a().createElement(s.Field,{className:r.field},a().createElement(s.RadioButtonGroup,{options:n,value:t,onChange:e.onLayoutChange}))})),d(u,"Component",(({model:e})=>{const{layouts:t,options:n,active:r}=e.useState(),i=n.findIndex((e=>e.value===r));if(-1===i)return null;const s=t[i];return a().createElement(s.Component,{model:s})}));const p=e=>({field:(0,c.css)({marginBottom:0})})},9558:(e,t,n)=>{n.d(t,{W:()=>p});var r,a,i,s=n(7141),o=n(4482),l=n(2007),c=n(5959),d=n.n(c),u=n(4105);class p extends s.Bs{}i=({model:e})=>{const{clearCallback:t}=e.useState();return d().createElement(o.R,null,d().createElement(l.Alert,{title:"",severity:"info"},"No labels match these filters."," ",d().createElement(l.Button,{className:u.ZI.button,onClick:()=>t()},"Clear filters")," "))},(a="Component")in(r=p)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i},8516:(e,t,n)=>{n.d(t,{Zb:()=>h,s$:()=>m,s7:()=>g});var r,a,i,s=n(7141),o=n(4861),l=n(2007),c=n(5183),d=n(227),u=n(5959),p=n.n(u);class g extends s.Bs{onActivate(){var e;const t=null!==(e=(0,d.ex)("collapsed",[o.Ci.collapsed,o.Ci.expanded]))&&void 0!==e?e:o.Ci.expanded,n=function(e,t){var n;const r=null!==(n=(0,d.ex)("collapsed",[o.Ci.collapsed,o.Ci.expanded]))&&void 0!==n?n:o.Ci.expanded,a=s.d0.timeseries().setTitle(e).setMenu(new o.GD({})).setCollapsible(!0).setCollapsed(r===o.Ci.collapsed).setCustomFieldConfig("stacking",{mode:l.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setSeriesLimit(100).setCustomFieldConfig("drawStyle",l.DrawStyle.Bars);return(null==t?void 0:t.levelColor)&&a.setOverrides(c.jC),a.build()}(this.state.title,{levelColor:this.state.levelColor}),r=v(t);this.setState({body:new s.G1({key:m,minHeight:r,height:r,maxHeight:r,wrap:"nowrap",children:[new s.vA({body:n})]})}),this._subs.add(n.subscribeToState(((e,t)=>{e.collapsed!==t.collapsed&&(h(s.jh.getAncestor(n,s.G1),e.collapsed?o.Ci.collapsed:o.Ci.expanded),(0,d.IW)("collapsed",e.collapsed?o.Ci.collapsed:o.Ci.expanded))})))}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}function h(e,t){const n=v(t);e.setState({minHeight:n,height:n,maxHeight:n})}function v(e){return e===o.Ci.collapsed?35:300}i=({model:e})=>{const{body:t}=e.useState();return t?p().createElement("div",null,p().createElement(t.Component,{model:t})):null},(a="Component")in(r=g)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i;const m="value_summary_panel"},6261:(e,t,n)=>{n.d(t,{D:()=>l});var r=n(6089),a=n(2007),i=n(5959),s=n.n(i);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const l=e=>{var{value:t,onChange:n,placeholder:r,onClear:i,suffix:l}=e,d=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(e,["value","onChange","placeholder","onClear","suffix"]);return s().createElement(a.Input,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}({value:t,onChange:n,suffix:s().createElement(s().Fragment,null,t?s().createElement(a.Icon,{onClick:i,title:"Clear search",name:"times",className:c.clearIcon}):void 0,l&&l),prefix:s().createElement(a.Icon,{name:"search"}),placeholder:r},d))},c={clearIcon:(0,r.css)({cursor:"pointer"})}},9016:(e,t,n)=>{n.d(t,{X:()=>N});var r=n(7141),a=n(1766),i=n(8835),s=n(892),o=n(2007),l=n(5959),c=n.n(l),d=n(558),u=n(3143),p=n(7781),g=n(4750),h=n(4793),v=n(6089),m=n(3241),f=n(2871),b=n(1220);function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var S=function(e){return e.ns="ns",e.us="µs",e.ms="ms",e.s="s",e.m="m",e.h="h",e}(S||{}),w=function(e){return e.B="B",e.KB="KB",e.MB="MB",e.GB="GB",e.TB="TB",e}(w||{});class O extends r.Bs{onActivate(){const e=(0,g.bY)((0,d.ts)(this.state.labelName,this.state.variableType),this).state.filters.filter((e=>e.key===this.state.labelName)),t=e.find((e=>e.operator===h.w.gte||e.operator===h.w.gt)),n=e.find((e=>e.operator===h.w.lte||e.operator===h.w.lt));let r={};if("duration"===this.state.fieldType||"bytes"===this.state.fieldType){if(t){const e=E((0,g.bu)(t).value,this.state.fieldType);e&&(r.gt=e.value,r.gtu=e.unit,r.gte=t.operator===h.w.gte)}if(n){const e=E((0,g.bu)(n).value,this.state.fieldType);e&&(r.lt=e.value,r.ltu=e.unit,r.lte=n.operator===h.w.lte)}}else{if(t){const e=(0,g.bu)(t).value;r.gt=Number(e),r.gtu="",r.gte=t.operator===h.w.gte}if(n){const e=(0,g.bu)(n).value;r.lt=Number(e),r.ltu="",r.lte=n.operator===h.w.lte}}0!==Object.keys(r).length&&(r.hasExistingFilter=!0),this.setState(r)}onSubmit(){this.state.gt?(0,d.vn)(this.state.labelName,this.state.gt.toString()+this.state.gtu,this.state.gte?h.w.gte:h.w.gt,this,this.state.variableType):(0,d.VT)(this.state.labelName,this,this.state.gte?h.w.gte:h.w.gt,this.state.variableType),this.state.lt?(0,d.vn)(this.state.labelName,this.state.lt.toString()+this.state.ltu,this.state.lte?h.w.lte:h.w.lt,this,this.state.variableType):(0,d.VT)(this.state.labelName,this,this.state.lte?h.w.lte:h.w.lt,this.state.variableType),r.jh.getAncestor(this,N).togglePopover()}constructor(e){let t;const n=e.fieldType;if("bytes"===n)t={ltu:"B",gtu:"B"};else if("duration"===n)t={ltu:"s",gtu:"s"};else{if("float"!==n)throw new Error(`field type incorrectly defined: ${n}`);t={ltu:"",gtu:""}}super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){y(e,t,n[t])}))}return e}({},e,t)),y(this,"onInputKeydown",(e=>{const t=void 0===this.state.gt&&void 0===this.state.lt;"Enter"!==e.key||t||this.onSubmit()})),this.addActivationHandler(this.onActivate.bind(this))}}function E(e,t){if("duration"===t){const t=Object.values(S).find((t=>{const n=t.length;return e.slice(-1*n)===t}));if(t){const n=Number(e.replace(t,""));if(!isNaN(n))return{unit:t,value:n}}}if("bytes"===t){const t=Object.values(w).sort(((e,t)=>t.length-e.length)).find((t=>{const n=t.length;return e.slice(-1*n)===t}));if(t){const n=Number(e.replace(t,""));if(!isNaN(n))return{unit:t,value:n}}}}function x(e){if("duration"===e)return Object.keys(S).map((e=>({text:e,value:S[e],label:e})));if("bytes"===e)return Object.keys(w).map((e=>({text:e,value:w[e],label:e})));const t=new Error(`invalid field type: ${e}`);throw f.v.error(t,{msg:"getUnitOptions, invalid field type"}),t}y(O,"Component",(({model:e})=>{const t=(0,o.useStyles2)(C),{labelName:n,gt:a,lt:i,gte:s,lte:l,gtu:d,ltu:u,fieldType:p,hasExistingFilter:g}=e.useState(),h="float"!==p&&p!==n?`(${p})`:void 0,m=r.jh.getAncestor(e,N),f=void 0===a&&void 0===i;return c().createElement(o.ClickOutsideWrapper,{useCapture:!0,onClick:()=>m.togglePopover()},c().createElement(o.Stack,{direction:"column",gap:0,role:"tooltip"},c().createElement("div",{className:t.card.body},c().createElement("div",{className:t.card.title},n," ",h),c().createElement("div",{className:t.card.fieldWrap},c().createElement(o.FieldSet,{className:t.card.fieldset},c().createElement(o.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputGreaterThanInclusive,horizontal:!0,className:(0,v.cx)(t.card.field,t.card.inclusiveField)},c().createElement(o.Select,{className:t.card.inclusiveInput,menuShouldPortal:!1,value:void 0!==s?s.toString():"false",options:[{label:"Greater than",value:"false"},{label:"Greater than or equal",value:"true"}],onChange:t=>e.setState({gte:"true"===t.value})})),c().createElement(o.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputGreaterThan,horizontal:!0,className:t.card.field},c().createElement(o.Input,{onKeyDownCapture:e.onInputKeydown,autoFocus:!0,onChange:t=>{e.setState({gt:""!==t.currentTarget.value?Number(t.currentTarget.value):void 0})},className:t.card.numberInput,value:a,type:"number"})),"float"!==p&&c().createElement(o.Label,null,c().createElement(o.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputGreaterThanUnit,horizontal:!0,className:t.card.field,label:c().createElement("span",{className:t.card.unitFieldLabel},"Unit")},c().createElement(o.Select,{onChange:t=>{e.setState({gtu:t.value})},menuShouldPortal:!1,options:x(p),className:t.card.selectInput,value:d})))),c().createElement(o.FieldSet,{className:t.card.fieldset},c().createElement(o.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputLessThanInclusive,horizontal:!0,className:(0,v.cx)(t.card.field,t.card.inclusiveField)},c().createElement(o.Select,{className:t.card.inclusiveInput,menuShouldPortal:!1,value:void 0!==l?l.toString():"false",options:[{label:"Less than",value:"false"},{label:"Less than or equal",value:"true"}],onChange:t=>e.setState({lte:"true"===t.value})})),c().createElement(o.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputLessThan,horizontal:!0,className:t.card.field},c().createElement(o.Input,{onKeyDownCapture:e.onInputKeydown,onChange:t=>e.setState({lt:""!==t.currentTarget.value?Number(t.currentTarget.value):void 0}),className:t.card.numberInput,value:i,type:"number"})),"float"!==p&&c().createElement(o.Label,null,c().createElement(o.Field,{"data-testid":b.b.breakdowns.common.filterNumericPopover.inputLessThanUnit,horizontal:!0,className:t.card.field,label:c().createElement("span",{className:t.card.unitFieldLabel},"Unit")},c().createElement(o.Select,{onChange:t=>{e.setState({ltu:t.value})},menuShouldPortal:!1,options:x(p),className:t.card.selectInput,value:u}))))),c().createElement("div",{className:t.card.buttons},g&&c().createElement(o.Button,{"data-testid":b.b.breakdowns.common.filterNumericPopover.removeButton,disabled:!g,onClick:()=>{e.setState({gt:void 0,lt:void 0}),e.onSubmit()},size:"sm",variant:"destructive",fill:"outline"},"Remove"),c().createElement(o.Button,{"data-testid":b.b.breakdowns.common.filterNumericPopover.submitButton,disabled:f,onClick:()=>e.onSubmit(),size:"sm",variant:"primary",fill:"outline",type:"submit"},"Add"),c().createElement(o.Button,{"data-testid":b.b.breakdowns.common.filterNumericPopover.cancelButton,onClick:()=>m.togglePopover(),size:"sm",variant:"secondary",fill:"outline"},"Cancel")))))}));const C=e=>({card:{buttons:(0,v.css)({display:"flex",flexWrap:"wrap",justifyContent:"flex-end",gap:e.spacing(1.5),marginTop:e.spacing(1)}),inclusiveInput:(0,v.css)({minWidth:"185px"}),selectInput:(0,v.css)({minWidth:"65px"}),numberInput:(0,v.css)({width:"75px"}),fieldWrap:(0,v.css)({display:"flex",flexDirection:"column",paddingTop:e.spacing(2),paddingBottom:0}),field:(0,v.css)({display:"flex",alignItems:"center",marginBottom:e.spacing(1)}),inclusiveField:(0,v.css)({marginRight:e.spacing(1)}),unitFieldLabel:(0,v.css)({marginLeft:e.spacing(2),marginRight:e.spacing(1.5)}),numberFieldLabel:(0,v.css)({width:"100px"}),switchFieldLabel:(0,v.css)({marginLeft:e.spacing(2),marginRight:e.spacing(1)}),fieldset:(0,v.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:0}),title:(0,v.css)({}),body:(0,v.css)({padding:e.spacing(2)}),p:(0,v.css)({maxWidth:300})}});var L=n(7097),k=n(9829);function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){j(e,t,n[t])}))}return e}function _(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const T="Include",F="Exclude",D="Add to filter";class N extends r.Bs{onChange(e){const t=this.getVariable(),n=t.state.name,r=this.getExistingFilter(t),a=(0,g.z2)(t,r);(null==r?void 0:r.operator)===h.w.NotEqual&&a.value===u.ZO&&e.value===T?this.clearFilter(n):e.value===T?this.onClickExcludeEmpty(n):e.value===F?this.onClickIncludeEmpty(n):e.value===D&&this.onClickNumericFilter(n),this.setState({selectedValue:e})}getExistingFilter(e){let{labelName:t}=(0,s.W6)();if(this.state.labelName!==t)return null==e?void 0:e.state.filters.find((e=>e.key===this.state.labelName))}onActivate(){var e,t;const n=r.jh.getAncestor(this,a.Mn);(null===(t=n.state.$data)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.state)===p.LoadingState.Done&&this.calculateSparsity(),this._subs.add(r.jh.getData(this).subscribeToState((e=>{var t,r,a,i;(null===(t=e.data)||void 0===t?void 0:t.state)===p.LoadingState.Done&&((null===(a=n.state.$data)||void 0===a||null===(r=a.state.data)||void 0===r?void 0:r.state)===p.LoadingState.Done&&this.calculateSparsity(),this._subs.add(null===(i=n.state.$data)||void 0===i?void 0:i.subscribeToState((e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===p.LoadingState.Done&&this.calculateSparsity()}))))})))}togglePopover(){this.setState({showPopover:!this.state.showPopover})}calculateSparsity(){var e;const t=r.jh.getAncestor(this,a.Mn),n=(0,a.tn)(null===(e=t.state.$data)||void 0===e?void 0:e.state.data),i=null==n?void 0:n.fields.find((e=>"labels"===e.name)),s=r.jh.getData(this),o=(0,k.UX)(s,(e=>e instanceof r.dt),r.dt);if(o){const e=o.state.queries[0];(null==e?void 0:e.expr.includes("avg_over_time"))&&this.setState({hasNumericFilters:!0})}if(!i||!n)return void this.setState({hasSparseFilters:!1});const l=this.getVariable(),c=i.values.reduce(((e,t)=>((null==t?void 0:t[this.state.labelName])&&e++,e)),0),d=r.jh.getAncestor(this,r.Eb);if(void 0!==c&&n.length>0){const e=(c/n.length*100).toLocaleString(),t=`${this.state.labelName} exists on ${e}% of ${n.length} sampled log lines`;d.setState({description:t})}else d.setState({description:void 0});const p=this.getExistingFilter(l),h=p&&l.state.name===u.mB?(0,g.bu)(p):void 0;c<n.length||(null==h?void 0:h.value)===u.ZO?this.setState({hasSparseFilters:!0}):this.setState({hasSparseFilters:!1})}getVariable(){return this.state.fieldType===s._J.field?(0,g.ir)(this):this.state.labelName===u.e4?(0,g.iw)(this):(0,g.cR)(this)}constructor(e){super(_(P({},e),{showPopover:!1})),j(this,"onClickNumericFilter",(e=>{const t=(0,a.rD)(this),n=(0,L.ph)(this.state.labelName,t);if(!n||"string"===n||"boolean"===n||"int"===n){const e=new Error(`Incorrect field type: ${n}`);throw f.v.error(e,{msg:`onClickNumericFilter invalid field type ${n}`}),e}this.setState({popover:new O({labelName:this.state.labelName,variableType:e,fieldType:n})}),this.togglePopover()})),j(this,"onClickViewValues",(()=>{const e=r.jh.getAncestor(this,a.Mn);(0,i.fg)(this.state.fieldType,this.state.labelName,e)})),j(this,"onClickExcludeEmpty",(e=>{(0,d.Qt)(this.state.labelName,u.ZO,"exclude",this,e)})),j(this,"onClickIncludeEmpty",(e=>{(0,d.Qt)(this.state.labelName,u.ZO,"include",this,e)})),j(this,"clearFilter",(e=>{(0,d.Qt)(this.state.labelName,u.ZO,"clear",this,e)})),j(this,"clearFilters",(e=>{(0,d.hi)(this.state.labelName,this,e)})),this.addActivationHandler(this.onActivate.bind(this))}}function $(e){const t=(0,o.useStyles2)(A);return c().createElement("span",{className:t.description},e.selected&&c().createElement("span",{className:t.selected}),e.text)}j(N,"Component",(({model:e})=>{const{hideValueDrilldown:t,labelName:n,hasSparseFilters:r,hasNumericFilters:a,selectedValue:i,popover:d,showPopover:p,fieldType:v}=e.useState(),f=e.getVariable(),y=f.useState().name,S=e.getExistingFilter(f),w=(0,g.z2)(f,S),O=(0,o.useStyles2)(I),E=(0,l.useRef)(null),x=v===s._J.label&&0===f.state.filters.filter((e=>e.key!==n&&e.operator===h.w.Equal)).length,C=(null==S?void 0:S.operator)===h.w.NotEqual&&w.value===u.ZO,L=!!S;var k;const j=null!==(k=null==i?void 0:i.value)&&void 0!==k?k:C?T:a?D:T,N=!!(null==S?void 0:S.operator)&&[h.w.gte,h.w.gt,h.w.lte,h.w.lt].includes(S.operator),A=j===D||N,M=j===T&&!A,B={value:T,component:()=>c().createElement($,{selected:M,text:`Include all log lines with ${n}`})},R={value:F,component:()=>c().createElement($,{selected:!1,text:`Exclude all log lines with ${n}`})},V={value:D,component:()=>c().createElement($,{selected:A,text:`Add an expression, i.e. ${n} > 30`})},W=[];a&&W.push(V),r&&(N||W.push(B),W.push(R));const z=C?B:a?V:B;var H;return c().createElement(c().Fragment,null,L&&c().createElement(o.IconButton,{disabled:x,name:"filter",tooltip:`Clear ${n} filters`,onClick:()=>e.clearFilters(y)}),(a||r)&&c().createElement(c().Fragment,null,c().createElement(o.ButtonGroup,{"data-testid":b.b.breakdowns.common.filterButtonGroup},c().createElement(o.Button,{"data-testid":b.b.breakdowns.common.filterButton,ref:E,onClick:()=>e.onChange(null!=i?i:z),size:"sm",fill:"outline",variant:"secondary"},null!==(H=null==i?void 0:i.value)&&void 0!==H?H:z.value),c().createElement(o.ButtonSelect,{"data-testid":b.b.breakdowns.common.filterSelect,className:O.buttonSelect,variant:"default",options:W,onChange:t=>{e.onChange(t)}}))),!0!==t&&c().createElement(o.Button,{title:`View breakdown of values for ${n}`,variant:"primary",fill:"outline",size:"sm",onClick:e.onClickViewValues,"aria-label":`Select ${n}`},"Select"),d&&c().createElement(o.PopoverController,{content:c().createElement(d.Component,{model:d})},((e,t,n)=>{const r={onBlur:t,onFocus:e};return c().createElement(c().Fragment,null,E.current&&c().createElement(c().Fragment,null,c().createElement(o.Popover,P(_(P({},n,m.rest),{show:p,wrapperClassName:O.popover,referenceElement:E.current,renderArrow:!0}),r))))})))}));const A=e=>({selected:(0,v.css)({label:"selectable-value-selected","&:before":{content:'""',position:"absolute",left:0,top:"4px",height:"calc(100% - 8px)",width:"2px",backgroundColor:e.colors.warning.main}}),description:(0,v.css)({textAlign:"left",fontSize:e.typography.pxToRem(12)})}),I=e=>({popover:(0,v.css)({borderRadius:e.shape.radius.default,boxShadow:e.shadows.z3,background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`}),description:(0,v.css)({textAlign:"left",fontSize:e.typography.pxToRem(12)}),buttonSelect:(0,v.css)({border:`1px solid ${e.colors.border.strong}`,borderLeft:"none",borderTopLeftRadius:0,borderBottomLeftRadius:0,padding:1,height:"24px"})})},4144:(e,t,n)=>{n.d(t,{ee:()=>f,gf:()=>g,wd:()=>h});var r=n(7141),a=n(5959),i=n.n(a),s=n(7781),o=n(1383),l=n(2007),c=n(227),d=n(1220),u=n(5722);function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends s.BusEventBase{constructor(e,t,n){super(),p(this,"target",void 0),p(this,"sortBy",void 0),p(this,"direction",void 0),this.target=e,this.sortBy=t,this.direction=n}}p(g,"type","sort-criteria-changed");class h extends r.Bs{constructor(e){const{sortBy:t,direction:n}=(0,c.vs)(e.target,u.DEFAULT_SORT_BY,"desc");super({target:e.target,sortBy:t,direction:n}),p(this,"sortingOptions",[{label:"",options:[{value:"changepoint",label:"Most relevant",description:"Smart ordering of graphs based on the most significant spikes in the data"},{value:"outliers",label:"Outlying values",description:"Order by the amount of outlying values in the data"},{value:s.ReducerID.stdDev,label:"Widest spread",description:"Sort graphs by deviation from the average value"},{value:"alphabetical",label:"Name",description:"Alphabetical order"},{value:s.ReducerID.sum,label:"Count",description:"Sort graphs by total number of logs"},{value:s.ReducerID.max,label:"Highest spike",description:"Sort graphs by the highest values (max)"},{value:s.ReducerID.min,label:"Lowest dip",description:"Sort graphs by the smallest values (min)"}]},{label:"Percentiles",options:[...s.fieldReducers.selectOptions([],m).options]}]),p(this,"onCriteriaChange",(e=>{e.value&&(this.setState({sortBy:e.value}),(0,c.fq)(this.state.target,e.value,this.state.direction),this.publishEvent(new g(this.state.target,e.value,this.state.direction),!0))})),p(this,"onDirectionChange",(e=>{e.value&&(this.setState({direction:e.value}),(0,c.fq)(this.state.target,this.state.sortBy,e.value),this.publishEvent(new g(this.state.target,this.state.sortBy,e.value),!0))}))}}p(h,"Component",(({model:e})=>{const{sortBy:t,direction:n}=e.useState(),r=e.sortingOptions.find((e=>e.options.find((e=>e.value===t)))),a=null==r?void 0:r.options.find((e=>e.value===t));return i().createElement(i().Fragment,null,i().createElement(l.InlineField,{label:"Sort by",htmlFor:"sort-by-criteria",tooltip:"Calculate a derived quantity from the values in your time series and sort by this criteria. Defaults to standard deviation."},i().createElement(l.Select,{"data-testid":d.b.breakdowns.common.sortByFunction,value:a,width:20,isSearchable:!0,options:e.sortingOptions,placeholder:"Choose criteria",onChange:e.onCriteriaChange,inputId:"sort-by-criteria"})),i().createElement(l.InlineField,null,i().createElement(l.Select,{"data-testid":d.b.breakdowns.common.sortByDirection,onChange:e.onDirectionChange,"aria-label":"Sort direction",placeholder:"",value:n,options:[{label:"Asc",value:"asc"},{label:"Desc",value:"desc"}]})))}));const v=["p10","p25","p75","p90","p99"];function m(e){return e.id>="p1"&&e.id<="p99"&&v.includes(e.id)}function f(e){var t;return null!==(t=(0,o.H7)(e))&&void 0!==t?t:"No labels"}},9570:(e,t,n)=>{n.d(t,{O:()=>o});var r=n(6089),a=n(5959),i=n.n(a),s=n(2007);function o({blockingMessage:e,isLoading:t,children:n}){const r=(0,s.useStyles2)(l);return t&&!e&&(e="Loading..."),t?i().createElement(s.LoadingPlaceholder,{className:r.statusMessage,text:e}):e?i().createElement("div",{className:r.statusMessage},e):i().createElement(i().Fragment,null,n)}function l(e){return{statusMessage:(0,r.css)({fontStyle:"italic",marginTop:e.spacing(7),textAlign:"center"})}}},1752:(e,t,n)=>{n.d(t,{l:()=>r});const r=20},9254:(e,t,n)=>{n.d(t,{PY:()=>S,ZB:()=>b,zQ:()=>y});var r=n(6089),a=n(7141),i=n(2007),s=n(5959),o=n.n(s),l=n(227),c=n(688),d=n(2718),u=n(8760),p=n(7781),g=n(5587),h=n(8531),v=n(4011),m=n(2871);function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class b extends a.Bs{constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){f(e,t,n[t])}))}return e}({},e)),f(this,"handleWrapLinesChange",(e=>{this.getLogsPanelScene().setState({wrapLogMessage:e}),(0,l.YK)("wrapLogMessage",e),this.getLogsListScene().setLogsVizOption({wrapLogMessage:e}),this.getLogsListScene().setLogsVizOption({prettifyLogMessage:e})})),f(this,"onChangeLogsSortOrder",(e=>{this.getLogsPanelScene().setState({sortOrder:e}),(0,l.YK)("sortOrder",e),this.getLogsListScene().setLogsVizOption({sortOrder:e})})),f(this,"getLogsListScene",(()=>a.jh.getAncestor(this,c.i))),f(this,"getLogsPanelScene",(()=>a.jh.getAncestor(this,g.o))),f(this,"clearDisplayedFields",(()=>{this.getLogsListScene().clearDisplayedFields(),(0,d.EE)(d.NO.service_details,d.ir.service_details.logs_clear_displayed_fields)}))}}function y(){return(0,l.YM)("sortOrder",p.LogsSortOrder.Descending)}function S(){const e=h.locationService.getLocation(),t=new URLSearchParams(e.search).get("sortOrder");try{if("string"==typeof t){const e=(0,v.FH)(JSON.parse(t));if(e)return e}}catch(e){m.v.error(e,{msg:"LogOptionsScene(getLogsPanelSortOrderFromURL): unable to parse sortOrder"})}return!1}f(b,"Component",(function({model:e}){const{onChangeVisualizationType:t,visualizationType:n}=e.useState(),{wrapLogMessage:r,sortOrder:a}=e.getLogsPanelScene().useState(),{displayedFields:s}=e.getLogsListScene().useState(),l=(0,i.useStyles2)(w),c=null!=r&&r;return o().createElement("div",{className:l.container},s.length>0&&o().createElement(i.Tooltip,{content:`Clear displayed fields: ${s.join(", ")}`},o().createElement(i.Button,{size:"sm",variant:"secondary",fill:"outline",onClick:e.clearDisplayedFields},"Show original log line")),o().createElement(i.InlineField,{className:l.buttonGroupWrapper,transparent:!0},o().createElement(i.RadioButtonGroup,{size:"sm",options:[{label:"Newest first",value:p.LogsSortOrder.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:p.LogsSortOrder.Ascending,description:"Show results oldest to newest"}],value:a,onChange:e.onChangeLogsSortOrder})),o().createElement(i.InlineField,{className:l.buttonGroupWrapper,transparent:!0},o().createElement(i.RadioButtonGroup,{size:"sm",value:c,onChange:e.handleWrapLinesChange,options:[{label:"Wrap",value:!0,description:"Enable wrapping of long log lines"},{label:"No wrap",value:!1,description:"Disable wrapping of long log lines"}]})),o().createElement(u.C,{vizType:n,onChange:t}))}));const w=e=>({container:(0,r.css)({display:"flex",alignItems:"center",gap:e.spacing(1),marginTop:e.spacing(.5)}),buttonGroupWrapper:(0,r.css)({margin:0,alignItems:"center"})})},688:(e,t,n)=>{n.d(t,{i:()=>dt});var r=n(5959),a=n.n(r),i=n(7141),s=n(6089),o=n(2007),l=n(3241),c=n(1220),d=n(2718),u=n(6261);const p=e=>{const t=(0,o.useTheme2)(),n=e.caseSensitive?t.colors.text.maxContrast:t.colors.text.disabled,r=g(t,n);return a().createElement("span",{className:r.container,title:`Case ${e.caseSensitive?"insensitive":"sensitive"} search`},a().createElement("svg",{onClick:()=>e.onCaseSensitiveToggle(e.caseSensitive?"insensitive":"sensitive"),fill:n,width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},a().createElement("text",{fontSize:"13",width:"16",height:"16",x:"50%",y:"50%",dominantBaseline:"central",textAnchor:"middle"},"Aa")))},g=(e,t)=>({container:(0,s.css)({display:"flex",justifyContent:"center",marginLeft:e.spacing.x0_5,cursor:"pointer"})});var h=n(4750),v=n(227);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class f extends i.Bs{updateFilter(e,t=!0){this.setState({lineFilter:e}),t?this.updateVariableDebounced(e):this.updateVariable(e)}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){m(e,t,n[t])}))}return e}({lineFilter:(null==e?void 0:e.lineFilter)||"",caseSensitive:(0,v.hp)(!1)},e)),m(this,"onActivate",(()=>{const e=(0,h.Rr)(this).getValue(),t=e.toString();if(!e)return;const n=t.includes("|="),r=n?t.match(/\|=.`(.+?)`/):t.match(/`\(\?i\)(.+)`/);r&&2===r.length&&this.setState({lineFilter:r[1].replace(/\\(.)/g,"$1"),caseSensitive:n})})),m(this,"handleChange",(e=>{this.updateFilter(e.target.value)})),m(this,"handleEnter",(e=>{"Enter"===e.key&&this.updateVariable(this.state.lineFilter)})),m(this,"onCaseSensitiveToggle",(e=>{const t="sensitive"===e;this.setState({caseSensitive:t}),(0,v.Xo)(t),this.updateFilter(this.state.lineFilter,!1)})),m(this,"updateVariableDebounced",(0,l.debounce)((e=>{this.updateVariable(e)}),1e3)),m(this,"updateVariable",(e=>{const t=(0,h.Rr)(this);""===e?t.changeValueTo(""):this.state.caseSensitive?t.changeValueTo(`|= \`${(0,l.escapeRegExp)(e)}\``):t.changeValueTo(`|~ \`(?i)${(0,l.escapeRegExp)(e)}\``),(0,d.EE)(d.NO.service_details,d.ir.service_details.search_string_in_logs_changed,{searchQueryLength:e.length,containsLevel:e.toLowerCase().includes("level")})})),this.addActivationHandler(this.onActivate)}}m(f,"Component",(function({model:e}){const{lineFilter:t,caseSensitive:n}=e.useState();return a().createElement(o.Field,{className:b.field},a().createElement(u.D,{"data-testid":c.b.exploreServiceDetails.searchLogs,value:t,className:b.input,onChange:e.handleChange,suffix:a().createElement(p,{caseSensitive:n,onCaseSensitiveToggle:e.onCaseSensitiveToggle}),placeholder:"Search in log lines",onClear:()=>{e.updateFilter("",!1)},onKeyUp:e.handleEnter}))}));const b={input:(0,s.css)({width:"100%"}),field:(0,s.css)({label:"field",width:"100%",marginBottom:0})};var y=n(7781),S=n(9186),w=n(2871),O=n(8831),E=n(4011);function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}const L=`${O.s_}.tableColumnWidths`;var k=function(e){return e.text="text",e.labels="labels",e.auto="auto",e}({});const j=(0,r.createContext)({columnWidthMap:{},setColumnWidthMap:()=>{},columns:{},filteredColumns:{},setColumns:()=>{},setFilteredColumns:()=>{},setVisible:()=>!1,visible:!1,bodyState:"auto",setBodyState:()=>{},clearSelectedLine:()=>{}}),P=({children:e,initialColumns:t,logsFrame:n,setUrlColumns:i,clearSelectedLine:s,setUrlTableBodyState:o,urlTableBodyState:l})=>{const[c,d]=(0,r.useState)(_(t)),[u,p]=(0,r.useState)(null!=l?l:"auto"),[g,h]=(0,r.useState)(void 0),[v,m]=(0,r.useState)(!1),f=function(){let e={};const t=localStorage.getItem(L);if(t)try{return e=(0,E.Zt)(JSON.parse(t)),!1===e&&w.v.error(new E.QX("getColumnWidthsFromLocalStorage: unable to validate values in local storage"),{msg:"NarrowingError: error parsing table column widths from local storage"}),e}catch(e){w.v.error(e,{msg:"error parsing table column widths from local storage"})}return e}(),[b,y]=(0,r.useState)(f),O=(0,r.useCallback)((e=>{if(e){const t=_(e);d(t),i((e=>{let t=[];return Object.keys(e).forEach((n=>{e[n].active&&void 0!==e[n].index&&t.push(n)})),t.sort(((t,n)=>{const r=e[t],a=e[n];return r.index-a.index})),t})(t))}}),[i]),x=(0,r.useCallback)((e=>{p(e),o(e)}),[o]),k=(0,r.useCallback)((e=>{m(e)}),[]);return(0,r.useEffect)((()=>{t&&O(t)}),[t,O]),(0,r.useEffect)((()=>{const e=function(e,t){if(!t)return void w.v.warn("missing dataframe, cannot set url state");const n=Object.keys(e).filter((t=>{var n;return null===(n=e[t])||void 0===n?void 0:n.active})).sort(((t,n)=>{const r=e[t],a=e[n];return void 0!==r.index&&void 0!==a.index?r.index-a.index:0})),r=t.timeField,a=t.bodyField;if(r&&a||n.length){const e=[];return(null==r?void 0:r.name)&&e.push(r.name),(null==a?void 0:a.name)&&e.push(a.name),n.length?n:e}return[]}(c,n);(null==e?void 0:e.length)&&(0===Object.keys(c).filter((e=>c[e].active)).length&&function(e,t,n){const r=C({},e);r[(0,S.fF)(n)]={index:0,active:!0,type:"TIME_FIELD",percentOfLinesWithLabel:100,cardinality:1/0},r[(0,S.Il)(n)]={index:1,active:!0,type:"BODY_FIELD",percentOfLinesWithLabel:100,cardinality:1/0},t(r)}(c,O,n),h(void 0))}),[c,n,h,O]),a().createElement(j.Provider,{value:{setColumnWidthMap:e=>{localStorage.setItem(L,JSON.stringify(e)),y(e)},columnWidthMap:b,bodyState:u,setBodyState:x,setFilteredColumns:h,filteredColumns:g,columns:c,setColumns:O,visible:v,setVisible:k,clearSelectedLine:()=>{s()}}},e)},_=e=>{if("labelTypes"in e){const t=C({},e),{labelTypes:n}=t;return function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(t,["labelTypes"])}return e},T=()=>(0,r.useContext)(j);var F=n(3367),D=n(1269),N=n(8531),$=n(3321);const A=(0,r.createContext)({cellIndex:{index:null,numberOfMenuItems:3},setActiveCellIndex:e=>!1}),I=({children:e})=>{const[t,n]=(0,r.useState)({index:null}),i=(0,r.useCallback)((e=>{n(e)}),[]);return a().createElement(A.Provider,{value:{cellIndex:t,setActiveCellIndex:i}},e)},M=()=>(0,r.useContext)(A),B=(0,r.createContext)({isHeaderMenuActive:!1,setHeaderMenuActive:e=>!1}),R=({children:e})=>{const[t,n]=(0,r.useState)(!1),i=(0,r.useCallback)((e=>{n(e)}),[]);return a().createElement(B.Provider,{value:{isHeaderMenuActive:t,setHeaderMenuActive:i}},e)},V=()=>(0,r.useContext)(B);var W=n(4932);function z({searchValue:e,setSearchValue:t}){const{columns:n,setFilteredColumns:r}=T(),i=e=>{const t=e[0];let a={},i=0;var s;t.forEach((e=>{e in n&&(a[e]=n[e],i++)})),r(a),s=i,(0,N.reportInteraction)("grafana_logs_app_table_text_search_result_count",{resultCount:s})},l=(c=(0,o.useTheme2)(),{searchWrap:(0,s.css)({padding:`${c.spacing(.4)} 0 ${c.spacing(.4)} ${c.spacing(.4)}`})});var c;return a().createElement(o.Field,{className:l.searchWrap},a().createElement(o.Input,{value:e,type:"text",placeholder:"Search fields by name",onChange:e=>{var a;const s=null===(a=e.currentTarget)||void 0===a?void 0:a.value;var o;t(s),s?(o=s,(0,W.E)(Object.keys(n),o,i)):r(void 0)}}))}var H=n(5755),U=n(5786);function G(){const e=(t=(0,o.useTheme2)(),{empty:(0,s.css)({marginBottom:t.spacing(2),marginLeft:t.spacing(1.75),fontSize:t.typography.fontSize})});var t;return a().createElement("div",{className:e.empty},"No fields")}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e){var t=function(e){if("object"!==J(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!==J(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===J(t)?t:String(t)}function J(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function K(e){const t=(n=(0,o.useTheme2)(),{dragIcon:(0,s.css)({cursor:"drag",marginLeft:n.spacing(1),opacity:.4}),labelCount:(0,s.css)({marginLeft:n.spacing(.5),marginRight:n.spacing(.5),appearance:"none",background:"none",border:"none",fontSize:n.typography.pxToRem(11),opacity:.6,display:"flex",flexDirection:"column",alignItems:"self-end"}),contentWrap:(0,s.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}),customWidthWrap:(0,s.css)({fontSize:n.typography.bodySmall.fontSize,cursor:"pointer"}),checkboxLabel:(0,s.css)({"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",maxWidth:"100%"}})});var n,r,i,l,c,d,u,p;return e.labels[e.label]?a().createElement(a().Fragment,null,a().createElement("div",{className:t.contentWrap},a().createElement(o.Checkbox,{className:t.checkboxLabel,label:e.label,onChange:e.onChange,checked:null!==(p=null===(r=e.labels[e.label])||void 0===r?void 0:r.active)&&void 0!==p&&p}),e.showCount&&a().createElement("div",{className:t.labelCount},a().createElement("div",null,null===(i=e.labels[e.label])||void 0===i?void 0:i.percentOfLinesWithLabel,"%"),a().createElement("div",null,null===(l=e.labels[e.label])||void 0===l?void 0:l.cardinality," ",1===(null===(c=e.labels[e.label])||void 0===c?void 0:c.cardinality)?"value":"values")),e.columnWidthMap&&e.setColumnWidthMap&&void 0!==(null===(d=e.columnWidthMap)||void 0===d?void 0:d[e.label])&&a().createElement("div",{onClick:()=>{var t;const n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){q(e,t,n[t])}))}return e}({},e.columnWidthMap),r=e.label,{[r]:a}=n,i=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(n,[r].map(Q));null===(t=e.setColumnWidthMap)||void 0===t||t.call(e,i)},title:"Clear column width override",className:t.customWidthWrap},"Width: ",null===(u=e.columnWidthMap)||void 0===u?void 0:u[e.label],a().createElement(o.Icon,{name:"x"}))),e.draggable&&a().createElement(o.Icon,{"aria-label":"Drag and drop icon",title:"Drag and drop to reorder",name:"draggabledots",size:"lg",className:t.dragIcon})):null}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Y(e,t,n[t])}))}return e}function Z(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const ee=e=>{const{columnWidthMap:t,setColumnWidthMap:n}=T(),{reorderColumn:r,labels:i,valueFilter:o,toggleColumn:l}=e,c=(0,U.$j)(),{columns:d}=T(),u=function(e){return{wrap:(0,s.css)({marginTop:e.spacing(1),marginBottom:e.spacing(1),display:"flex",background:e.colors.background.primary}),dragging:(0,s.css)({background:e.colors.background.secondary}),columnWrapper:(0,s.css)({marginBottom:e.spacing(1.5),paddingLeft:e.spacing(.5)})}}(c),p=Object.keys(i).filter((e=>o(e))),g=e=>{const t=i[e];if(t)return`${e} appears in ${null==t?void 0:t.percentOfLinesWithLabel}% of log lines`};return p.length?a().createElement(H.JY,{onDragEnd:e=>{e.destination&&r(d,e.source.index,e.destination.index)}},a().createElement(H.gL,{droppableId:"order-fields",direction:"vertical"},(e=>a().createElement("div",Z(X({className:u.columnWrapper},e.droppableProps),{ref:e.innerRef}),p.sort(function(e){return(t,n)=>{const r=e[t],a=e[n];return null!=r.index&&null!=a.index?r.index-a.index:0}}(i)).map(((e,r)=>a().createElement(H.sx,{draggableId:e,key:e,index:r},((r,o)=>a().createElement("div",Z(X({className:(0,s.cx)(u.wrap,o.isDragging?u.dragging:void 0),ref:r.innerRef},r.draggableProps,r.dragHandleProps),{title:g(e)}),a().createElement(K,{setColumnWidthMap:n,columnWidthMap:t,label:e,onChange:()=>l(e),labels:i,draggable:!0})))))),e.placeholder)))):a().createElement(G,null)},te=new Intl.Collator(void 0,{sensitivity:"base"}),ne=e=>{const{labels:t,valueFilter:n,toggleColumn:r}=e,i=(c=(0,o.useTheme2)(),{wrap:(0,s.css)({marginTop:c.spacing(.25),marginBottom:c.spacing(.25),display:"flex",background:c.colors.background.primary,borderBottom:`1px solid ${c.colors.background.canvas}`}),dragging:(0,s.css)({background:c.colors.background.secondary}),columnWrapper:(0,s.css)({marginBottom:c.spacing(1.5),paddingLeft:c.spacing(.5)})}),l=Object.keys(t).filter((e=>n(e)));var c;return l.length?a().createElement("div",{className:i.columnWrapper},l.sort(function(e){return(t,n)=>{const r=e[t],a=e[n];return null!=r&&null!=a?Number("TIME_FIELD"===a.type)-Number("TIME_FIELD"===r.type)||Number("BODY_FIELD"===a.type)-Number("BODY_FIELD"===r.type)||te.compare(t,n):0}}(t)).map((e=>{var n;return a().createElement("div",{key:e,className:i.wrap,title:`${e} appears in ${null===(n=t[e])||void 0===n?void 0:n.percentOfLinesWithLabel}% of log lines`},a().createElement(K,{showCount:!0,label:e,onChange:()=>r(e),labels:t}))}))):a().createElement(G,null)},re=e=>{const t=(n=(0,o.useTheme2)(),{sidebarWrap:(0,s.css)({overflowY:"scroll",height:"calc(100% - 50px)","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"}),columnHeaderButton:(0,s.css)({appearance:"none",background:"none",border:"none",fontSize:n.typography.pxToRem(11)}),columnHeader:(0,s.css)({display:"flex",justifyContent:"space-between",fontSize:n.typography.h6.fontSize,background:n.colors.background.secondary,position:"sticky",top:0,left:0,paddingTop:n.spacing(.75),paddingRight:n.spacing(.75),paddingBottom:n.spacing(.75),paddingLeft:n.spacing(1.5),zIndex:3,marginBottom:n.spacing(2)})});var n,r,i;return a().createElement("div",{className:t.sidebarWrap},a().createElement(a().Fragment,null,a().createElement("div",{className:t.columnHeader},"Selected fields",a().createElement("button",{onClick:e.clear,className:t.columnHeaderButton},"Reset")),a().createElement(ee,{reorderColumn:e.reorderColumn,toggleColumn:e.toggleColumn,labels:null!==(r=e.filteredColumnsWithMeta)&&void 0!==r?r:e.columnsWithMeta,valueFilter:t=>{var n,r;return null!==(r=null===(n=e.columnsWithMeta[t])||void 0===n?void 0:n.active)&&void 0!==r&&r},id:"selected-fields"}),a().createElement("div",{className:t.columnHeader},"Fields"),a().createElement(ne,{toggleColumn:e.toggleColumn,labels:null!==(i=e.filteredColumnsWithMeta)&&void 0!==i?i:e.columnsWithMeta,valueFilter:t=>{var n;return!(null===(n=e.columnsWithMeta[t])||void 0===n?void 0:n.active)}})))};function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ae(e,t,n[t])}))}return e}function se(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function oe(e){return(t,n,r)=>{if(n===r)return;const a=ie({},t),i=Object.keys(a).filter((e=>a[e].active)).map((e=>{var t;return{fieldName:e,index:null!==(t=a[e].index)&&void 0!==t?t:0}})).sort(((e,t)=>e.index-t.index)),[s]=i.splice(n,1);i.splice(r,0,s),i.filter((e=>void 0!==e)).forEach(((e,t)=>{a[e.fieldName].index=t})),e(a)}}function le(){const{columns:e,setColumns:t,setVisible:n,filteredColumns:i,setFilteredColumns:s}=T(),[l,c]=(0,r.useState)(""),d=oe(t);return a().createElement(o.ClickOutsideWrapper,{onClick:()=>{n(!1),s(e),c("")},useCapture:!0},a().createElement(z,{searchValue:l,setSearchValue:c}),a().createElement(re,{toggleColumn:n=>{if(!e||!(n in e))return void function(e,t){let n;try{n={columns:JSON.stringify(t),columnName:e}}catch(t){n={msg:"Table: ColumnSelectionDrawerWrap failed to encode context",columnName:e}}w.v.warn("failed to get column",n)}(n,e);const r=Object.keys(e).filter((t=>e[t].active)).length,a=!e[n].active||void 0;let o;if(o=se(ie({},e),a?{[n]:se(ie({},e[n]),{active:a,index:r})}:{[n]:se(ie({},e[n]),{active:!1,index:void 0})}),function(t){if(e){var n,r;const a=!(null===(n=e[t])||void 0===n?void 0:n.active),i=null===(r=Object.keys(e).filter((t=>{var n;return null===(n=e[t])||void 0===n?void 0:n.active})))||void 0===r?void 0:r.length,s={columnAction:a?"add":"remove",columnCount:a?i+1:i-1};(0,N.reportInteraction)("grafana_logs_app_table_column_filter_clicked",s)}}(n),t(o),i){var l;const e=!(null===(l=i[n])||void 0===l?void 0:l.active);let t;t=se(ie({},i),e?{[n]:se(ie({},i[n]),{active:e,index:r})}:{[n]:se(ie({},i[n]),{active:!1,index:void 0})}),s(t),c("")}},filteredColumnsWithMeta:i,columnsWithMeta:e,clear:()=>{const n=ie({},e);let r=0;Object.keys(n).forEach((e=>{const t="BODY_FIELD"===n[e].type||"TIME_FIELD"===n[e].type;n[e].active=t,n[e].index=t?r++:void 0})),t(n),s(n),c("")},reorderColumn:d}))}const ce=e=>a().createElement(de,{onMouseOut:e.onMouseOut,onMouseIn:e.onMouseIn,onClick:e.onClick,field:e.field,rowIndex:e.rowIndex},e.children),de=e=>{var t;const n=(0,o.useTheme2)(),r=M(),i=(e=>({active:(0,s.css)({height:"calc(100% + 36px)",zIndex:e.zIndex.tooltip,background:"transparent"}),wrap:(0,s.css)({position:"absolute",overflowX:"hidden",whiteSpace:"nowrap",width:"100%",height:"100%",left:0,top:0,margin:"auto",background:"transparent"})}))(n,0,null===(t=r.cellIndex)||void 0===t||t.numberOfMenuItems);return a().createElement("div",{onMouseLeave:e.onMouseOut,onMouseEnter:e.onMouseIn,onClick:e.onClick,className:r.cellIndex.index===e.rowIndex&&r.cellIndex.fieldName===e.field.name?(0,s.cx)(i.wrap,i.active):i.wrap},e.children)},ue={logsFrame:null,addFilter:e=>{},timeRange:void 0,selectedLine:void 0},pe=(0,r.createContext)(ue),ge=({children:e,logsFrame:t,addFilter:n,selectedLine:r,timeRange:i})=>a().createElement(pe.Provider,{value:{logsFrame:t,addFilter:n,selectedLine:r,timeRange:i}},e),he=()=>(0,r.useContext)(pe);var ve=n(4793);const me=e=>{const t=(r=(0,o.useTheme2)(),i=e.pillType,{menu:(0,s.css)({position:"relative",paddingRight:"5px",display:"flex",minWidth:"60px",justifyContent:"flex-start"}),menuItemsWrap:(0,s.css)({boxShadow:r.shadows.z3,display:"flex",background:r.colors.background.secondary,padding:"5px 0",marginLeft:"column"===i?"5px":void 0}),menuItem:(0,s.css)({overflow:"auto",textOverflow:"ellipsis",cursor:"pointer",paddingLeft:"5px",paddingRight:"5px",display:"flex",alignItems:"center"})}),{addFilter:n}=he();var r,i;return a().createElement("span",{className:t.menu},a().createElement("span",{className:t.menuItemsWrap},"derived"!==e.fieldType&&a().createElement(a().Fragment,null,a().createElement("div",{className:t.menuItem,onClick:()=>{n({key:e.label,value:e.value,operator:ve.w.Equal})}},a().createElement(o.Icon,{title:"Add to search",size:"md",name:"plus-circle"})),a().createElement("div",{className:t.menuItem,onClick:()=>{n({key:e.label,value:e.value,operator:ve.w.NotEqual})}},a().createElement(o.Icon,{title:"Exclude from search",size:"md",name:"minus-circle"}))),e.showColumn&&a().createElement("div",{title:"Add column",onClick:e.showColumn,className:t.menuItem},a().createElement("svg",{width:"18",height:"16",viewBox:"0 0 18 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.38725 1.33301H13.3872C13.5641 1.33301 13.7336 1.40325 13.8587 1.52827C13.9837 1.65329 14.0539 1.82286 14.0539 1.99967V2.33333C14.0539 2.70152 13.7554 3 13.3872 3H13.0542C12.87 3 12.7206 2.85062 12.7206 2.66634H8.05391V13.333H12.7206C12.7206 13.1491 12.8697 13 13.0536 13H13.3872C13.7554 13 14.0539 13.2985 14.0539 13.6667V13.9997C14.0539 14.1765 13.9837 14.3461 13.8587 14.4711C13.7336 14.5961 13.5641 14.6663 13.3872 14.6663H1.38725C1.21044 14.6663 1.04087 14.5961 0.915843 14.4711C0.790819 14.3461 0.720581 14.1765 0.720581 13.9997V1.99967C0.720581 1.82286 0.790819 1.65329 0.915843 1.52827C1.04087 1.40325 1.21044 1.33301 1.38725 1.33301ZM2.05391 13.333H6.72058V2.66634H2.05391V13.333Z",fill:"#CCCCDC",fillOpacity:"1"}),a().createElement("path",{d:"M13.8538 7.19999H16.2538C16.466 7.19999 16.6695 7.28429 16.8195 7.4343C16.9696 7.58432 17.0538 7.78783 17.0538 7.99999C17.0538 8.21214 16.9696 8.41566 16.8195 8.56567C16.6695 8.71569 16.466 8.79999 16.2538 8.79999H13.8538V11.2C13.8538 11.4121 13.7696 11.6156 13.6195 11.7657C13.4695 11.9157 13.266 12 13.0538 12C12.8416 12 12.6382 11.9157 12.4881 11.7657C12.3381 11.6156 12.2538 11.4121 12.2538 11.2V8.79999H9.85384C9.64165 8.79999 9.43819 8.71569 9.28815 8.56567C9.13811 8.41566 9.05383 8.21214 9.05383 7.99999C9.05383 7.78783 9.13811 7.58432 9.28815 7.4343C9.43819 7.28429 9.64165 7.19999 9.85384 7.19999H12.2538V4.8C12.2538 4.58784 12.3381 4.38433 12.4881 4.23431C12.6382 4.0843 12.8416 4 13.0538 4C13.266 4 13.4695 4.0843 13.6195 4.23431C13.7696 4.38433 13.8538 4.58784 13.8538 4.8V7.19999Z",fill:"#CCCCDC",fillOpacity:"1"}))),e.links&&e.links.map((e=>{var n;return a().createElement("div",{className:t.menuItem,onClick:()=>{window.open(e.href,"_blank")},key:e.href},a().createElement(o.Icon,{title:null!==(n=e.title)&&void 0!==n?n:"Link",key:e.href,size:"md",name:"link"}))}))))},fe="detected_level",be=e=>{const{label:t,value:n}=e,r=(0,o.useTheme2)(),{cellIndex:i}=M();let l;if(t===fe){const e=We().options;"string"==typeof n&&n in e&&(l=e[n].color)}const c=i.index===e.rowIndex&&e.field.name===i.fieldName,d=((e,t)=>({activePillWrap:(0,s.css)({}),pillWrap:(0,s.css)({width:"100%"}),pill:(0,s.css)({border:`1px solid ${e.colors.border.weak}`,"&:hover":{border:`1px solid ${e.colors.border.strong}`},marginRight:"5px",marginTop:"4px",marginLeft:"5px",padding:"2px 5px",position:"relative",display:"inline-flex",flexDirection:"row-reverse",backgroundColor:"transparent",paddingLeft:t?`${e.spacing(.75)}`:"2px","&:before":{content:'""',position:"absolute",left:0,top:0,height:"100%",width:`${e.spacing(.25)}`,backgroundColor:t}}),menu:(0,s.css)({width:"100%"}),menuItem:(0,s.css)({overflow:"auto",textOverflow:"ellipsis"}),menuItemText:(0,s.css)({width:"65px",display:"inline-block"})}))(r,l);return a().createElement("div",{className:(0,s.cx)(d.pillWrap,c?d.activePillWrap:void 0)},!!n&&a().createElement(a().Fragment,null,a().createElement("span",{className:d.pill},a().createElement(a().Fragment,null,n)),c&&"string"==typeof n&&e.field.type!==y.FieldType.time&&a().createElement(me,{label:e.label,value:n,pillType:"column"})))};var ye=n(8315);function Se(e){var t;const n=(v=(0,o.useTheme2)(),{clipboardButton:(0,s.css)({padding:0,height:"100%",lineHeight:"1",width:"20px"}),inspectButton:(0,s.css)({display:"inline-flex",verticalAlign:"middle",margin:0,overflow:"hidden",borderRadius:"5px"}),iconWrapper:(0,s.css)({height:"35px",position:"sticky",left:0,display:"flex",background:v.colors.background.secondary,padding:`0 ${v.spacing(.5)}`,zIndex:1,boxShadow:v.shadows.z2}),inspect:(0,s.css)({padding:"5px 3px","&:hover":{color:v.colors.text.link,cursor:"pointer"}})}),{logsFrame:i,timeRange:l}=he(),d=null==i||null===(t=i.idField)||void 0===t?void 0:t.values[e.rowIndex],u=null==i?void 0:i.bodyField.values[e.rowIndex],[p,g]=(0,r.useState)(!1),h=(0,r.useCallback)((()=>l?(0,ye.gW)("selectedLine",{id:d,row:e.rowIndex},l):""),[d,e.rowIndex,l]);var v;return a().createElement(a().Fragment,null,a().createElement("div",{className:n.iconWrapper},a().createElement("div",{className:n.inspect},a().createElement(o.IconButton,{"data-testid":c.b.table.inspectLine,className:n.inspectButton,tooltip:"View log line",variant:"secondary","aria-label":"View log line",tooltipPlacement:"top",size:"md",name:"eye",onClick:()=>g(!0),tabIndex:0})),a().createElement("div",{className:n.inspect},a().createElement(o.ClipboardButton,{className:n.clipboardButton,icon:"share-alt",variant:"secondary",fill:"text",size:"md",tooltip:"Copy link to log line",tooltipPlacement:"top",tabIndex:0,getText:h}))),a().createElement(a().Fragment,null,p&&a().createElement(o.Modal,{onDismiss:()=>g(!1),isOpen:!0,title:"Inspect value"},a().createElement("pre",null,u),a().createElement(o.Modal.ButtonRow,null,a().createElement(o.ClipboardButton,{icon:"copy",getText:()=>e.value},"Copy to Clipboard")))))}const we=e=>{var t;let n=e.value;const r=e.field,i=r.display(n),l=(h=(0,o.useTheme2)(),v=e.field.type,{flexWrap:(0,s.css)({display:"flex",alignItems:"flex-start",flexDirection:v===y.FieldType.number?"row-reverse":"row",textAlign:v===y.FieldType.number?"right":"left"}),content:(0,s.css)({position:"relative",overflow:"hidden",display:"flex",height:"100%"}),linkWrapper:(0,s.css)({color:h.colors.text.link,marginTop:"7px",marginLeft:"7px","&:hover":{textDecoration:"underline"}})}),{setVisible:c}=T(),{cellIndex:d,setActiveCellIndex:u}=M(),p={index:e.rowIndex},g=Boolean(null===(t=(0,o.getCellLinks)(e.field,p))||void 0===t?void 0:t.length);var h,v;return null===n?a().createElement(a().Fragment,null):(n=a().isValidElement(e.value)?e.value:"object"==typeof n?JSON.stringify(e.value):(0,y.formattedValueToString)(i),a().createElement(ce,{onClick:()=>e.rowIndex===d.index&&e.field.name===d.fieldName?u({index:null}):u({index:e.rowIndex,fieldName:e.field.name,numberOfMenuItems:3}),field:e.field,rowIndex:e.rowIndex},a().createElement("div",{className:l.content},0===e.fieldIndex&&a().createElement(Se,{value:n,rowIndex:e.rowIndex}),a().createElement("div",{className:l.flexWrap}),!g&&((t,n)=>a().createElement(be,{field:e.field,rowIndex:e.rowIndex,showColumns:()=>c(!0),label:n,value:t}))(n,r.name),g&&r.getLinks&&a().createElement(o.DataLinksContextMenu,{links:()=>{var e;return null!==(e=(0,o.getCellLinks)(r,p))&&void 0!==e?e:[]}},(e=>e.openMenu?a().createElement("div",{className:l.linkWrapper,onClick:e.openMenu},a().createElement(a().Fragment,null,n)):a().createElement("div",{className:l.linkWrapper},a().createElement(a().Fragment,null,n)))))))};function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ee(e){const t=(0,o.useTheme2)();let n;if(e.label===fe){const t=We().options;e.value in t&&(n=t[e.value].color)}const r=((e,t)=>({pill:(0,s.css)({flex:"0 1 auto",marginLeft:e.spacing(.5),marginRight:e.spacing(.5),padding:`${e.spacing(.25)} ${e.spacing(.25)}`,position:"relative",display:"inline-flex",flexDirection:"column",marginTop:e.spacing(.5)}),activePill:(0,s.css)({}),valueWrap:(0,s.css)({border:`1px solid ${e.colors.background.secondary}`,boxShadow:`-2px 2px 5px 0px ${e.colors.background.secondary}`,backgroundColor:"transparent",cursor:"pointer",position:"relative",paddingRight:`${e.spacing(.5)}`,paddingLeft:t?`${e.spacing(.75)}`:`${e.spacing(.5)}`,"&:before":{content:'""',position:"absolute",left:0,top:0,height:"100%",width:`${e.spacing(.25)}`,backgroundColor:t},"&:hover":{border:`1px solid ${e.colors.border.strong}`}})}))(t,n);return a().createElement("span",{className:(0,s.cx)(r.pill,e.menuActive?r.activePill:void 0),onClick:e.onClick},a().createElement("span",{className:r.valueWrap},e.label,"=",e.value),e.menuActive&&a().createElement(me,{pillType:"logPill",fieldType:e.fieldType,links:e.links,label:e.label,value:e.value,showColumn:e.onClickAdd}))}const xe=e=>{const{label:t}=e,{cellIndex:n,setActiveCellIndex:i}=M(),{columns:s,setColumns:l}=T(),c=e.value,d=(0,N.getTemplateSrv)(),u=(0,r.useMemo)((()=>d.replace.bind(d)),[d]),p=e.field;if(!p||(null==p?void 0:p.type)===y.FieldType.other)return null;const g={index:e.rowIndex};e.originalField&&e.isDerivedField&&e.originalFrame&&(e.originalField.getLinks=(0,y.getLinksSupplier)(e.originalFrame,e.originalField,{},u));const h=e.originalField&&(0,o.getCellLinks)(e.originalField,g);return a().createElement(Ee,{onClick:()=>e.rowIndex===n.index&&p.name===n.fieldName&&t===n.subFieldName?i({index:null}):i({index:e.rowIndex,fieldName:p.name,subFieldName:t,numberOfMenuItems:e.isDerivedField?2:3}),menuActive:n.index===e.rowIndex&&n.fieldName===p.name&&n.subFieldName===t,fieldType:e.isDerivedField?"derived":void 0,label:t,value:c,onClickAdd:()=>(e=>{const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Oe(e,t,n[t])}))}return e}({},s),n=Object.keys(s).filter((e=>s[e].active)).length;t[e].active?(t[e].active=!1,t[e].index=void 0):(t[e].active=!0,t[e].index=n),l(t)})(t),links:h})},Ce=e=>{var t,n;null==e||null===(n=e.current)||void 0===n||n.scrollTo({left:null===(t=e.current)||void 0===t?void 0:t.scrollLeft})};function Le({scrollerRef:e}){const t=(n=(0,o.useTheme2)(),{scroller:s.css`
    position: absolute;
    right: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 20px;
    top: 32px;
    margin-top: -24px;
    // For some reason clicking on this button causes text to be selected in the following row
    user-select: none;
  `,scrollLeft:s.css`
    cursor: pointer;
    background: ${n.colors.background.primary};

    &:hover {
      background: ${n.colors.background.secondary};
    }
  `,scrollRight:s.css`
    cursor: pointer;
    background: ${n.colors.background.primary};

    &:hover {
      background: ${n.colors.background.secondary};
    }
  `});var n;return a().createElement("div",{className:t.scroller},a().createElement("span",{onPointerDown:()=>{var t,n;null==(t=e)||null===(n=t.current)||void 0===n||n.scrollTo({top:0,left:0,behavior:"smooth"})},onPointerUp:()=>Ce(e),className:t.scrollLeft},a().createElement(o.Icon,{name:"arrow-left"})),a().createElement("span",{onPointerDown:()=>{var t,n;null==(t=e)||null===(n=t.current)||void 0===n||n.scrollTo({top:0,left:t.current.scrollWidth,behavior:"smooth"})},onPointerUp:()=>Ce(e),className:t.scrollRight},a().createElement(o.Icon,{name:"arrow-right"})))}function ke(e){const t=(0,o.useTheme2)(),n=je(t);return a().createElement("div",{"data-testid":c.b.table.rawLogLine,className:n.rawLogLine},a().createElement(a().Fragment,null,e.value))}const je=(e,t)=>({rawLogLine:(0,s.css)({fontFamily:e.typography.fontFamilyMonospace,height:"35px",lineHeight:"35px",paddingRight:e.spacing(1.5),paddingLeft:e.spacing(1),fontSize:e.typography.bodySmall.fontSize})}),Pe=e=>{let t=e.value;const n=e.field,i=n.display(t),s=(0,o.useTheme2)(),l=_e(s),{columns:c,setVisible:d,bodyState:u}=T(),{logsFrame:p}=he(),[g,h]=(0,r.useState)(!1),v=(0,r.useRef)(null);t=a().isValidElement(e.value)?e.value:"object"==typeof t?JSON.stringify(e.value):(0,y.formattedValueToString)(i);const m=(t=>Object.keys(c).filter((e=>e!==(0,S.Il)(p))).sort(((e,t)=>e===fe?-1:t===fe?1:"LINK_FIELD"===c[e].type?-1:"LINK_FIELD"===c[t].type?1:c[e].cardinality>c[t].cardinality?-1:1)).filter((e=>!c[e].active&&c[e].cardinality>1)).map((r=>{var i;const s=t[r],o=null==p||null===(i=p.raw)||void 0===i?void 0:i.fields.find((e=>e.name===r)),l=null==n?void 0:n.values[e.rowIndex],u=!s&&!!l;if(s)return a().createElement(xe,{originalFrame:void 0,field:n,columns:c,rowIndex:e.rowIndex,frame:e.frame,showColumns:()=>d(!0),key:r,label:r,isDerivedField:!1,value:s});if(u&&(null==o?void 0:o.name)){const t=null==o?void 0:o.values[e.rowIndex];if((null==o?void 0:o.type)===y.FieldType.string&&t)return a().createElement(xe,{originalFrame:null==p?void 0:p.raw,originalField:o,field:n,value:t,columns:c,rowIndex:e.rowIndex,frame:e.frame,showColumns:()=>d(!0),key:o.name,label:o.name,isDerivedField:!0})}return null})).filter((e=>e)))(e.labels),f=u===k.auto,b=m.length>0;return a().createElement(ce,{onMouseIn:()=>{h(!0)},onMouseOut:()=>{h(!1)},rowIndex:e.rowIndex,field:e.field},a().createElement(F.ScrollSyncPane,{innerRef:v,group:"horizontal"},a().createElement("div",{className:l.content},0===e.fieldIndex&&a().createElement(Se,{rowIndex:e.rowIndex,value:t}),f&&b&&a().createElement(a().Fragment,null,m),u===k.labels&&b&&a().createElement(a().Fragment,null,m),u===k.labels&&!b&&a().createElement(ke,{value:t}),f&&!b&&a().createElement(ke,{value:t}),u===k.text&&a().createElement(ke,{value:t}),g&&a().createElement(Le,{scrollerRef:v}))))},_e=e=>({content:s.css`
    white-space: nowrap;
    overflow-x: auto;
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
    padding-right: 30px;
    display: flex;
    align-items: flex-start;
    height: 100%;
    &::-webkit-scrollbar {
      display: none; /* Chrome, Safari and Opera */
    }

    &:after {
      pointer-events: none;
      content: '';
      width: 100%;
      height: 100%;
      position: absolute;
      left: 0;
      top: 0;
      // Fade out text in last 10px to background color to add affordance to horiziontal scroll
      background: linear-gradient(to right, transparent calc(100% - 10px), ${e.colors.background.primary});
    }
  `}),Te=e=>{const{setHeaderMenuActive:t,isHeaderMenuActive:n}=V(),{logsFrame:i}=he(),l=(0,r.useRef)(null),c=(d=(0,o.useTheme2)(),u=0===e.fieldIndex,p=e.field.name===(0,S.Il)(i),{tableHeaderMenu:(0,s.css)({label:"tableHeaderMenu",width:"100%",minWidth:"250px",height:"100%",maxHeight:"400px",backgroundColor:d.colors.background.primary,border:`1px solid ${d.colors.border.weak}`,padding:d.spacing(2),margin:d.spacing(1,0),boxShadow:d.shadows.z3,borderRadius:d.shape.radius.default}),button:(0,s.css)({appearance:"none",right:"5px",background:"none",border:"none",padding:0}),wrapper:(0,s.css)({display:"flex",marginLeft:u?"56px":"6px",width:p?"calc(100% + 6px)":"100%",borderRight:`1px solid ${d.colors.border.weak}`,marginRight:"-6px"}),defaultContentWrapper:(0,s.css)({borderLeft:u?`1px solid ${d.colors.border.weak}`:"none",marginLeft:u?"-6px":0,paddingLeft:u?"12px":0,display:"flex"})});var d,u,p;return a().createElement("span",{className:c.wrapper},a().createElement("span",{className:c.defaultContentWrapper},e.defaultContent),a().createElement("button",{className:c.button,ref:l,onClick:e=>{t(!n)}},a().createElement(o.Icon,{title:"Show menu",name:"ellipsis-v"})),l.current&&a().createElement(o.Popover,{show:n,content:a().createElement(o.ClickOutsideWrapper,{onClick:()=>t(!1),useCapture:!0},a().createElement("div",{className:c.tableHeaderMenu},e.children)),referenceElement:l.current}))};function Fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function De(e){const{setHeaderMenuActive:t}=V(),{columns:n,setColumns:i,bodyState:l,setBodyState:c}=T(),{logsFrame:d}=he(),u=Ne(),p=(0,r.useCallback)((e=>{const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Fe(e,t,n[t])}))}return e}({},n);Object.keys(t).filter((n=>{const r=t[n].index,a=t[e.name].index;return t[n].active&&a&&r&&r>a})).map((e=>t[e])).forEach((e=>{void 0!==e.index&&e.index--})),t[e.name].active=!1,t[e.name].index=void 0,i(t)}),[n,i]),g=e.headerProps.field.name===(0,S.Il)(d);return a().createElement(Te,e.headerProps,a().createElement("div",{className:u.linkWrap},a().createElement("a",{className:u.link,onClick:()=>{e.openColumnManagementDrawer(),t(!1)}},a().createElement(o.Icon,{className:u.icon,name:"columns",size:"md"}),"Manage columns")),a().createElement("div",{className:u.linkWrap},a().createElement("a",{className:u.link,onClick:()=>p(e.headerProps.field)},a().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 17 16",width:"17",height:"16",className:"css-q2u0ig-Icon"},a().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.73446 1.33301H12.2345C12.3892 1.33301 12.5375 1.40325 12.6469 1.52827C12.7563 1.65329 12.8178 1.82286 12.8178 1.99967V4.74967C12.8178 5.07184 12.5566 5.33301 12.2345 5.33301C11.9123 5.33301 11.6511 5.07184 11.6511 4.74967V2.66634H7.56779V13.333H11.6511V10.9163C11.6511 10.5942 11.9123 10.333 12.2345 10.333C12.5566 10.333 12.8178 10.5942 12.8178 10.9163V13.9997C12.8178 14.1765 12.7563 14.3461 12.6469 14.4711C12.5375 14.5961 12.3892 14.6663 12.2345 14.6663H1.73446C1.57975 14.6663 1.43137 14.5961 1.32198 14.4711C1.21258 14.3461 1.15112 14.1765 1.15112 13.9997V1.99967C1.15112 1.82286 1.21258 1.65329 1.32198 1.52827C1.43137 1.40325 1.57975 1.33301 1.73446 1.33301ZM2.31779 13.333H6.40112V2.66634H2.31779V13.333Z",fill:"#CCCCDC",fillOpacity:"1"}),a().createElement("path",{d:"M15.9893 10.6315C15.9498 10.7263 15.8919 10.8123 15.819 10.8846C15.7467 10.9575 15.6607 11.0154 15.5659 11.0549C15.4712 11.0943 15.3695 11.1147 15.2668 11.1147C15.1641 11.1147 15.0625 11.0943 14.9677 11.0549C14.8729 11.0154 14.7869 10.9575 14.7146 10.8846L12.9335 9.09573L11.1524 10.8846C11.0801 10.9575 10.9941 11.0154 10.8993 11.0549C10.8045 11.0943 10.7028 11.1147 10.6002 11.1147C10.4975 11.1147 10.3958 11.0943 10.301 11.0549C10.2063 11.0154 10.1202 10.9575 10.0479 10.8846C9.97504 10.8123 9.91717 10.7263 9.87769 10.6315C9.8382 10.5367 9.81787 10.4351 9.81787 10.3324C9.81787 10.2297 9.8382 10.1281 9.87769 10.0333C9.91717 9.9385 9.97504 9.85248 10.0479 9.78017L11.8368 7.99906L10.0479 6.21795C9.90148 6.07149 9.8192 5.87285 9.8192 5.66573C9.8192 5.4586 9.90148 5.25996 10.0479 5.1135C10.1944 4.96705 10.393 4.88477 10.6002 4.88477C10.8073 4.88477 11.0059 4.96705 11.1524 5.1135L12.9335 6.90239L14.7146 5.1135C14.8611 4.96705 15.0597 4.88477 15.2668 4.88477C15.4739 4.88477 15.6726 4.96705 15.819 5.1135C15.9655 5.25996 16.0478 5.4586 16.0478 5.66573C16.0478 5.87285 15.9655 6.07149 15.819 6.21795L14.0302 7.99906L15.819 9.78017C15.8919 9.85248 15.9498 9.9385 15.9893 10.0333C16.0288 10.1281 16.0491 10.2297 16.0491 10.3324C16.0491 10.4351 16.0288 10.5367 15.9893 10.6315Z",fill:"#CCCCDC",fillOpacity:"1"})),"Remove column")),e.slideLeft&&a().createElement("div",{className:u.linkWrap},a().createElement("a",{className:u.link,onClick:()=>{var t;return null===(t=e.slideLeft)||void 0===t?void 0:t.call(e,n)}},a().createElement(o.Icon,{className:(0,s.cx)(u.icon,u.reverse),name:"arrow-from-right",size:"md"}),"Move left")),e.slideRight&&a().createElement("div",{className:u.linkWrap},a().createElement("a",{className:u.link,onClick:()=>{var t;return null===(t=e.slideRight)||void 0===t?void 0:t.call(e,n)}},a().createElement(o.Icon,{className:u.icon,name:"arrow-from-right",size:"md"}),"Move right")),g&&a().createElement("div",{className:u.linkWrap},a().createElement("a",{className:u.link,onClick:()=>{l===k.text?c(k.labels):c(k.text)}},l===k.text?a().createElement(o.Icon,{className:u.icon,name:"brackets-curly",size:"md"}):a().createElement(o.Icon,{className:u.icon,name:"text-fields",size:"md"}),l===k.text?"Show labels":"Show log text")),e.autoColumnWidths&&a().createElement("div",{className:u.linkWrap},a().createElement("a",{className:u.link,onClick:()=>{var t;return null===(t=e.autoColumnWidths)||void 0===t?void 0:t.call(e)}},a().createElement(o.Icon,{className:u.icon,name:"arrows-h",size:"md"}),"Reset column widths")))}const Ne=()=>({reverse:(0,s.css)({transform:"scaleX(-1)"}),link:(0,s.css)({paddingTop:"5px",paddingBottom:"5px"}),icon:(0,s.css)({marginRight:"10px"}),linkWrap:(0,s.css)({})});function $e(e,t,n,r,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function Ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ae(e,t,n[t])}))}return e}function Me(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Be(e){return a().createElement(o.Table,{onColumnResize:e.onResize,initialSortBy:[{displayName:(0,S.fF)(e.logsFrame),desc:!0}],initialRowIndex:e.selectedLine,cellHeight:$.qM.Sm,data:e.data,height:e.height,width:e.width,footerOptions:{show:!0,reducer:["count"],countRows:!0}})}const Re=e=>{const{height:t,timeZone:n,logsFrame:i,width:d,labels:u}=e,p=(0,o.useTheme2)(),g={section:(0,s.css)({position:"relative"}),tableWrap:(0,s.css)({".cellActions":{display:"none !important"}})},[h,v]=(0,r.useState)(void 0),{columns:m,visible:f,setVisible:b,setFilteredColumns:w,setColumns:O,clearSelectedLine:E,columnWidthMap:x,setColumnWidthMap:C}=T(),{selectedLine:L}=he(),[k]=(0,r.useState)(L),j=oe(O),P=(0,N.getTemplateSrv)(),_=(0,r.useMemo)((()=>P.replace.bind(P)),[P]),$=(0,r.useCallback)((e=>{if(!e.length)return e;const[t]=(0,y.applyFieldOverrides)({data:[e],timeZone:n,theme:p,replaceVariables:_,fieldConfig:{defaults:{custom:{}},overrides:[]}});for(const[n,o]of t.fields.entries()){var r,s;o.type=o.type===y.FieldType.string?null!==(r=Ve(o))&&void 0!==r?r:y.FieldType.string:o.type,o.config=Me(Ie({},o.config),{custom:Ie({inspect:!0,filterable:!0,headerComponent:t=>a().createElement(R,null,a().createElement(De,{headerProps:Me(Ie({},t),{fieldIndex:n}),openColumnManagementDrawer:()=>b(!0),slideLeft:0!==n?e=>j(e,n,n-1):void 0,slideRight:n!==e.fields.length-1?e=>j(e,n,n+1):void 0,autoColumnWidths:Object.keys(x).length>0?()=>{C({})}:void 0})),width:null!==(s=x[o.name])&&void 0!==s?s:He(o,n,m,d,t.fields.length,i),cellOptions:ze(o,n,u,i)},o.config.custom),filterable:!0})}return t}),[n,p,u,d,_,b,x]);(0,r.useEffect)((()=>{const e=function(){var e,t=(e=function*(){const e=(t=i.raw).fields.filter((e=>{var n,r,a;const i="json.RawMessage"===(null===(n=e.typeInfo)||void 0===n?void 0:n.frame)&&"labels"===e.name&&(null==t||null===(r=t.meta)||void 0===r?void 0:r.type)!==y.DataFrameType.LogLines,s="labels"===e.name&&e.type===y.FieldType.other&&(null==t||null===(a=t.meta)||void 0===a?void 0:a.type)===y.DataFrameType.LogLines;return i||s})).flatMap((e=>[{id:"extractFields",options:{format:"json",keepTime:!1,replace:!1,source:e.name}}]));var t;const n=function(e){let t={};for(const n in e)t[n]=!0;return Object.keys(e).length>0?{id:"organize",options:{indexByName:e,includeByName:t}}:null}(function(e){let t={};return Object.keys(e).filter((t=>e[t].active)).forEach((n=>{const r=e[n].index;void 0!==r&&(t[n]=r)})),t}(m));if(n)e.push(n);else{const t={time:i.timeField,body:i.bodyField,extraFields:i.extraFields};t&&void 0!==t.body&&void 0!==t.time&&e.push(function(e){return{id:"organize",options:{indexByName:{[e.time.name]:0,[e.body.name]:1},includeByName:{[e.body.name]:!0,[e.time.name]:!0}}}}(t))}if(e.length>0){const t=yield(0,D.lastValueFrom)((0,y.transformDataFrame)(e,[i.raw])),n=$(t[0]);v(n)}else v($(i.raw))},function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){$e(i,r,a,s,o,"next",e)}function o(e){$e(i,r,a,s,o,"throw",e)}s(void 0)}))});return function(){return t.apply(this,arguments)}}();e()}),[i.raw,i.bodyField,i.timeField,i.extraFields,$,m]),(0,r.useEffect)((()=>{k&&L&&E()}),[k,E,L]);const A=i.raw.fields.find((e=>e.name===(0,S.po)(i))),M=null==A?void 0:A.values.findIndex((e=>e===(null==k?void 0:k.id))),B=M&&-1!==M?M:void 0;return h?a().createElement("div",{"data-testid":c.b.table.wrapper,className:g.section},f&&a().createElement(o.Drawer,{size:"sm",onClose:()=>{b(!1),w(m)}},a().createElement(le,null)),a().createElement("div",{className:g.tableWrap},a().createElement(I,null,a().createElement(F.ScrollSync,{horizontal:!0,vertical:!1,proportional:!1},a().createElement(Be,{logsFrame:i,selectedLine:B,data:h,height:t,width:d,onResize:(0,l.debounce)(((e,t)=>{const n=Object.keys(m).filter((e=>m[e].active)).find((t=>t===e));if(n&&t>0){const e=Ie({},x);e[n]=t,C(e)}}),100)}))))):a().createElement(a().Fragment,null)};function Ve(e){if(e.name){const t=e.name.toLowerCase();if("date"===t||"time"===t)return y.FieldType.time}for(let t=0;t<e.values.length;t++){const n=e.values[t];if(null!=n)return Je(n)}}const We=()=>({options:{critical:{color:"#705da0",index:0},crit:{color:"#705da0",index:1},error:{color:"#e24d42",index:2},err:{color:"#e24d42",index:3},eror:{color:"#e24d42",index:4},warning:{color:"#FF9900",index:5},warn:{color:"#FF9900",index:6},info:{color:"#7eb26d",index:7},debug:{color:"#1f78c1",index:8},trace:{color:"#6ed0e0",index:9}},type:y.MappingType.ValueToText});function ze(e,t,n,r){return e.name===(0,S.Il)(r)?{cellComponent:e=>a().createElement(Pe,Me(Ie({},e),{fieldIndex:t,labels:n[e.rowIndex]})),type:o.TableCellDisplayMode.Custom}:{cellComponent:e=>a().createElement(we,Me(Ie({},e),{fieldIndex:t})),type:o.TableCellDisplayMode.Custom}}function He(e,t,n,r,a,i){var s,o;const l=a<=2?r:Math.min(r/2),c=0===t?50:0;if(e.type===y.FieldType.time)return 200+c;const d=n[e.name];if(void 0===d)return;var u;const p=Math.max(null!==(u=d.maxLength)&&void 0!==u?u:0,e.name.length);return d.maxLength?Math.min(Math.max(6.5*p+95+c,90+c),l):e.name!==(0,S.Il)(i)?Math.min(Math.max(6.5*(null!==(g=null===(o=e.values)||void 0===o||null===(s=o[0])||void 0===s?void 0:s.length)&&void 0!==g?g:80)+95+c,90+c),l):void 0;var g}var Ue=n(5540);const Ge=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{3,})?(?:Z|[-+]\d{2}:?\d{2})$/,qe=e=>{const{logsFrame:t}=he(),[n,i]=(0,r.useState)({width:0,height:0});(0,Ue.w)({ref:e.panelWrap,onResize:()=>{const t=e.panelWrap.current;t&&(n.width===t.clientWidth&&n.height===t.clientHeight||i({width:t.clientWidth,height:t.clientHeight}))}});const o={section:(0,s.css)({position:"relative"})},l=(0,y.getTimeZone)(),c=(0,r.useCallback)((t=>{const n=e.urlColumns;return(null==n?void 0:n.length)&&Object.values(n).forEach(((e,n)=>{t[e]&&(t[e].active=!0,t[e].index=n)})),t}),[e.urlColumns]);if(!t||!t.raw.length)return null;var d;const u=null!==(d=t.getLogFrameLabelsAsLabels())&&void 0!==d?d:[],p=t?t.raw.length:0;let g=function(e,t){let n={};const r=new Map,a=function(e){const t=new Map;return e.forEach((e=>{Object.keys(e).forEach((n=>{if(t.has(n)){const r=t.get(n),a=null==r?void 0:r.valueSet,i=null==r?void 0:r.maxLength;a&&!(null==a?void 0:a.has(e[n]))&&(null==a||a.add(e[n]),i&&e[n].length>i&&t.set(n,{maxLength:e[n].length,valueSet:a}))}else t.set(n,{maxLength:e[n].length,valueSet:new Set([e[n]])})}))})),t}(t),i=e?e.length:0;return(null==t?void 0:t.length)&&i&&(t.forEach((e=>{Object.keys(e).forEach((e=>{var t;const n=a.get(e);var i;const s=null!==(i=null==n||null===(t=n.valueSet)||void 0===t?void 0:t.size)&&void 0!==i?i:0;if(r.has(e)){const t=r.get(e);t&&((null==t?void 0:t.active)?r.set(e,{percentOfLinesWithLabel:t.percentOfLinesWithLabel+1,active:!0,index:t.index,cardinality:s,maxLength:null==n?void 0:n.maxLength}):r.set(e,{percentOfLinesWithLabel:t.percentOfLinesWithLabel+1,active:!1,index:void 0,cardinality:s,maxLength:null==n?void 0:n.maxLength}))}else r.set(e,{percentOfLinesWithLabel:1,active:!1,index:void 0,cardinality:s,maxLength:null==n?void 0:n.maxLength})}))})),n=Object.fromEntries(r),Object.keys(n).forEach((e=>{n[e].percentOfLinesWithLabel=Qe(n[e].percentOfLinesWithLabel,i)}))),n}(t.raw,u);const h={time:t.timeField,body:t.bodyField,extraFields:t.extraFields};return h&&(function(e,t,n){e.forEach((e=>{var r,a;if(!e)return;const i=null===(r=t[e.name])||void 0===r?void 0:r.active,s=null===(a=t[e.name])||void 0===a?void 0:a.index;t[e.name]=i&&void 0!==s?{percentOfLinesWithLabel:Qe(e.values.filter((e=>null!=e)).length,n),active:!0,index:s,cardinality:n}:{percentOfLinesWithLabel:Qe(e.values.filter((e=>null!=e)).length,n),active:!1,index:void 0,cardinality:n}}))}([h.time,h.body,...h.extraFields],g,p),g=c(g),function(e,t,n){var r,a,i,s,o,l,c,d,u,p;0===e.length&&((null===(i=t.body)||void 0===i?void 0:i.name)&&(n[null===(o=t.body)||void 0===o?void 0:o.name].active=!0,n[null===(l=t.body)||void 0===l?void 0:l.name].index=1),(null===(s=t.time)||void 0===s?void 0:s.name)&&(n[null===(c=t.time)||void 0===c?void 0:c.name].active=!0,n[null===(d=t.time)||void 0===d?void 0:d.name].index=0));(null===(r=t.time)||void 0===r?void 0:r.name)&&(null===(a=t.body)||void 0===a?void 0:a.name)&&(n[null===(u=t.body)||void 0===u?void 0:u.name].type="BODY_FIELD",n[null===(p=t.time)||void 0===p?void 0:p.name].type="TIME_FIELD");t.extraFields.length&&t.extraFields.forEach((e=>{var t;(null===(t=e.config.links)||void 0===t?void 0:t.length)&&(n[e.name].type="LINK_FIELD")}))}(Object.keys(g).filter((e=>g[e].active)),h,g)),a().createElement("section",{className:o.section},a().createElement(P,{setUrlTableBodyState:e.setUrlTableBodyState,logsFrame:t,initialColumns:g,setUrlColumns:e.setUrlColumns,clearSelectedLine:e.clearSelectedLine,urlTableBodyState:e.urlTableBodyState},a().createElement(Re,{logsFrame:t,timeZone:l,height:n.height-50,width:n.width-25,labels:u})))},Qe=(e,t)=>Math.ceil(100*e/t);function Je(e){let t=(0,y.guessFieldTypeFromValue)(e);return"string"===t&&Ge.test(e)&&(t=y.FieldType.time),t}const Ke=({dataFrame:e,setUrlColumns:t,urlColumns:n,addFilter:r,selectedLine:i,timeRange:s,panelWrap:o,clearSelectedLine:l,setUrlTableBodyState:c,urlTableBodyState:d})=>{if(!e)return null;const u=(0,S.Os)(e);return u?a().createElement(ge,{addFilter:r,selectedLine:i,timeRange:s,logsFrame:u},a().createElement(qe,{urlTableBodyState:d,setUrlColumns:t,setUrlTableBodyState:c,urlColumns:n,panelWrap:o,clearSelectedLine:l})):null};var Ye,Xe,Ze,et=n(8760),tt=n(558),nt=n(833),rt=n(1766),at=n(7097),it=n(4861);class st extends i.Bs{onActivate(){this.setState({menu:new it.GD({addExplorationsLink:!1})})}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}Ze=({model:e})=>{const t=(0,o.useStyles2)(ot),n=i.jh.getAncestor(e,dt),{data:s}=i.jh.getData(e).useState(),{selectedLine:l,urlColumns:c,visualizationType:d,tableLogLineState:u}=n.useState(),{menu:p}=e.useState(),g=i.jh.getTimeRange(e),{value:h}=g.useState(),v=(0,rt.tn)(s),m=(0,r.useRef)(null);return a().createElement("div",{className:t.panelWrapper,ref:m},a().createElement(o.PanelChrome,{loadingState:null==s?void 0:s.state,title:"Logs",menu:p?a().createElement(p.Component,{model:p}):void 0,actions:a().createElement(et.C,{vizType:d,onChange:n.setVisualizationType})},v&&a().createElement(Ke,{panelWrap:m,addFilter:t=>{const r=(0,at.OE)(v,t.key,e);(0,tt.XI)(t,n,r)},timeRange:h,selectedLine:l,urlColumns:null!=c?c:[],setUrlColumns:e=>{(0,nt.n)(e,n.state.urlColumns)||n.setState({urlColumns:e})},dataFrame:v,clearSelectedLine:()=>{n.state.selectedLine&&n.clearSelectedLine()},setUrlTableBodyState:e=>{n.setState({tableLogLineState:e})},urlTableBodyState:u})))},(Xe="Component")in(Ye=st)?Object.defineProperty(Ye,Xe,{value:Ze,enumerable:!0,configurable:!0,writable:!0}):Ye[Xe]=Ze;const ot=e=>({panelWrapper:(0,s.css)({width:"100%",height:"100%",label:"panel-wrapper-table","button.show-on-hover":{opacity:1,visibility:"visible",background:"none","&:hover":{background:e.colors.secondary.shade}}})});var lt=n(5587);function ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class dt extends i.Bs{getUrlState(){var e;const t=null!==(e=this.state.urlColumns)&&void 0!==e?e:[],n=this.state.selectedLine,r=this.state.visualizationType;var a,i;const s=null!==(i=null!==(a=this.state.displayedFields)&&void 0!==a?a:(0,v.N$)(this))&&void 0!==i?i:[];return{urlColumns:JSON.stringify(t),selectedLine:JSON.stringify(n),visualizationType:JSON.stringify(r),displayedFields:JSON.stringify(s),tableLogLineState:JSON.stringify(this.state.tableLogLineState)}}updateFromUrl(e){const t={};try{if("string"==typeof e.urlColumns){const n=(0,E.aJ)(JSON.parse(e.urlColumns));n!==this.state.urlColumns&&(t.urlColumns=n)}if("string"==typeof e.selectedLine){const n=(0,E.lb)(JSON.parse(e.selectedLine));if(n){const e=n;e!==this.state.selectedLine&&(t.selectedLine=e)}}if("string"==typeof e.visualizationType){const n=(0,E.v_)(JSON.parse(e.visualizationType));n&&n!==this.state.visualizationType&&(t.visualizationType=n)}if("string"==typeof e.displayedFields){const n=(0,E.aJ)(JSON.parse(e.displayedFields));n&&n.length&&(t.displayedFields=n)}if("string"==typeof e.tableLogLineState){const n=JSON.parse(e.tableLogLineState);n!==k.labels&&n!==k.text||(t.tableLogLineState=n)}}catch(e){w.v.error(e,{msg:"LogsListScene: updateFromUrl unexpected error"})}Object.keys(t).length&&this.setState(t)}clearSelectedLine(){this.setState({selectedLine:void 0})}onActivate(){const e=new URLSearchParams(N.locationService.getLocation().search);this.setStateFromUrl(e),this.state.panel||this.updateLogsPanel(),this._subs.add(this.subscribeToState(((e,t)=>{e.visualizationType!==t.visualizationType&&this.updateLogsPanel()})))}getLineFilterScene(){return this.lineFilterScene}setStateFromUrl(e){const t=e.get("selectedLine"),n=e.get("urlColumns"),r=e.get("visualizationType");var a;const i=null!==(a=e.get("displayedFields"))&&void 0!==a?a:JSON.stringify((0,v.N$)(this)),s=e.get("tableLogLineState");this.updateFromUrl({selectedLine:t,urlColumns:n,vizType:r,displayedFields:i,tableLogLineState:s})}getVizPanel(){return this.lineFilterScene=new f,this.logsPanelScene=new lt.o({}),new i.G1({direction:"column",children:"logs"===this.state.visualizationType?[new i.G1({children:[new i.vA({body:this.lineFilterScene,xSizing:"fill"})]}),new i.vA({height:"calc(100vh - 220px)",body:this.logsPanelScene})]:[new i.vA({body:this.lineFilterScene,xSizing:"fill"}),new i.vA({height:"calc(100vh - 220px)",body:new st({})})]})}constructor(e){var t,n;super((t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ct(e,t,n[t])}))}return e}({},e),n=null!=(n={visualizationType:(0,v.k5)(),displayedFields:[]})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t)),ct(this,"_urlSync",new i.So(this,{keys:["urlColumns","selectedLine","visualizationType","displayedFields","tableLogLineState"]})),ct(this,"lineFilterScene",void 0),ct(this,"logsPanelScene",void 0),ct(this,"clearDisplayedFields",(()=>{this.setState({displayedFields:[]}),this.logsPanelScene&&this.logsPanelScene.clearDisplayedFields()})),ct(this,"setLogsVizOption",((e={})=>{this.logsPanelScene&&this.logsPanelScene.setLogsVizOption(e)})),ct(this,"updateLogsPanel",(()=>{this.setState({panel:this.getVizPanel()})})),ct(this,"setVisualizationType",(e=>{this.setState({visualizationType:e}),(0,d.EE)(d.NO.service_details,d.ir.service_details.logs_visualization_toggle,{visualisationType:e}),(0,v.o5)(e)})),this.addActivationHandler(this.onActivate.bind(this))}}ct(dt,"Component",(({model:e})=>{const{panel:t}=e.useState();if(t)return a().createElement("div",{className:ut.panelWrapper},a().createElement(t.Component,{model:t}))}));const ut={panelWrapper:(0,s.css)({'section > div[class$="panel-content"]':(0,s.css)({contain:"none",overflow:"auto"})})}},5587:(e,t,n)=>{n.d(t,{o:()=>k});var r=n(7141),a=n(7781),i=n(227),s=n(5959),o=n.n(s),l=n(688),c=n(2007),d=n(558),u=n(7097),p=n(3143),g=n(2718),h=n(4750),v=n(8315);const m=({onClick:e})=>{const[t,n]=(0,s.useState)(!1);(0,s.useEffect)((()=>{let e;return t&&(e=setTimeout((()=>{n(!1)}),2e3)),()=>{clearTimeout(e)}}),[t]);const r=(0,s.useCallback)(((t,r)=>{e(t,r),n(!0)}),[e]);return o().createElement(c.IconButton,{"aria-label":t?"Copied":"Copy link to log line",tooltip:t?"Copied":"Copy link to log line",tooltipPlacement:"top",variant:t?"primary":"secondary",size:"md",name:t?"check":"share-alt",onClick:r})};var f=n(9254),b=n(9350),y=n(4861),S=n(1766),w=n(8531),O=n(4011),E=n(2871);function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}function L(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class k extends r.Bs{setStateFromUrl(){const e=new URLSearchParams(w.locationService.getLocation().search);this.updateFromUrl({sortOrder:e.get("sortOrder"),wrapLogMessage:e.get("wrapLogMessage")})}getUrlState(){return{sortOrder:JSON.stringify(this.state.sortOrder),wrapLogMessage:JSON.stringify(this.state.wrapLogMessage)}}updateFromUrl(e){const t={};try{if("string"==typeof e.sortOrder){const n=(0,O.FH)(JSON.parse(e.sortOrder));n&&(t.sortOrder=n,this.setLogsVizOption({sortOrder:n}))}if("string"==typeof e.wrapLogMessage){const n=JSON.parse(e.wrapLogMessage);"boolean"==typeof n&&(t.wrapLogMessage=n,this.setLogsVizOption({wrapLogMessage:n}),this.setLogsVizOption({prettifyLogMessage:n}))}}catch(e){E.v.error(e,{msg:"LogOptionsScene: updateFromUrl unexpected error"})}Object.keys(t).length&&this.setState(C({},t))}onActivate(){this.setStateFromUrl(),this.state.body||this.setState({body:this.getLogsPanel({wrapLogMessage:this.state.wrapLogMessage,prettifyLogMessage:this.state.wrapLogMessage,sortOrder:this.state.sortOrder})});const e=r.jh.getAncestor(this,S.Mn);this._subs.add(e.subscribeToState(((e,t)=>{e.logsCount!==t.logsCount&&(this.state.body?this.state.body.setState({title:this.getTitle(e.logsCount)}):this.setState({body:this.getLogsPanel({wrapLogMessage:this.state.wrapLogMessage,prettifyLogMessage:this.state.wrapLogMessage,sortOrder:this.state.sortOrder})}))})))}setLogsVizOption(e={}){if(this.state.body){if("sortOrder"in e&&e.sortOrder!==this.state.body.state.options.sortOrder){const e=r.jh.getData(this),t=e instanceof r.dt?e:r.jh.findDescendents(e,r.dt)[0];t&&t.runQueries()}this.state.body.onOptionsChange(e)}}getParentScene(){return r.jh.getAncestor(this,l.i)}getTitle(e){var t;const n=(0,a.getValueFormat)("short"),r=void 0!==e?n(e,0):void 0;return void 0!==r?`Logs (${r.text}${null===(t=r.suffix)||void 0===t?void 0:t.trim()})`:"Logs"}getLogsPanel(e){const t=this.getParentScene(),n=t.state.visualizationType,a=r.jh.getAncestor(this,S.Mn);var s,l,c;return r.d0.logs().setTitle(this.getTitle(a.state.logsCount)).setOption("showTime",!0).setOption("onClickFilterLabel",this.handleLabelFilterClick).setOption("onClickFilterOutLabel",this.handleLabelFilterOutClick).setOption("isFilterLabelActive",this.handleIsFilterLabelActive).setOption("onClickFilterString",this.handleFilterStringClick).setOption("onClickShowField",this.onClickShowField).setOption("onClickHideField",this.onClickHideField).setOption("displayedFields",t.state.displayedFields).setOption("sortOrder",null!==(s=e.sortOrder)&&void 0!==s?s:(0,f.zQ)()).setOption("wrapLogMessage",null!==(l=e.wrapLogMessage)&&void 0!==l?l:Boolean((0,i.YM)("wrapLogMessage",!1))).setOption("prettifyLogMessage",null!==(c=e.prettifyLogMessage)&&void 0!==c?c:Boolean((0,i.YM)("wrapLogMessage",!1))).setMenu(new y.GD({addExplorationsLink:!1})).setOption("showLogContextToggle",!0).setOption("enableInfiniteScrolling",!0).setOption("onNewLogsReceived",this.updateVisibleRange).setOption("logRowMenuIconsAfter",[o().createElement(m,{onClick:this.handleShareLogLineClick,key:0})]).setHeaderActions(new f.ZB({visualizationType:n,onChangeVisualizationType:t.setVisualizationType})).build()}handleLabelFilter(e,t,n,r){const a=(0,u.OE)(n,e,this);(0,d.Qt)(e,t,r,this,a),(0,g.EE)(g.NO.service_details,g.ir.service_details.logs_detail_filter_applied,{filterType:a,key:e,action:r})}constructor(e){super(C({sortOrder:(0,f.zQ)(),wrapLogMessage:Boolean((0,i.YM)("wrapLogMessage",!1))},e)),x(this,"_urlSync",new r.So(this,{keys:["sortOrder","wrapLogMessage"]})),x(this,"onClickShowField",(e=>{const t=this.getParentScene();if(-1===t.state.displayedFields.indexOf(e)&&this.state.body){const n=[...t.state.displayedFields,e];this.setLogsVizOption({displayedFields:n}),t.setState({displayedFields:n}),(0,i.ZF)(this,t.state.displayedFields),(0,g.EE)(g.NO.service_details,g.ir.service_details.logs_toggle_displayed_field)}})),x(this,"onClickHideField",(e=>{const t=this.getParentScene();if(t.state.displayedFields.indexOf(e)>=0&&this.state.body){const n=t.state.displayedFields.filter((t=>e!==t));this.setLogsVizOption({displayedFields:n}),t.setState({displayedFields:n}),(0,i.ZF)(this,t.state.displayedFields),(0,g.EE)(g.NO.service_details,g.ir.service_details.logs_toggle_displayed_field)}})),x(this,"clearDisplayedFields",(()=>{this.state.body&&(this.setLogsVizOption({displayedFields:[]}),(0,i.ZF)(this,[]))})),x(this,"updateVisibleRange",(e=>{var t,n;const a=r.jh.getAncestor(this,S.Mn);a.setState({logsCount:e[0].length}),(null===(n=a.state.$data)||void 0===n||null===(t=n.state.data)||void 0===t?void 0:t.series)&&a.state.$data.setState(L(C({},a.state.$data.state),{data:L(C({},a.state.$data.state.data),{series:e})})),r.jh.findByKeyAndType(this,b.b,b._).updateVisibleRange(e)})),x(this,"handleShareLogLineClick",((e,t)=>{if((null==t?void 0:t.rowId)&&this.state.body){const e=this.getParentScene(),n=(0,v.Ki)(t);(0,v.Dk)((0,v.gW)("panelState",{logs:{id:t.uid,displayedFields:e.state.displayedFields}},n))}})),x(this,"handleLabelFilterClick",((e,t,n)=>{this.handleLabelFilter(e,t,n,"toggle")})),x(this,"handleLabelFilterOutClick",((e,t,n)=>{this.handleLabelFilter(e,t,n,"exclude")})),x(this,"handleIsFilterLabelActive",((e,t)=>{const n=(0,h.bY)(p.MB,this),r=(0,h.bY)(p.mB,this),a=(0,h.bY)(p._Y,this),i=(0,h.bY)(p._P,this),s=n=>n&&n.state.filters.findIndex((n=>"="===n.operator&&n.key===e&&n.value===t))>=0;return s(n)||(n=>{if(n){const r=n.state.filters.find((t=>"="===t.operator&&t.key===e));if(r)return(0,h.bu)(r,e).value===t}return!1})(r)||s(a)||s(i)})),x(this,"handleFilterStringClick",(e=>{const t=r.jh.getAncestor(this,l.i).getLineFilterScene();t&&(t.updateFilter(e,!1),(0,g.EE)(g.NO.service_details,g.ir.service_details.logs_popover_line_filter,{selectionLength:e.length}))})),this.addActivationHandler(this.onActivate.bind(this))}}x(k,"Component",(({model:e})=>{const{body:t}=e.useState(),n=(0,c.useStyles2)(y.K_);return t?o().createElement("span",{className:n.panelWrapper},o().createElement(t.Component,{model:t})):o().createElement(c.LoadingPlaceholder,{text:"Loading..."})}))},9350:(e,t,n)=>{n.d(t,{_:()=>L,b:()=>C});var r=n(5959),a=n.n(r),i=n(7141),s=n(2007),o=n(5183),l=n(7918),c=n(3143),d=n(2718),u=n(7097),p=n(4750);function g(e,t,n=!0){const r=(0,p.ir)(e);let a="";n&&t===c.e4&&(a=`| ${c.e4} != ""`);const i=r.state.filters,s=(0,u.k$)(r);if(i.length){if("mixed"===s)return`sum(count_over_time({${c.S1}} ${a} ${c.S6} ${c.A2} ${c.sC} ${c.YN} ${c.Oc} [$__auto])) by (${t})`;if("json"===s)return`sum(count_over_time({${c.S1}} ${a} ${c.S6} ${c.A2} ${c.sC} ${c.VL} ${c.Oc} [$__auto])) by (${t})`;if("logfmt"===s)return`sum(count_over_time({${c.S1}} ${a} ${c.S6} ${c.A2} ${c.sC} ${c.mF} ${c.Oc} [$__auto])) by (${t})`}return`sum(count_over_time({${c.S1}} ${a} ${c.S6} ${c.A2} ${c.sC} ${c.Oc} [$__auto])) by (${t})`}var h=n(1383),v=n(7781),m=n(833),f=n(4861),b=n(1766),y=n(9186),S=n(227),w=n(4235);function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){O(e,t,n[t])}))}return e}function x(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const C="logs-volume-panel";class L extends i.Bs{onActivate(){if(!this.state.panel){const e=this.getVizPanel();this.setState({panel:e}),this.updateContainerHeight(e)}const e=(0,p.cR)(this),t=(0,p.ir)(this);e.subscribeToState(((e,t)=>{(0,m.B)(e.filters,t.filters)||this.setState({panel:this.getVizPanel()})})),t.subscribeToState(((e,t)=>{(0,m.B)(e.filters,t.filters)||this.setState({panel:this.getVizPanel()})}))}getTitle(e,t){var n,r,a;const s=null!==(a=null===(n=i.jh.getAncestor(this,w.PR).state.ds)||void 0===n?void 0:n.maxLines)&&void 0!==a?a:l.by,o=(0,v.getValueFormat)("short"),c=void 0!==e?o(e,0):void 0;if(void 0===e&&void 0!==t&&t<s){var d;const e=o(t,0);return void 0!==e?`Log volume (${e.text}${null===(d=e.suffix)||void 0===d?void 0:d.trim()})`:"Log volume"}return void 0!==c?`Log volume (${c.text}${null===(r=c.suffix)||void 0===r?void 0:r.trim()})`:"Log volume"}getVizPanel(){var e,t;const n=i.jh.getAncestor(this,b.Mn),r=i.d0.timeseries().setTitle(this.getTitle(n.state.totalLogsCount,n.state.logsCount)).setOption("legend",{showLegend:!0,calcs:["sum"],displayMode:s.LegendDisplayMode.List}).setUnit("short").setMenu(new f.GD({})).setCollapsible(!0).setCollapsed(Boolean((0,S.Rf)("collapsed"))).setData((0,o.rS)([(0,l.l)(g(this,c.e4,!1),{legendFormat:`{{${c.e4}}}`})]));(0,o.ZC)(r);const a=r.build();return a.setState({extendPanelContext:(e,t)=>this.extendTimeSeriesLegendBus(t)}),this._subs.add(a.subscribeToState(((e,t)=>{e.collapsed!==t.collapsed&&(this.updateContainerHeight(a),(0,S.RN)("collapsed",e.collapsed?"true":void 0))}))),this._subs.add(null===(e=a.state.$data)||void 0===e?void 0:e.subscribeToState((e=>{var t,r,i,s,l,c;(null===(t=e.data)||void 0===t?void 0:t.state)===v.LoadingState.Done&&((null===(i=n.state.$data)||void 0===i||null===(r=i.state.data)||void 0===r?void 0:r.state)!==v.LoadingState.Done||(null===(s=e.data.annotations)||void 0===s?void 0:s.length)?this.displayVisibleRange():this.updateVisibleRange(null===(c=n.state.$data)||void 0===c||null===(l=c.state.data)||void 0===l?void 0:l.series),(0,o.Cw)(a,e.data.series,this))}))),this._subs.add(null===(t=n.state.$data)||void 0===t?void 0:t.subscribeToState((e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.state)===v.LoadingState.Done&&this.updateVisibleRange(e.data.series)}))),this._subs.add(n.subscribeToState(((e,t)=>{e.totalLogsCount===t.totalLogsCount&&void 0===e.logsCount||(this.state.panel?this.state.panel.setState({title:this.getTitle(e.totalLogsCount,e.logsCount)}):this.setState({panel:this.getVizPanel()}))}))),a}updateContainerHeight(e){const t=i.jh.getAncestor(e,i.G1),n=e.state.collapsed?35:Math.max(Math.round(.2*window.innerHeight),100);t.setState({minHeight:n,height:n,maxHeight:n})}updateVisibleRange(e=[]){this.updatedLogSeries=e,this.displayVisibleRange()}displayVisibleRange(){var e,t;const n=this.state.panel;if(!n||!(null===(e=n.state.$data)||void 0===e?void 0:e.state.data)||(null===(t=n.state.$data)||void 0===t?void 0:t.state.data.state)!==v.LoadingState.Done||!this.updatedLogSeries)return;const r=(0,y.z5)(this.updatedLogSeries);this.updatedLogSeries=null,n.state.$data.setState({data:x(E({},n.state.$data.state.data),{annotations:[(0,y.hy)(r.start,r.end)]})})}constructor(e){super(x(E({},e),{key:C})),O(this,"updatedLogSeries",null),O(this,"extendTimeSeriesLegendBus",(e=>{const t=(0,p.iw)(this);this._subs.add(null==t?void 0:t.subscribeToState((()=>{var e,t,n,r;const a=this.state.panel;(null==a||null===(t=a.state.$data)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.series)&&(0,o.Cw)(a,null==a||null===(r=a.state.$data)||void 0===r||null===(n=r.state.data)||void 0===n?void 0:n.series,this)}))),e.onToggleSeriesVisibility=(e,t)=>{if(t===s.SeriesVisibilityChangeMode.AppendToSelection)return;const n=(0,h.PE)(e,this);(0,d.EE)(d.NO.service_details,d.ir.service_details.level_in_logs_volume_clicked,{level:e,action:n})}})),this.addActivationHandler(this.onActivate.bind(this))}}O(L,"Component",(({model:e})=>{const{panel:t}=e.useState();if(!t)return;const n=(0,s.useStyles2)(f.K_);return a().createElement("span",{className:n.panelWrapper},a().createElement(t.Component,{model:t}))}))},1766:(e,t,n)=>{n.d(t,{AA:()=>Re,DS:()=>Be,Mn:()=>qe,rD:()=>ze,UO:()=>He,nU:()=>Ue,dB:()=>Ge,TG:()=>We,tn:()=>Ve});var r=n(5959),a=n.n(r),i=n(7781),s=n(7141),o=n(2007),l=n(5183),c=n(7918),d=n(3143),u=n(6949),p=n(8835),g=n(833),h=n(892),v=n(2718),m=n(6089),f=n(688),b=n(1220),y=n(8810),S=n(4105),w=n(9570),O=n(4235),E=n(2871);function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){var t,n;const{indexScene:r,pattern:a,type:i}=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}({},e),o=s.jh.getAncestor(r,O.PR);if(!o)return void E.v.warn("logs exploration scene not found");const{patterns:l=[]}=o.state,c=l.filter((e=>e.pattern!==a));var d;const u=null!==(d=null===(t=c.filter((e=>"include"===e.type)))||void 0===t?void 0:t.length)&&void 0!==d?d:0;var p;const g=null!==(p=null===(n=c.filter((e=>"exclude"===e.type)))||void 0===n?void 0:n.length)&&void 0!==p?p:0;(0,v.EE)(v.NO.service_details,v.ir.service_details.pattern_selected,{type:i,includePatternsLength:u+("include"===i?1:0),excludePatternsLength:g+("exclude"===i?1:0)}),"undo"===i?o.setState({patterns:c}):o.setState({patterns:[...c,{pattern:a,type:i}]})}var L=n(5218),k=n(8531),j=n(9829);const P=e=>({logsStatsRow:(0,m.css)({margin:`${e.spacing(1.15)}px 0`}),logsStatsRowActive:(0,m.css)({color:e.colors.primary.text,position:"relative"}),logsStatsRowLabel:(0,m.css)({display:"flex",marginBottom:"1px"}),logsStatsRowValue:(0,m.css)({flex:1,textOverflow:"ellipsis",overflow:"hidden"}),logsStatsRowCount:(0,m.css)({textAlign:"right",marginLeft:e.spacing(.75)}),logsStatsRowPercent:(0,m.css)({textAlign:"right",marginLeft:e.spacing(.75),width:e.spacing(4.5)}),logsStatsRowBar:(0,m.css)({height:e.spacing(.5),overflow:"hidden",background:e.colors.text.disabled}),logsStatsRowInnerBar:(0,m.css)({height:e.spacing(.5),overflow:"hidden",background:e.colors.primary.main})}),_=({active:e,count:t,proportion:n,value:r})=>{const i=(0,o.useStyles2)(P),s=`${Math.round(100*n)}%`,l={width:s};return a().createElement("div",{className:e?`${i.logsStatsRow} ${i.logsStatsRowActive}`:i.logsStatsRow},a().createElement("div",{className:i.logsStatsRowLabel},a().createElement("div",{className:i.logsStatsRowValue,title:r},r),a().createElement("div",{className:i.logsStatsRowCount},t),a().createElement("div",{className:i.logsStatsRowPercent},s)),a().createElement("div",{className:i.logsStatsRowBar},a().createElement("div",{className:i.logsStatsRowInnerBar,style:l})))};function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const F=e=>({logsStats:(0,m.css)({background:"inherit",color:e.colors.text.primary,wordBreak:"break-all",width:"fit-content",maxHeight:"40vh",overflowY:"auto",marginTop:e.spacing(1)}),logsStatsHeader:(0,m.css)({borderBottom:`1px solid ${e.colors.border.medium}`,display:"flex"}),logsStatsTitle:(0,m.css)({fontWeight:e.typography.fontWeightMedium,paddingRight:e.spacing(2),display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis",flexGrow:1}),logsStatsClose:(0,m.css)({cursor:"pointer"}),logsStatsBody:(0,m.css)({padding:"5px 0px"})}),D=e=>{const t=(0,o.useStyles2)(F),{stats:n,value:r}=e,i=n.slice(0,10);let s=i.find((e=>e.value===r)),l=n.slice(10);!s&&(s=l.find((e=>e.value===r)),l=l.filter((e=>e.value!==r)));const c=l.reduce(((e,t)=>e+t.count),0),d=i.reduce(((e,t)=>e+t.count),0)+c;let u=[...i];return c>0&&u.push({value:"Other",count:c,proportion:c/d}),u.sort(((e,t)=>t.count-e.count)),a().createElement("div",{className:t.logsStats},a().createElement("div",{className:t.logsStatsHeader},a().createElement("div",{className:t.logsStatsTitle},"From a sample of ",d," rows found")),a().createElement("div",{className:t.logsStatsBody},u.map((e=>{return a().createElement(_,(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){T(e,t,n[t])}))}return e}({key:e.value},e),n=null!=(n={active:e.value===r})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t));var t,n}))))};var N=n(4750);function $(e,t,n,r,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}const A=({exploration:e,pattern:t,maxLines:n})=>{const l=function(e){const t=[];let n=e.indexOf("<_>");for(;-1!==n;)t.push(n),n=e.indexOf("<_>",n+1);return t}(t),[d,u]=(0,r.useState)(void 0),[p,g]=(0,r.useState)(!1),h=(0,o.useStyles2)(I),m=(0,r.useRef)(null),f=(0,r.useRef)(null),b=function(){var r,a=(r=function*(){(0,v.EE)(v.NO.service_details,v.ir.service_details.pattern_field_clicked);const r=function(e,t,n){let r=1;const a=e.replace(/<_>/g,(()=>`<field_${r++}>`));return`{${n.state.filterExpression}} |> \`${e}\` | pattern \`${a}\` | keep ${t.map(((e,t)=>`field_${t+1}`)).join(" ,")} | line_format ""`}(t,l,(0,N.cR)(e)),a=yield(0,j.hJ)(e),o=s.jh.getTimeRange(e).state.value;d&&r===m.current&&o===f.current||(m.current=r,f.current=o,null==a||a.query({requestId:"1",interval:"",intervalMs:0,scopedVars:{},range:o,targets:[(0,c.l)(r,{maxLines:n})],timezone:"",app:"",startTime:0}).forEach((e=>{var t,r;e.state!==i.LoadingState.Done||(null===(t=e.errors)||void 0===t?void 0:t.length)?(e.state===i.LoadingState.Error||(null===(r=e.errors)||void 0===r?void 0:r.length))&&(u(void 0),g(!0)):(u(function(e,t,n){const r=new Map;e.data[0].fields[0].values.toArray().forEach((e=>{Object.keys(e).forEach((t=>{var n,a;r.has(t)||r.set(t,new Map),null===(a=r.get(t))||void 0===a||a.set(e[t],((null===(n=r.get(t))||void 0===n?void 0:n.get(e[t]))||0)+1)}))}));const a=[];for(let e=0;e<=t;e++){var i;const t=[];null===(i=r.get(`field_${e+1}`))||void 0===i||i.forEach(((e,r)=>{t.push({value:r,count:e,proportion:e/n})})),t.sort(((e,t)=>t.count-e.count)),a.push(t)}return a}(e,l.length,n)),g(!1))})))},function(){var e=this,t=arguments;return new Promise((function(n,a){var i=r.apply(e,t);function s(e){$(i,n,a,s,o,"next",e)}function o(e){$(i,n,a,s,o,"throw",e)}s(void 0)}))});return function(){return a.apply(this,arguments)}}(),y=(0,r.useMemo)((()=>t.split("<_>")),[t]);return a().createElement("div",null,y.map(((e,t)=>a().createElement("span",{key:t},e,t!==l.length&&a().createElement(o.Toggletip,{onOpen:b,content:a().createElement(a().Fragment,null,d&&d[t].length>0&&a().createElement(D,{stats:d[t],value:""}),d&&0===d[t].length&&a().createElement("div",null,"No available stats for this field in the current timestamp."),!d&&p&&a().createElement("div",null,"Could not load stats for this pattern."),!d&&!p&&a().createElement("div",{style:{padding:"10px"}},a().createElement(o.Spinner,{size:"xl"})))},a().createElement("span",{className:h.pattern},"<_>"))))))};function I(e){return{pattern:(0,m.css)({cursor:"pointer",backgroundColor:e.colors.emphasize(e.colors.background.primary,.1),margin:"0 2px","&:hover":{backgroundColor:e.colors.emphasize(e.colors.background.primary,.2)}})}}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class B extends s.Bs{onActivate(){if(this.state.body)return;const e=(0,c.l)(d.SA);this.replacePatternsInQuery(e);const t=(0,l.rS)([e]);t.getResultsStream().subscribe((e=>{this.onQueryWithFiltersResult(e)})),this.setState({body:new s.G1({direction:"column",children:[new s.vA({body:void 0,width:"100%",height:0}),new s.vA({height:300,width:"100%",body:s.d0.logs().setHoverHeader(!0).setOption("showLogContextToggle",!0).setOption("showTime",!0).setData(t).build()})]})})}replacePatternsInQuery(e){const t={pattern:this.state.pattern,type:"include"},n=(0,c.M3)([t]);e.expr=e.expr.replace(d.sC,n)}removePatternFromFilterExclusion(){const e=s.jh.getAncestor(this,W);var t;const n=null!==(t=e.state.patternsNotMatchingFilters)&&void 0!==t?t:[],r=n.findIndex((e=>e===this.state.pattern));-1!==r&&(n.splice(r,1),e.setState({patternsNotMatchingFilters:n}))}setWarningMessage(e){const t=this.getNoticeFlexItem(),n=this.getVizFlexItem();return t instanceof s.vA&&t.setState({isHidden:!1,height:"auto",body:new s.dM({reactNode:e})}),n}getNoticeFlexItem(){const e=this.getFlexItemChildren();return null==e?void 0:e[0]}getVizFlexItem(){const e=this.getFlexItemChildren();return null==e?void 0:e[1]}getFlexItemChildren(){var e;return null===(e=this.state.body)||void 0===e?void 0:e.state.children}excludeThisPatternFromFiltering(){const e=s.jh.getAncestor(this,W);var t;const n=null!==(t=e.state.patternsNotMatchingFilters)&&void 0!==t?t:[];e.setState({patternsNotMatchingFilters:[...n,this.state.pattern]})}static Component({model:e}){const{body:t}=e.useState();return t?a().createElement(t.Component,{model:t}):null}constructor(e){super(e),M(this,"clearFilters",(()=>{const e=(0,N.ir)(this),t=(0,N.Rr)(this),n=(0,N.iw)(this);if(e.setState({filters:[]}),n.setState({filters:[]}),t.state.value){t.changeValueTo("");const e=this.getNoticeFlexItem();null==e||e.setState({isHidden:!0}),this.removePatternFromFilterExclusion()}})),M(this,"onQueryError",(e=>{if(e.data.state===i.LoadingState.Done&&(0===e.data.series.length||e.data.series.every((e=>0===e.length)))||e.data.state===i.LoadingState.Error){let t;try{t={pattern:this.state.pattern,traceIds:JSON.stringify(e.data.traceIds),request:JSON.stringify(e.data.request),msg:"onQueryError"}}catch(e){t={pattern:this.state.pattern,msg:"Failed to encode context"}}E.v.error(new Error("Pattern sample query returns no results"),t),this.setWarningMessage(a().createElement(o.Alert,{severity:"error",title:""},"This pattern returns no logs."));const n=this.getVizFlexItem();n instanceof s.vA&&n.setState({isHidden:!0})}})),M(this,"onQueryWithFiltersResult",(e=>{const t=(0,c.l)(d.pT);this.replacePatternsInQuery(t);const n=(0,l.rS)([t]);if(n.getResultsStream().subscribe(this.onQueryError),e.data.state===i.LoadingState.Done&&(0===e.data.series.length||e.data.series.every((e=>0===e.length)))){const e=this.getNoticeFlexItem(),t=this.getVizFlexItem();if(e instanceof s.vA&&e.setState({isHidden:!1,height:"auto",body:new s.dM({reactNode:a().createElement(o.Alert,{severity:"warning",title:""},"The logs returned by this pattern do not match the current query filters.",a().createElement(o.Button,{className:S.ZI.button,onClick:()=>this.clearFilters()},"Clear filters"))})}),t instanceof s.vA){const e=t.state.body;e instanceof s.Eb&&(null==e||e.setState({$data:n}))}this.excludeThisPatternFromFiltering()}e.data.state===i.LoadingState.Error&&this.onQueryError(e)})),this.addActivationHandler(this.onActivate.bind(this))}}function R({tableViz:e,row:t}){const{expandedRows:n}=e.useState(),i=null==n?void 0:n.find((e=>e.state.key===t.pattern));return(0,r.useEffect)((()=>{if(!i){const a=(r=t.pattern,new B({pattern:r,key:r}));var n;e.setState({expandedRows:[...null!==(n=e.state.expandedRows)&&void 0!==n?n:[],a]})}var r}),[t,e,i]),i?a().createElement(i.Component,{model:i}):null}const V=[""," K"," Mil"," Bil"," Tri"," Quadr"," Quint"," Sext"," Sept"];class W extends s.Bs{onActivate(){var e;const t=null===(e=s.jh.getAncestor(this,O.PR).state.ds)||void 0===e?void 0:e.maxLines;this.setState({maxLines:t})}buildColumns(e,t,n,r,l){const c=J(n),d=s.jh.getTimeRange(this).state.value;return[{id:"volume-samples",header:"",cell:e=>{const t={timeRange:d,series:[e.cell.row.original.dataFrame],state:i.LoadingState.Done},n=new s.Zv({data:t}),r=s.d0.timeseries().setData(n).setHoverHeader(!0).setOption("tooltip",{mode:o.TooltipDisplayMode.None}).setCustomFieldConfig("hideFrom",{legend:!0,tooltip:!0}).setCustomFieldConfig("axisPlacement",o.AxisPlacement.Hidden).setDisplayMode("transparent").build();return a().createElement("div",{className:c.tableTimeSeriesWrap},a().createElement("div",{className:c.tableTimeSeries},a().createElement(r.Component,{model:r})))}},{id:"count",header:"Count",sortType:"number",cell:e=>{const t=(0,i.scaledUnits)(1e3,V)(e.cell.row.original.sum);var n,r;return a().createElement("div",{className:c.countTextWrap},a().createElement("div",null,null!==(n=t.prefix)&&void 0!==n?n:"",t.text,null!==(r=t.suffix)&&void 0!==r?r:""))}},{id:"percent",header:"%",sortType:"number",cell:t=>a().createElement("div",{className:c.countTextWrap},a().createElement("div",null,(100*t.cell.row.original.sum/e).toFixed(0),"%"))},{id:"pattern",header:"Pattern",cell:e=>a().createElement("div",{className:(0,m.cx)(q(),c.tablePatternTextDefault)},a().createElement(A,{exploration:(0,j.Ti)(this),pattern:e.cell.row.original.pattern,maxLines:r}))},{id:"include",header:void 0,disableGrow:!0,cell:e=>{if(null==l?void 0:l.includes(e.cell.row.original.pattern))return;const n=null==t?void 0:t.find((t=>t.pattern===e.cell.row.original.pattern)),r="include"===(null==n?void 0:n.type),i="exclude"===(null==n?void 0:n.type);return a().createElement(L.F,{isExcluded:i,isIncluded:r,onInclude:()=>e.cell.row.original.includeLink(),onExclude:()=>e.cell.row.original.excludeLink(),onClear:()=>e.cell.row.original.undoLink(),buttonFill:"outline"})}}]}buildTableData(e,t){const n=s.jh.getAncestor(this,O.PR);return e.filter((e=>!t.size||t.has(e.pattern))).map((e=>({dataFrame:e.dataFrame,pattern:e.pattern,sum:e.sum,includeLink:()=>C({pattern:e.pattern,type:"include",indexScene:n}),excludeLink:()=>C({pattern:e.pattern,type:"exclude",indexScene:n}),undoLink:()=>C({pattern:e.pattern,type:"undo",indexScene:n})})))}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}var z,H,U;U=function({model:e}){const t=s.jh.getAncestor(e,O.PR),{patterns:n}=t.useState(),r=(0,o.useTheme2)(),i=Q(r),l=s.jh.getAncestor(e,ee),{legendSyncPatterns:d}=l.useState(),{patternFrames:u,patternsNotMatchingFilters:p}=e.useState(),g=null!=u?u:[],h=g.reduce(((e,t)=>e+t.sum),0),v=e.buildTableData(g,d);var m;const f=e.buildColumns(h,n,r,null!==(m=e.state.maxLines)&&void 0!==m?m:c.by,p);return a().createElement("div",{"data-testid":b.b.patterns.tableWrapper,className:i.tableWrap},a().createElement(o.InteractiveTable,{columns:f,data:v,getRowId:e=>e.pattern,renderExpandedRow:t=>a().createElement(R,{tableViz:e,row:t})}))},(H="Component")in(z=W)?Object.defineProperty(z,H,{value:U,enumerable:!0,configurable:!0,writable:!0}):z[H]=U;const G=k.config.theme2,q=()=>(0,m.css)({minWidth:"200px",fontFamily:G.typography.fontFamilyMonospace,overflow:"hidden",overflowWrap:"break-word"}),Q=e=>({link:(0,m.css)({textDecoration:"underline"}),tableWrap:(0,m.css)({"> div":{height:"calc(100vh - 450px)",minHeight:"470px"},th:{top:0,position:"sticky",backgroundColor:e.colors.background.canvas,zIndex:e.zIndex.navbarFixed}})}),J=e=>({tablePatternTextDefault:(0,m.css)({fontFamily:e.typography.fontFamilyMonospace,minWidth:"200px",maxWidth:"100%",overflow:"hidden",overflowWrap:"break-word",fontSize:e.typography.bodySmall.fontSize,wordBreak:"break-word"}),countTextWrap:(0,m.css)({textAlign:"right",fontSize:e.typography.bodySmall.fontSize}),tableTimeSeriesWrap:(0,m.css)({width:"230px",pointerEvents:"none"}),tableTimeSeries:(0,m.css)({height:"30px",overflow:"hidden"})});function K(e,t,n,r,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function Y(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){K(i,r,a,s,o,"next",e)}function o(e){K(i,r,a,s,o,"throw",e)}s(void 0)}))}}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Z=k.config.theme2.visualization.palette;class ee extends s.Bs{onActivate(){this.updateBody(),this._subs.add(s.jh.getAncestor(this,qe).subscribeToState(((e,t)=>{var n,r,a,i,o,l;const c=null==e||null===(a=e.$patternsData)||void 0===a||null===(r=a.state)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.series,d=null==t||null===(l=t.$patternsData)||void 0===l||null===(o=l.state)||void 0===o||null===(i=o.data)||void 0===i?void 0:i.series;if(!(0,g.B)(c,d)){const e=s.jh.getAncestor(this,pe);this.updatePatterns(e.state.patternFrames),e.setState({filteredPatterns:void 0})}}))),this._subs.add(s.jh.getAncestor(this,pe).subscribeToState(((e,t)=>{const n=s.jh.getAncestor(this,pe);e.filteredPatterns&&!(0,g.B)(e.filteredPatterns,t.filteredPatterns)?this.updatePatterns(n.state.filteredPatterns):n.state.patternFilter||this.updatePatterns(n.state.patternFrames)})))}updatePatterns(e=[]){var t=this;return Y((function*(){var n;null===(n=t.state.body)||void 0===n||n.forEachChild((n=>{n instanceof s.Eb&&n.setState({$data:t.getTimeseriesDataNode(e)}),n instanceof W&&n.setState({patternFrames:e})}))}))()}updateBody(){var e=this;return Y((function*(){var t,n;const r=s.jh.getAncestor(e,pe).state.patternFrames;(null===(n=s.jh.getAncestor(e,qe).state.$patternsData)||void 0===n||null===(t=n.state.data)||void 0===t?void 0:t.series)&&r?e.setState({body:e.getSingleViewLayout(),legendSyncPatterns:new Set,loading:!1}):E.v.warn("Failed to update PatternsFrameScene body")}))()}extendTimeSeriesLegendBus(e,t){const n=t.onToggleSeriesVisibility;t.onToggleSeriesVisibility=(t,r)=>{var a;null==n||n(t,r);const i=null===(a=e.state.fieldConfig.overrides)||void 0===a?void 0:a[0],s=null==i?void 0:i.matcher.options.names,o=new Set;s&&s.forEach(o.add,o),this.setState({legendSyncPatterns:o})}}getSingleViewLayout(){const e=s.jh.getAncestor(this,pe).state.patternFrames;if(!e)return void E.v.warn("Failed to set getSingleViewLayout");const t=this.getTimeSeries(e);return new s.gF({templateColumns:"100%",autoRows:"200px",isLazy:!0,children:[t,new W({patternFrames:e})]})}getTimeSeries(e){const t=s.jh.getAncestor(this,O.PR),n=s.d0.timeseries().setData(this.getTimeseriesDataNode(e)).setOption("legend",{asTable:!0,showLegend:!0,displayMode:o.LegendDisplayMode.Table,placement:"right",width:200}).setHoverHeader(!0).setUnit("short").setLinks([{url:"#",targetBlank:!1,onClick:e=>{C({pattern:e.origin.labels.name,type:"include",indexScene:t})},title:"Include"},{url:"#",targetBlank:!1,onClick:e=>{C({pattern:e.origin.labels.name,type:"exclude",indexScene:t})},title:"Exclude"}]).build();return n.setState({extendPanelContext:(e,t)=>this.extendTimeSeriesLegendBus(e,t)}),n}getTimeseriesDataNode(e){const t=s.jh.getTimeRange(this).state.value;return new s.Zv({data:{series:e.map(((e,t)=>{const n=e.dataFrame;return n.fields[1].config.color=function(e){return{mode:"fixed",fixedColor:Z[e]}}(t),n.fields[1].name="",n})),state:i.LoadingState.Done,timeRange:t}})}constructor(e){var t,n;super((t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){X(e,t,n[t])}))}return e}({loading:!0},e),n=null!=(n={legendSyncPatterns:new Set})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t)),this.addActivationHandler(this.onActivate.bind(this))}}X(ee,"Component",(({model:e})=>{var t;const{body:n,loading:r}=e.useState(),i=s.jh.getAncestor(e,qe),{$patternsData:o}=i.useState(),l=null==o||null===(t=o.state.data)||void 0===t?void 0:t.series;return a().createElement("div",{className:te.container},!r&&l&&l.length>0&&a().createElement(a().Fragment,null,n&&a().createElement(n.Component,{model:n})))}));const te={container:(0,m.css)({width:"100%",".show-on-hover":{display:"none"}})};var ne=n(4932),re=n(6261);function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ie extends s.Bs{onActivate(){const e=s.jh.getAncestor(this,pe);this._subs.add(e.subscribeToState(((e,t)=>{if(e.patternFilter!==t.patternFilter){const e=s.jh.getAncestor(this,pe);e.state.patternFrames&&(0,ne.E)(e.state.patternFrames.map((e=>e.pattern)),e.state.patternFilter,this.onSearchResult)}}))),this._subs.add(e.subscribeToState(((e,t)=>{e.patternFilter&&!e.filteredPatterns&&e.patternFrames&&!(0,g.B)(e.filteredPatterns,t.filteredPatterns)&&(0,ne.X)(e.patternFrames.map((e=>e.pattern)),e.patternFilter,this.onSearchResult)})))}setFilteredPatterns(e,t){const n=s.jh.getAncestor(this,pe),r=null!=t?t:n.state.patternFrames;if(r){const t=r.filter((t=>!(!n.state.patternFilter||!(null==r?void 0:r.length))&&e.find((e=>e===t.pattern))));n.setState({filteredPatterns:t})}}setEmptySearch(){s.jh.getAncestor(this,pe).setState({filteredPatterns:void 0})}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ae(e,t,n[t])}))}return e}({},e)),ae(this,"clearSearch",(()=>{s.jh.getAncestor(this,pe).setState({patternFilter:""})})),ae(this,"handleSearchChange",(e=>{s.jh.getAncestor(this,pe).setState({patternFilter:e.target.value})})),ae(this,"onSearchResult",(e=>{const t=s.jh.getAncestor(this,pe);t.state.patternFilter?this.setFilteredPatterns(e[0]):t.state.filteredPatterns&&!t.state.patternFilter&&this.setEmptySearch()})),this.addActivationHandler(this.onActivate.bind(this))}}ae(ie,"Component",(function({model:e}){const t=s.jh.getAncestor(e,pe),{patternFilter:n}=t.useState();return a().createElement(o.Field,{className:se.field},a().createElement(re.D,{onChange:e.handleSearchChange,onClear:e.clearSearch,value:n,placeholder:"Search patterns"}))}));const se={field:(0,m.css)({label:"field",marginBottom:0}),icon:(0,m.css)({cursor:"pointer"})};var oe=n(4482);function le(){return a().createElement(oe.R,null,a().createElement("div",null,a().createElement("p",null,a().createElement("strong",null,"Sorry, we could not detect any patterns.")),a().createElement("p",null,"Check back later or reach out to the team in the"," ",a().createElement(o.TextLink,{href:"https://slack.grafana.com/",external:!0},"Grafana Labs community Slack channel")),a().createElement("p",null,"Patterns let you detect similar log lines to include or exclude from your search.")))}function ce(){return a().createElement(oe.R,null,a().createElement("div",null,a().createElement("p",null,a().createElement("strong",null,"Patterns are only available for the most recent ",ue," hours of data.")),a().createElement("p",null,"See the"," ",a().createElement(o.TextLink,{href:"https://grafana.com/docs/grafana/latest/explore/simplified-exploration/logs/patterns/",external:!0},"patterns docs")," ","for more info.")))}function de(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ue=3;class pe extends s.Bs{onActivate(){var e,t,n;const r=s.jh.getAncestor(this,qe);this.setBody();const a=null===(t=r.state.$patternsData)||void 0===t||null===(e=t.state.data)||void 0===e?void 0:e.series;a&&this.updatePatternFrames(a),this._subs.add(null===(n=r.state.$patternsData)||void 0===n?void 0:n.subscribeToState(this.onDataChange))}setBody(){this.setState({body:new s.G1({direction:"column",children:[new s.vA({ySizing:"content",body:new ie}),new s.vA({body:new ee})]})})}updatePatternFrames(e){if(!e)return;const t=this.dataFrameToPatternFrame(e);this.setState({patternFrames:t})}dataFrameToPatternFrame(e){const t=s.jh.getAncestor(this,qe),n=s.jh.getAncestor(t,O.PR).state.patterns;return e.map((e=>{var t,r;const a=null==n?void 0:n.find((t=>t.pattern===e.name)),i=null===(r=e.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.sum;var s;return{dataFrame:e,pattern:null!==(s=e.name)&&void 0!==s?s:"",sum:i,status:null==a?void 0:a.type}}))}constructor(e){var t;super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){de(e,t,n[t])}))}return e}({$variables:null!==(t=e.$variables)&&void 0!==t?t:new s.Pj({variables:[new s.yP({name:d.Jg,defaultToAll:!0,includeAll:!0})]}),loading:!0,patternFilter:""},e)),de(this,"onDataChange",((e,t)=>{var n,r,a,s;const o=null===(n=e.data)||void 0===n?void 0:n.series,l=null===(r=t.data)||void 0===r?void 0:r.series;(null===(a=e.data)||void 0===a?void 0:a.state)===i.LoadingState.Done?(this.setState({loading:!1}),(0,g.B)(o,l)||this.updatePatternFrames(o)):(null===(s=e.data)||void 0===s?void 0:s.state)===i.LoadingState.Loading&&this.setState({loading:!0})})),this.addActivationHandler(this.onActivate.bind(this))}}function ge(e){return{container:(0,m.css)({flexGrow:1,display:"flex",minHeight:"100%",flexDirection:"column"}),content:(0,m.css)({flexGrow:1,display:"flex",paddingTop:e.spacing(0)}),controls:(0,m.css)({flexGrow:0,display:"flex",alignItems:"top",gap:e.spacing(2)}),controlsRight:(0,m.css)({flexGrow:0,display:"flex",justifyContent:"flex-end"}),controlsLeft:(0,m.css)({display:"flex",justifyContent:"flex-left",justifyItems:"left",width:"100%",flexDirection:"column"}),patternMissingText:(0,m.css)({padding:e.spacing(2)})}}de(pe,"Component",(({model:e})=>{const{body:t,loading:n,blockingMessage:r,patternFrames:l}=e.useState(),{value:c}=s.jh.getTimeRange(e).useState(),d=(0,o.useStyles2)(ge),u=(0,i.dateTime)().diff(c.to,"hours")>=ue;return a().createElement("div",{className:d.container},a().createElement(w.O,{isLoading:n,blockingMessage:r},!n&&!l&&a().createElement("div",{className:d.patternMissingText},a().createElement(o.Text,{textAlignment:"center",color:"primary"},a().createElement("p",null,"There are no pattern matches."),a().createElement("p",null,"Pattern matching has not been configured."),a().createElement("p",null,"Patterns let you detect similar log lines and add or exclude them from your search."),a().createElement("p",null,"To see them in action, add the following to your configuration"),a().createElement("p",null,a().createElement("code",null,"--pattern-ingester.enabled=true")))),!n&&0===(null==l?void 0:l.length)&&u&&a().createElement(ce,null),!n&&0===(null==l?void 0:l.length)&&!u&&a().createElement(le,null),!n&&l&&l.length>0&&a().createElement("div",{className:d.content},t&&a().createElement(t.Component,{model:t}))))}));var he=n(9350),ve=n(3633),me=function(e){return e.logs="Logs",e.labels="Labels",e.fields="Fields",e.patterns="Patterns",e}({});const fe=[{displayName:"Logs",value:h.G3.logs,getScene:()=>new s.G1({direction:"column",children:[new s.vA({body:new he._({})}),new s.vA({minHeight:"470px",height:"calc(100vh - 500px)",body:new f.i({})})]}),testId:b.b.exploreServiceDetails.tabLogs},{displayName:"Labels",value:h.G3.labels,getScene:()=>new s.G1({$behaviors:[new s.Gg.K2({key:"sync",sync:ve.yV.Crosshair})],children:[new s.vA({body:new y.O({})})]}),testId:b.b.exploreServiceDetails.tabLabels},{displayName:"Fields",value:h.G3.fields,getScene:e=>{return t=e,new s.G1({$behaviors:[new s.Gg.K2({key:"sync",sync:ve.yV.Crosshair})],children:[new s.vA({body:new S.J6({changeFieldCount:t})})]});var t},testId:b.b.exploreServiceDetails.tabFields},{displayName:"Patterns",value:h.G3.patterns,getScene:()=>new s.G1({children:[new s.vA({body:new pe({})})]}),testId:b.b.exploreServiceDetails.tabPatterns}],be=[{displayName:"Label",value:h._J.label,getScene:e=>function(e){return new s.G1({$behaviors:[new s.Gg.K2({key:"sync",sync:ve.yV.Crosshair})],children:[new s.vA({body:new y.O({value:e})})]})}(e),testId:b.b.exploreServiceDetails.tabLabels},{displayName:"Field",value:h._J.field,getScene:e=>function(e){return new s.G1({$behaviors:[new s.Gg.K2({key:"sync",sync:ve.yV.Crosshair})],children:[new s.vA({body:new S.J6({value:e})})]})}(e),testId:b.b.exploreServiceDetails.tabFields}];var ye=n(8315);function Se(e,t,n,r,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function we(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){Se(i,r,a,s,o,"next",e)}function o(e){Se(i,r,a,s,o,"throw",e)}s(void 0)}))}}function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ee extends s.Bs{setIsOpen(e){this.setState({isOpen:e})}onCopyLink(e,t,r){e?(ke(r||n.g.location.href),(0,k.reportInteraction)("grafana_explore_shortened_link_clicked",{isAbsoluteTime:t})):((0,ye.Dk)(void 0!==r?`${window.location.protocol}//${window.location.host}${k.config.appSubUrl}${r}`:n.g.location.href),this.state.onCopyLink&&this.state.onCopyLink(e,t,r))}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Oe(e,t,n[t])}))}return e}({isOpen:!1,lastSelected:xe},e))}}Oe(Ee,"MenuActions",(({model:e})=>{const t=[{key:"normal",label:"Normal URL links",items:[{key:"copy-shortened-link",icon:"link",label:"Copy shortened URL",getUrl:()=>{},shorten:!0,absTime:!1},{key:"copy-link",icon:"link",label:"Copy URL",getUrl:()=>{},shorten:!1,absTime:!1}]},{key:"timesync",label:"Time-sync URL links (share with time range intact)",items:[{key:"copy-short-link-abs-time",icon:"clock-nine",label:"Copy absolute shortened URL",shorten:!0,getUrl:()=>je(void 0!==e.state.getSceneTimeRange?e.state.getSceneTimeRange():s.jh.getTimeRange(e)),absTime:!0},{key:"copy-link-abs-time",icon:"clock-nine",label:"Copy absolute URL",shorten:!1,getUrl:()=>je(void 0!==e.state.getSceneTimeRange?e.state.getSceneTimeRange():s.jh.getTimeRange(e)),absTime:!0}]}];return a().createElement(o.Menu,null,t.map((t=>a().createElement(o.MenuGroup,{key:t.key,label:t.label},t.items.map((t=>a().createElement(o.Menu.Item,{key:t.key,label:t.label,icon:t.icon,onClick:()=>{const n=t.getUrl();e.onCopyLink(t.shorten,t.absTime,n),e.setState({lastSelected:t})}})))))))})),Oe(Ee,"Component",(({model:e})=>{const{lastSelected:t,isOpen:n}=e.useState();return a().createElement(o.ButtonGroup,null,a().createElement(o.ToolbarButton,{tooltip:t.label,icon:t.icon,variant:"canvas",narrow:!0,onClick:()=>{const n=t.getUrl();e.onCopyLink(t.shorten,t.absTime,n)},"aria-label":"Copy shortened URL"},a().createElement("span",null,"Share")),a().createElement(o.Dropdown,{overlay:a().createElement(Ee.MenuActions,{model:e}),placement:"bottom-end",onVisibleChange:e.setIsOpen.bind(e)},a().createElement(o.ToolbarButton,{narrow:!0,variant:"canvas",isOpen:n,"aria-label":"Open copy link options"})))}));const xe={key:"copy-link",label:"Copy shortened URL",icon:"share-alt",getUrl:()=>{},shorten:!0,absTime:!1};function Ce(e){let t=e.replace(`${window.location.protocol}//${window.location.host}${k.config.appSubUrl}`,"");return t.startsWith("/")?t.substring(1,t.length):t}const Le=function(){var e=we((function*(e){const t=(0,k.getAppEvents)();try{return(yield(0,k.getBackendSrv)().post("/api/short-urls",{path:Ce(e)})).url}catch(e){console.error("Error when creating shortened link: ",e),t.publish({type:i.AppEvents.alertError.name,payload:["Error generating shortened link"]})}}));return function(t){return e.apply(this,arguments)}}(),ke=function(){var e=we((function*(e){const t=(0,k.getAppEvents)(),n=yield Le(e);n?((0,ye.Dk)(n),t.publish({type:i.AppEvents.alertSuccess.name,payload:["Shortened link copied to clipboard"]})):t.publish({type:i.AppEvents.alertError.name,payload:["Error generating shortened link"]})}));return function(t){return e.apply(this,arguments)}}(),je=e=>{const t=(0,i.toUtc)(e.state.value.from),n=(0,i.toUtc)(e.state.value.to),r=k.locationService.getLocation(),a=new URLSearchParams(r.search);return a.set("from",t.toISOString()),a.set("to",n.toISOString()),`${r.pathname}?${a.toString()}`};class Pe extends s.Bs{onActivate(){const e=s.jh.getAncestor(this,O.PR).state.ds;void 0!==(null==e?void 0:e.maxLines)&&this.setState({maxLines:e.maxLines}),this.state.shareButtonScene||this.setState({shareButtonScene:new Ee({})})}constructor(e){super(e),this.addActivationHandler(this.onActivate.bind(this))}}!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Pe,"Component",(({model:e})=>{const t=(0,o.useStyles2)(Te);let n=(0,h.FT)(),r=!1;if(!Object.values(h.G3).includes(n)){const e=(0,h.er)();r=!0,e===h._J.field&&(n=h.G3.fields),e===h._J.label&&(n=h.G3.labels)}const l=s.jh.getAncestor(e,qe),d=l.useState(),{loading:u,$data:g,logsCount:f,totalLogsCount:b}=d,y=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(d,["loading","$data","logsCount","totalLogsCount"]),{maxLines:S}=e.useState(),w=y.loadingStates;return a().createElement(o.Box,{paddingY:0},a().createElement("div",{className:t.actions},a().createElement(o.Stack,{gap:1},k.config.featureToggles.appSidecar&&a().createElement(Fe,{serviceScene:l}),e.state.shareButtonScene&&a().createElement(e.state.shareButtonScene.Component,{model:e.state.shareButtonScene}))),a().createElement(o.TabsBar,null,fe.map(((t,l)=>a().createElement(o.Tab,{"data-testid":t.testId,key:l,label:t.displayName,active:n===t.value,counter:w[t.displayName]?void 0:_e(t,y),suffix:t.displayName===me.logs?({className:e})=>function(e,t,n,r){const s=(0,o.useStyles2)(De),l=(0,i.getValueFormat)("short");if(void 0===t&&void 0!==n&&n<r){var c;const t=l(n,0);return a().createElement("span",{className:(0,m.cx)(e,s.logsCountStyles)},t.text,null===(c=t.suffix)||void 0===c?void 0:c.trim())}if(void 0!==t){var d;const n=l(t,0);return a().createElement("span",{className:(0,m.cx)(e,s.logsCountStyles)},n.text,null===(d=n.suffix)||void 0===d?void 0:d.trim())}return a().createElement("span",{className:(0,m.cx)(e,s.emptyCountStyles)})}(e,b,f,null!=S?S:c.by):void 0,icon:w[t.displayName]?"spinner":void 0,onChangeTab:()=>{if(t.value&&t.value!==n||r){(0,v.EE)(v.NO.service_details,v.ir.service_details.action_view_changed,{newActionView:t.value,previousActionView:n});const r=s.jh.getAncestor(e,qe);(0,p.Vt)(t.value,r)}}})))))}));const _e=(e,t)=>{switch(e.value){case"fields":return t.fieldsCount;case"patterns":return t.patternsCount;case"labels":return t.labelsCount;default:return}};function Te(e){return{actions:(0,m.css)({[e.breakpoints.up(e.breakpoints.values.md)]:{position:"absolute",right:0,zIndex:2}})}}function Fe(e){const[t,n]=(0,r.useState)((0,N.cR)(e.serviceScene).state.filters);(0,r.useEffect)((()=>{const t=(0,N.cR)(e.serviceScene).subscribeToState((e=>{n(e.filters)}));return()=>{t.unsubscribe()}}),[e.serviceScene]);const[i,s]=(0,r.useState)(!1),l=(0,k.usePluginLinks)({extensionPointId:"grafana-lokiexplore-app/toolbar-open-related/v1",limitPerPlugin:3,context:{filters:t}});if(l.isLoading||0===l.links.length)return null;if(1===l.links.length){const e=l.links[0];return a().createElement("div",null,a().createElement(o.ToolbarButton,{variant:"canvas",key:e.id,onClick:t=>{var n;return null===(n=e.onClick)||void 0===n?void 0:n.call(e,t)},icon:e.icon},"Related ",e.title))}const c=a().createElement(o.Menu,null,l.links.map((e=>a().createElement(o.Menu.Item,{ariaLabel:e.title,icon:(null==e?void 0:e.icon)||"plug",key:e.id,label:e.title,onClick:t=>{var n;null===(n=e.onClick)||void 0===n||n.call(e,t)}}))));return a().createElement(o.Dropdown,{onVisibleChange:s,placement:"bottom-start",overlay:c},a().createElement(o.ToolbarButton,{"aria-label":"Open related",variant:"canvas",isOpen:i},"Open related"))}function De(e){return{emptyCountStyles:(0,m.css)({display:"inline-block",fontSize:e.typography.bodySmall.fontSize,minWidth:"1em",marginLeft:e.spacing(1),padding:e.spacing(.25,1)}),logsCountStyles:(0,m.css)({fontSize:e.typography.bodySmall.fontSize,label:"counter",marginLeft:e.spacing(1),borderRadius:e.spacing(3),backgroundColor:e.colors.action.hover,padding:e.spacing(.25,1),color:e.colors.text.secondary,fontWeight:e.typography.fontWeightMedium})}}var Ne=n(7608),$e=n(6059);function Ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ae(e,t,n[t])}))}return e}function Me(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const Be="logsPanelQuery",Re="logsCountQuery";function Ve(e){return null==e?void 0:e.series.find((e=>e.refId===Be))}function We(e){var t,n,r;return null===(r=s.jh.getAncestor(e,qe).state.$detectedLabelsData)||void 0===r||null===(n=r.state.data)||void 0===n||null===(t=n.series)||void 0===t?void 0:t[0]}function ze(e){var t;const n=s.jh.getAncestor(e,qe);return He(null===(t=n.state.$detectedFieldsData)||void 0===t?void 0:t.state)}const He=e=>{var t,n;return null==e||null===(n=e.data)||void 0===n||null===(t=n.series)||void 0===t?void 0:t[0]},Ue=e=>{var t,n,r,a;return null===(a=e.data)||void 0===a||null===(r=a.series)||void 0===r||null===(n=r[0])||void 0===n||null===(t=n.fields)||void 0===t?void 0:t[0]},Ge=e=>{var t,n,r,a;return null===(a=e.data)||void 0===a||null===(r=a.series)||void 0===r||null===(n=r[0])||void 0===n||null===(t=n.fields)||void 0===t?void 0:t[2]};class qe extends s.Bs{setSubscribeToLabelsVariable(){const e=(0,N.cR)(this);0!==e.state.filters.length?this._subs.add(e.subscribeToState(((e,t)=>{0===e.filters.length&&this.redirectToStart();let{labelName:n,labelValue:r,breakdownLabel:a}=(0,h.W6)();n===d.ky&&(n=d.OX);const i=s.jh.getAncestor(this,O.PR),o=i.state.routeMatch;if(e.filters.some((e=>e.key===n&&"="===e.operator&&(0,Ne.uu)(e.value)===r))){if(!(0,g.B)(e.filters,t.filters)){var l,c,u,v;null===(l=this.state.$patternsData)||void 0===l||l.runQueries(),null===(c=this.state.$detectedLabelsData)||void 0===c||c.runQueries(),null===(u=this.state.$detectedFieldsData)||void 0===u||u.runQueries(),null===(v=this.state.$logsCount)||void 0===v||v.runQueries()}}else{const t=e.filters.find((e=>"="===e.operator&&e.value!==d.ZO));var m,f,b;t?(i.setState({routeMatch:Me(Ie({},o),{params:Me(Ie({},null==o?void 0:o.params),{labelName:t.key===d.OX?d.ky:t.key,labelValue:(0,Ne.uu)(t.value)}),url:null!==(m=null==o?void 0:o.url)&&void 0!==m?m:"",path:null!==(f=null==o?void 0:o.path)&&void 0!==f?f:"",isExact:null===(b=null==o?void 0:o.isExact)||void 0===b||b})}),this.resetTabCount(),a?(0,p.fg)((0,h.er)(),a,this):(0,p.Vt)((0,h.FT)(),this)):this.redirectToStart()}}))):this.redirectToStart()}redirectToStart(){this.setState({$data:void 0,$logsCount:void 0,body:void 0,$patternsData:void 0,$detectedLabelsData:void 0,$detectedFieldsData:void 0,patternsCount:void 0,labelsCount:void 0,fieldsCount:void 0,logsCount:void 0,totalLogsCount:void 0}),(0,u.JO)().setServiceSceneState(this.state),this._subs.unsubscribe(),this.clearAdHocVariables(),(0,p.Ns)()}getMetadata(){const e=(0,u.JO)().getServiceSceneState();e&&this.setState(Ie({},e))}onActivate(){s.jh.findByKeyAndType(this,O.yQ,$e.H).setState({hidden:!0}),this.getMetadata(),this.resetBodyAndData(),this.setBreakdownView(),this.runQueries(),this._subs.add(this.subscribeToPatternsQuery()),this._subs.add(this.subscribeToDetectedLabelsQuery()),this._subs.add(this.subscribeToDetectedFieldsQuery((0,h.FT)()!==h.G3.fields)),this._subs.add(this.subscribeToLogsQuery()),this._subs.add(this.subscribeToLogsCountQuery()),this.setSubscribeToLabelsVariable(),this._subs.add(this.subscribeToFieldsVariable()),this._subs.add(this.subscribeToMetadataVariable()),this._subs.add(this.subscribeToLevelsVariable()),this._subs.add(this.subscribeToDataSourceVariable()),this._subs.add(this.subscribeToPatternsVariable()),this._subs.add(this.subscribeToLineFilterVariable()),this._subs.add(this.subscribeToTimeRange())}subscribeToPatternsVariable(){return(0,N.Ku)(this).subscribeToState(((e,t)=>{var n,r;e.value!==t.value&&(null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries())}))}subscribeToLineFilterVariable(){return(0,N.Rr)(this).subscribeToState(((e,t)=>{var n;e.value!==t.value&&(null===(n=this.state.$logsCount)||void 0===n||n.runQueries())}))}subscribeToDataSourceVariable(){return(0,N.S9)(this).subscribeToState((()=>{this.redirectToStart()}))}resetTabCount(){this.setState({fieldsCount:void 0,labelsCount:void 0,patternsCount:void 0}),(0,u.JO)().setServiceSceneState(this.state)}subscribeToFieldsVariable(){return(0,N.ir)(this).subscribeToState(((e,t)=>{var n,r;(0,g.B)(e.filters,t.filters)||(null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries())}))}subscribeToMetadataVariable(){return(0,N.oY)(this).subscribeToState(((e,t)=>{var n,r;(0,g.B)(e.filters,t.filters)||(null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries())}))}subscribeToLevelsVariable(){return(0,N.iw)(this).subscribeToState(((e,t)=>{var n,r;(0,g.B)(e.filters,t.filters)||(null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries())}))}runQueries(){const e=(0,h.FT)(),t=(0,h.er)();var n,r,a,i;e!==h.G3.patterns&&void 0!==this.state.patternsCount||null===(n=this.state.$patternsData)||void 0===n||n.runQueries(),e!==h.G3.labels&&t!==h._J.label&&void 0!==this.state.labelsCount||null===(r=this.state.$detectedLabelsData)||void 0===r||r.runQueries(),e!==h.G3.fields&&t!==h._J.field&&void 0!==this.state.fieldsCount||null===(a=this.state.$detectedFieldsData)||void 0===a||a.runQueries(),void 0===this.state.logsCount&&(null===(i=this.state.$logsCount)||void 0===i||i.runQueries())}subscribeToPatternsQuery(){var e;return null===(e=this.state.$patternsData)||void 0===e?void 0:e.subscribeToState((e=>{var t;if(this.updateLoadingState(e,me.patterns),(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){const t=e.data.series;void 0!==(null==t?void 0:t.length)&&(this.setState({patternsCount:t.length}),(0,u.JO)().setPatternsCount(t.length))}}))}subscribeToDetectedLabelsQuery(){var e;return null===(e=this.state.$detectedLabelsData)||void 0===e?void 0:e.subscribeToState((e=>{var t;if(this.updateLoadingState(e,me.labels),(null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){const t=e.data,n=t.series[0].fields;if(void 0!==t.series.length&&void 0!==n.length){const e=t.series[0].fields.filter((e=>d.e4!==e.name));this.setState({labelsCount:e.length+1}),(0,u.JO)().setLabelsCount(n.length)}}}))}updateLoadingState(e,t){var n;const r=this.state.loadingStates;r[t]=(null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Loading;const a=Object.values(r).some((e=>e));this.setState({loading:a,loadingStates:r})}subscribeToLogsQuery(){var e;return null===(e=this.state.$data)||void 0===e?void 0:e.subscribeToState(((e,t)=>{var n,r;if(this.updateLoadingState(e,me.logs),(null===(n=e.data)||void 0===n?void 0:n.state)===i.LoadingState.Done||(null===(r=e.data)||void 0===r?void 0:r.state)===i.LoadingState.Streaming){var a,s;const t=null!==(s=null===(a=e.data.series[0])||void 0===a?void 0:a.length)&&void 0!==s?s:0;t!==this.state.logsCount&&this.setState({logsCount:t})}}))}subscribeToLogsCountQuery(){var e;return null===(e=this.state.$logsCount)||void 0===e?void 0:e.subscribeToState((e=>{var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===i.LoadingState.Done){var n,r,a,s;const t=null===(s=e.data.series[0])||void 0===s||null===(a=s.fields)||void 0===a||null===(r=a[1])||void 0===r||null===(n=r.values)||void 0===n?void 0:n[0];this.setState({totalLogsCount:t})}}))}subscribeToDetectedFieldsQuery(e){var t;return null===(t=this.state.$detectedFieldsData)||void 0===t?void 0:t.subscribeToState((t=>{var n;if(this.updateLoadingState(t,me.fields),e&&(null===(n=t.data)||void 0===n?void 0:n.state)===i.LoadingState.Done){const e=t.data.series[0];void 0!==e&&e.length!==this.state.fieldsCount&&(this.setState({fieldsCount:e.length}),(0,u.JO)().setFieldsCount(e.length))}}))}subscribeToTimeRange(){return s.jh.getTimeRange(this).subscribeToState((()=>{var e,t,n,r;null===(e=this.state.$patternsData)||void 0===e||e.runQueries(),null===(t=this.state.$detectedLabelsData)||void 0===t||t.runQueries(),null===(n=this.state.$detectedFieldsData)||void 0===n||n.runQueries(),null===(r=this.state.$logsCount)||void 0===r||r.runQueries()}))}resetBodyAndData(){let e={};this.state.$data||(e.$data=Xe()),this.state.$patternsData||(e.$patternsData=Je()),this.state.$detectedLabelsData||(e.$detectedLabelsData=Ke()),this.state.$detectedFieldsData||(e.$detectedFieldsData=Ye()),this.state.$logsCount||(e.$logsCount=Ze()),this.state.body||(e.body=Qe()),Object.keys(e).length&&this.setState(e)}setBreakdownView(){const{body:e}=this.state,t=(0,h.FT)(),n=fe.find((e=>e.value===t));if(!e){const e=new Error("body is not defined in setBreakdownView!");throw E.v.error(e,{msg:"ServiceScene setBreakdownView error"}),e}if(n)e.setState({children:[...e.state.children.slice(0,1),n.getScene((e=>{"fields"===n.value&&this.setState({fieldsCount:e})}))]});else{const t=(0,h.er)(),n=be.find((e=>e.value===t));n&&this.state.drillDownLabel?e.setState({children:[...e.state.children.slice(0,1),n.getScene(this.state.drillDownLabel)]}):E.v.error(new Error("not setting breakdown view"),{msg:"setBreakdownView error"})}}constructor(e){var t;super(Ie({loadingStates:{[me.patterns]:!1,[me.labels]:!1,[me.fields]:!1,[me.logs]:!1},loading:!0,body:null!==(t=e.body)&&void 0!==t?t:Qe(),$data:Xe(),$patternsData:Je(),$detectedLabelsData:Ke(),$detectedFieldsData:Ye(),$logsCount:Ze()},e)),Ae(this,"_variableDependency",new s.Sh(this,{variableNames:[d.EY,d.MB,d.mB,d.uw,d._Y]})),Ae(this,"clearAdHocVariables",(()=>{[(0,N.cR)(this),(0,N.ir)(this),(0,N.iw)(this)].forEach((e=>{e.setState({filters:[]})}))})),this.addActivationHandler(this.onActivate.bind(this))}}function Qe(){return new s.G1({direction:"column",children:[new s.vA({ySizing:"content",body:new Pe({})})]})}function Je(){return(0,l.FH)([(0,c.BM)(`{${d.S1}}`,"patterns",{refId:"patterns"})])}function Ke(){return(0,l.FH)([(0,c.BM)(`{${d.S1}}`,"detected_labels",{refId:"detectedLabels"})])}function Ye(){return(0,l.FH)([(0,c.BM)(d.SA,"detected_fields",{refId:"detectedFields"})])}function Xe(){return(0,l.rS)([(0,c.l)(d.SA,{refId:Be})])}function Ze(){const e=(0,l.rS)([(0,c.l)(`sum(count_over_time(${d.SA}[$__auto]))`,{refId:Re,queryType:"instant"})],{runQueriesMode:"manual"});if(e instanceof s.dt)return e;const t=new Error("log count query provider is not query runner!");throw E.v.error(t,{msg:"getLogCountQueryRunner: invalid return type"}),t}Ae(qe,"Component",(({model:e})=>{const{body:t}=e.useState();return t?a().createElement(t.Component,{model:t}):a().createElement(o.LoadingPlaceholder,{text:"Loading..."})}))},866:(e,t,n)=>{n.d(t,{p:()=>g});var r,a,i,s=n(7141),o=n(5959),l=n.n(o),c=n(2007),d=n(6089),u=n(227),p=n(9055);class g extends s.Bs{setHover(e){this.setState({hover:e})}onClick(e){e?(0,p.wy)(this.state.labelName,this.state.labelValue,this):(0,p._J)(this.state.labelName,this.state.labelValue,this)}}i=({model:e})=>{const{ds:t,labelValue:n,labelName:r,hover:a}=e.useState(),i=(0,u.eT)(t,r).includes(n),s=(0,c.useStyles2)((e=>({wrapper:(0,d.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignSelf:"center"})}))),o=i?`Remove  ${n} from favorites`:`Add ${n} to favorites`;return l().createElement("span",{className:s.wrapper},l().createElement(c.ToolbarButton,{onMouseOver:()=>{e.setHover(!0)},onMouseOut:()=>{e.setHover(!1)},icon:l().createElement(c.Icon,{name:i?"favorite":"star",size:"lg",type:i?"mono":"default"}),color:i?"rgb(235, 123, 24)":"#ccc",onClick:()=>e.onClick(i),name:"star","aria-label":o,tooltip:o}))},(a="Component")in(r=g)?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i},6939:(e,t,n)=>{n.d(t,{XU:()=>re,yj:()=>se});var r=n(6089),a=n(3241),i=n(5959),s=n.n(i),o=n(7781),l=n(7141),c=n(2007),d=n(227),u=n(3143),p=n(2718),g=n(8835),h=n(4750),v=n(4793),m=n(1220),f=n(9055);function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t,n){const r=(0,h.cR)(n);(0,p.EE)(p.NO.service_selection,p.ir.service_selection.service_selected,{value:t,label:e});const a=[...r.state.filters.filter((n=>!(n.key===e&&n.value===t))),{key:e,operator:v.w.Equal,value:t}];r.setState({filters:a}),(0,f._J)(e,t,n),e===u.OX&&(e=u.ky),(0,g.jY)(e,t)}class S extends l.Bs{constructor(...e){super(...e),b(this,"onClick",(()=>{this.state.labelValue&&y(this.state.labelName,this.state.labelValue,this)}))}}function w(e){return{button:(0,r.css)({alignSelf:"center"})}}b(S,"Component",(({model:e})=>{const t=(0,c.useStyles2)(w);return s().createElement(c.Button,{"data-testid":m.b.index.showLogsButton,tooltip:`View logs for ${e.state.labelValue}`,className:t.button,variant:"secondary",size:"sm",onClick:e.onClick},"Show logs")}));var O=n(7918),E=n(5183),x=n(4482);const C=()=>s().createElement(x.R,null,s().createElement("p",null,"Log volume has not been configured."),s().createElement("p",null,s().createElement(c.TextLink,{href:"https://grafana.com/docs/loki/latest/reference/api/#query-log-volume",external:!0},"Instructions to enable volume in the Loki config:")),s().createElement(c.Text,{textAlignment:"left"},s().createElement("pre",null,s().createElement("code",null,"limits_config:",s().createElement("br",null),"  volume_enabled: true")))),L=()=>s().createElement(x.R,null,s().createElement("p",null,"No service matched your search."));var k=n(1383),j=n(4462),P=n(5431),_=n(833),T=n(8531),F=n(5435),D=n(4002),N=n(4235),$=n(8315);function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class I extends l.Bs{}A(I,"Component",(({model:e})=>{const t=l.jh.getAncestor(e,se),n=l.jh.getAncestor(e,V),{tabOptions:r,showPopover:a}=n.useState(),i=(0,c.useStyles2)(M),o=r.map((e=>{return t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){A(e,t,n[t])}))}return e}({},e),n=null!=(n={icon:e.saved?"save":void 0,label:`${e.label}`})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t;var t,n}));return s().createElement(c.Stack,{direction:"column",gap:0,role:"tooltip"},s().createElement("div",{className:i.card.body},s().createElement(c.Select,{menuShouldPortal:!1,width:50,onBlur:()=>{n.toggleShowPopover()},autoFocus:!0,isOpen:a,placeholder:"Search labels",options:o,isSearchable:!0,openMenuOnFocus:!0,onChange:e=>{e.value&&(n.toggleShowPopover(),t.setSelectedTab(e.value))}})))}));const M=e=>({card:{body:(0,r.css)({padding:e.spacing(1)}),p:(0,r.css)({maxWidth:300})}});function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){B(e,t,n[t])}))}return e}class V extends l.Bs{getLabelsFromQueryRunnerState(e=(()=>{var e;return null===(e=this.state.$labelsData)||void 0===e?void 0:e.state})()){var t;return null===(t=e.data)||void 0===t?void 0:t.series[0].fields.map((e=>({label:e.name,cardinality:e.values[0]})))}populatePrimaryLabelsVariableOptions(e){const t=l.jh.getAncestor(this,se).getSelectedTab(),n=(0,d.sj)((0,h.S9)(this).getValue().toString()),r=e.map((e=>{const r=n.indexOf(e.label);return{label:e.label===u.OX?u.ky:e.label,value:e.label,active:t===e.label,saved:-1!==r,savedIndex:r}})).sort(((e,t)=>e.value===u.OX||t.value===u.OX?e.value===u.OX?-1:1:e.label<t.label?-1:e.label>t.label?1:0));this.setState({tabOptions:r})}runDetectedLabels(){this.state.$labelsData.runQueries()}runDetectedLabelsSubs(){this._subs.add(l.jh.getTimeRange(this).subscribeToState((()=>{this.runDetectedLabels()}))),this._subs.add((0,h.S9)(this).subscribeToState((()=>{this.runDetectedLabels()})))}onActivate(){this.runDetectedLabels(),this.setState({popover:new I({})}),this.runDetectedLabelsSubs(),this._subs.add((0,h.S9)(this).subscribeToState((()=>{this.state.$labelsData.runQueries()}))),this._subs.add((0,h.El)(this).subscribeToState((()=>{var e;const t=this.getLabelsFromQueryRunnerState(null===(e=this.state.$labelsData)||void 0===e?void 0:e.state);t&&this.populatePrimaryLabelsVariableOptions(t)}))),this._subs.add(this.state.$labelsData.subscribeToState((e=>{var t;if((null===(t=e.data)||void 0===t?void 0:t.state)===o.LoadingState.Done){const t=this.getLabelsFromQueryRunnerState(e),n=l.jh.getAncestor(this,se);t&&this.populatePrimaryLabelsVariableOptions(t);const r=n.getSelectedTab();(null==t?void 0:t.some((e=>e.label===r)))||n.selectDefaultLabelTab()}})))}constructor(e){super(R({showPopover:!1,$labelsData:(0,E.HF)({queries:[(0,O.BM)("","detected_labels")],runQueriesMode:"manual"}),tabOptions:[{label:u.ky,value:u.OX,saved:!0}]},e)),B(this,"removeSavedTab",(e=>{(0,d.Gg)((0,h.S9)(this).getValue().toString(),e);const t=this.getLabelsFromQueryRunnerState();t&&this.populatePrimaryLabelsVariableOptions(t);const n=l.jh.getAncestor(this,se);n.getSelectedTab()===e&&n.selectDefaultLabelTab()})),B(this,"toggleShowPopover",(()=>{this.setState({showPopover:!this.state.showPopover})})),this.addActivationHandler(this.onActivate.bind(this))}}B(V,"Component",(({model:e})=>{const{tabOptions:t,showPopover:n,popover:d,$labelsData:p}=e.useState(),{data:g}=p.useState(),v=l.jh.getAncestor(e,se);(0,h.El)(e).useState();const m=(0,c.useStyles2)(W),f=(0,i.useRef)(null);return s().createElement(c.TabsBar,null,t.filter((e=>e.saved||e.active||e.value===u.OX)).sort(((e,t)=>{return e.value===u.OX||t.value===u.OX?e.value===u.OX?-1:1:(null!==(n=e.savedIndex)&&void 0!==n?n:0)-(null!==(r=t.savedIndex)&&void 0!==r?r:0);var n,r})).map((t=>{const n=s().createElement(c.Tab,{key:t.value,onChangeTab:()=>{v.setSelectedTab(t.value)},label:(0,$.EJ)(t.label,15,!0),active:t.active,suffix:t.value!==u.OX?n=>s().createElement(s().Fragment,null,s().createElement(c.Tooltip,{content:"Remove tab"},s().createElement(c.Icon,{onKeyDownCapture:n=>{"Enter"===n.key&&e.removeSavedTab(t.value)},onClick:n=>{n.stopPropagation(),e.removeSavedTab(t.value)},name:"times",className:(0,r.cx)(n.className)}))):void 0});return t.label.length>15?s().createElement(c.Tooltip,{key:t.value,content:t.label},n):n})),(null==g?void 0:g.state)===o.LoadingState.Loading&&s().createElement(c.Tab,{label:"Loading tabs",icon:"spinner"}),(null==g?void 0:g.state)===o.LoadingState.Done&&s().createElement("span",{className:m.addTab},s().createElement(c.Tab,{onChangeTab:e.toggleShowPopover,label:"Add label",ref:f,icon:"plus-circle"})),d&&s().createElement(c.PopoverController,{content:s().createElement(d.Component,{model:d})},((e,t,r)=>{const i={onBlur:t,onFocus:e};return s().createElement(s().Fragment,null,f.current&&s().createElement(s().Fragment,null,s().createElement(c.Popover,R((o=R({},r,a.rest),l=null!=(l={show:n,wrapperClassName:m.popover,referenceElement:f.current,renderArrow:!0})?l:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(l)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(l,e))})),o),i))));var o,l})))}));const W=e=>({addTab:(0,r.css)({label:"add-label-tab",color:e.colors.primary.text,"& button":{color:e.colors.primary.text}}),popover:(0,r.css)({borderRadius:e.shape.radius.default,boxShadow:e.shadows.z3,background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`})});var z=n(866);const H=e=>s().createElement(x.R,null,s().createElement("p",null,"No logs found in ",s().createElement("strong",null,e.labelName),".",s().createElement("br",null),"Please adjust time range or select another label."));var U=n(9829),G=n(558);function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){q(e,t,n[t])}))}return e}class J extends l.Bs{onActivate(){this.setState(Q({},this.isSelected())),this._subs.add((0,h.cR)(this).subscribeToState((()=>{const e=this.isSelected();this.state.included!==e.included&&this.setState(Q({},e))})))}getFilter(){return{name:this.state.name,value:this.state.value}}constructor(e){var t,n;super((t=Q({},e),n=null!=(n={included:null})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t)),q(this,"isSelected",(()=>{const e=(0,h.cR)(this),t=e.state.filters.find((t=>{const n=(0,h.z2)(e,t);return t.key===this.state.name&&n.value===this.state.value}));return t?{included:t.operator===v.w.Equal}:{included:!1}})),q(this,"onClick",(e=>{const t=this.getFilter();(0,G.Qt)(t.name,t.value,e,this,u.MB);const n=(0,h.cR)(this);(0,p.EE)(p.NO.service_selection,p.ir.service_selection.add_to_filters,{filterType:"index-filters",key:t.name,action:e,filtersLength:(null==n?void 0:n.state.filters.length)||0}),this.setState(Q({},this.isSelected()))})),this.addActivationHandler(this.onActivate.bind(this))}}q(J,"Component",(({model:e})=>{const{value:t,hidden:n,included:r}=e.useState();if(n)return s().createElement(s().Fragment,null);const a=(0,c.useStyles2)(K);return s().createElement("span",{className:a.wrapper},s().createElement(c.Button,{tooltip:!0===r?`Remove ${t} from filters`:`Add ${t} to filters`,variant:"secondary",fill:"outline",icon:!0===r?"minus":"plus",size:"sm","aria-selected":!0===r,className:a.includeButton,onClick:()=>!0===r?e.onClick("clear"):e.onClick("include"),"data-testid":m.b.exploreServiceDetails.buttonFilterInclude}))}));const K=()=>({container:(0,r.css)({display:"flex",justifyContent:"center"}),includeButton:(0,r.css)({borderRadius:0}),wrapper:(0,r.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignSelf:"center"})});var Y=n(6059);function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){X(e,t,n[t])}))}return e}function ee(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const te=T.config.featureToggles.exploreLogsAggregatedMetrics,ne="__aggregated_metric__",re=(0,o.dateTime)("2024-08-30","YYYY-MM-DD"),ae="var-primary_label",ie="var-ds";class se extends l.Bs{getUrlState(){const{key:e}=oe(),t=(0,h.El)(this).state.filters[0];return t.key&&t.key!==e&&(0,h.El)(this).setState({filters:[ee(Z({},t),{key:null!=e?e:t.key})]}),{}}updateFromUrl(e){}addDatasourceChangeToBrowserHistory(e){const t=T.locationService.getLocation(),n=new URLSearchParams(t.search),r=n.get(ie);if(r&&e!==r){const r=t.pathname+t.search;n.set(ie,e);const a=t.pathname+"?"+n.toString();r!==a&&(0,g.ad)(a)}}addLabelChangeToBrowserHistory(e,t=!1){const{key:n,search:r,location:a}=oe();if(n){const i=null==n?void 0:n.split("|");if((null==i?void 0:i[0])!==e){i[0]=e,r.set(ae,i.join("|"));const n=a.pathname+a.search,s=a.pathname+"?"+r.toString();n!==s&&(t?T.locationService.replace(s):(0,g.ad)(s))}}}getSelectedTab(){var e;return null===(e=(0,h.El)(this).state.filters[0])||void 0===e?void 0:e.key}selectDefaultLabelTab(){this.addLabelChangeToBrowserHistory(u.OX,!0),this.setSelectedTab(u.OX)}setSelectedTab(e){(0,d.cO)((0,h.S9)(this).getValue().toString(),e),(0,h.h)(this),(0,h.BL)(e,this)}buildServiceLayout(e,t,n,r,a,i){var s;let d;n.to.diff(n.from,"hours")>=4&&n.to.diff(n.from,"hours")<=26&&(d="2h");const p=l.d0.timeseries().setTitle(t).setData((0,E.rS)([(0,O.l)(this.getMetricExpression(t,r,a),{legendFormat:`{{${u.e4}}}`,splitDuration:d,refId:`ts-${t}`})],{runQueriesMode:"manual"})).setCustomFieldConfig("stacking",{mode:c.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",c.DrawStyle.Bars).setUnit("short").setOverrides(E.jC).setOption("legend",{showLegend:!0,calcs:["sum"],placement:"right",displayMode:c.LegendDisplayMode.Table}).setHeaderActions([new z.p({ds:null===(s=i.getValue())||void 0===s?void 0:s.toString(),labelName:e,labelValue:t}),new J({name:e,value:t,hidden:this.isAggregatedMetricsActive()}),new S({labelValue:t,labelName:e})]).build();p.setState({extendPanelContext:(n,r)=>this.extendTimeSeriesLegendBus(e,t,r,p)});const g=new l.xK({$behaviors:[new l.Gg.K2({key:"serviceCrosshairSync",sync:o.DashboardCursorSync.Crosshair})],body:p});return g.addActivationHandler((()=>{var e;(null===(e=(0,U.oh)(g)[0].state.data)||void 0===e?void 0:e.state)!==o.LoadingState.Done&&this.runPanelQuery(g)})),g}isAggregatedMetricsActive(){const e=this.getQueryOptionsToolbar();return!(null==e?void 0:e.state.options.aggregatedMetrics.disabled)&&(null==e?void 0:e.state.options.aggregatedMetrics.active)}formatPrimaryLabelForUI(){const e=this.getSelectedTab();return e===u.OX?u.ky:e}setVolumeQueryRunner(){this.setState({$data:(0,E.HF)({queries:[(0,O.$k)(`{${u.kl}, ${u.ll}}`,"volume",this.getSelectedTab())],runQueriesMode:"manual"})}),this.subscribeToVolume()}doVariablesNeedSync(){const e=(0,h.cR)(this),t=(0,h.aW)(this),n=this.getSelectedTab(),r=e.state.filters.filter((e=>e.key!==n));return{filters:r,needsSync:!(0,_.B)(r,t.state.filters)}}syncVariables(){const e=(0,h.aW)(this),{filters:t,needsSync:n}=this.doVariablesNeedSync();n&&e.setState({filters:t})}onActivate(){var e;this.fixRequiredUrlParams(),this.syncVariables(),this.setVolumeQueryRunner(),this.subscribeToPrimaryLabelsVariable(),this.subscribeToLabelFilterChanges(),this.subscribeToActiveTabVariable((0,h.El)(this)),(null===(e=this.state.$data.state.data)||void 0===e?void 0:e.state)!==o.LoadingState.Done&&this.runVolumeOnActivate(),this.subscribeToTimeRange(),this.subscribeToDatasource(),this.subscribeToAggregatedMetricToggle(),this.subscribeToAggregatedMetricVariable()}runVolumeOnActivate(){var e,t;this.isTimeRangeTooEarlyForAggMetrics()?(this.onUnsupportedAggregatedMetricTimeRange(),(null===(e=this.state.$data.state.data)||void 0===e?void 0:e.state)!==o.LoadingState.Done&&this.runVolumeQuery()):(this.onSupportedAggregatedMetricTimeRange(),(null===(t=this.state.$data.state.data)||void 0===t?void 0:t.state)!==o.LoadingState.Done&&this.runVolumeQuery())}subscribeToAggregatedMetricToggle(){var e;this._subs.add(null===(e=this.getQueryOptionsToolbar())||void 0===e?void 0:e.subscribeToState(((e,t)=>{e.options.aggregatedMetrics.userOverride!==t.options.aggregatedMetrics.userOverride&&this.runVolumeQuery(!0)})))}subscribeToDatasource(){this._subs.add((0,h.S9)(this).subscribeToState((e=>{this.addDatasourceChangeToBrowserHistory(e.value.toString()),this.runVolumeQuery()})))}subscribeToActiveTabVariable(e){this._subs.add(e.subscribeToState(((e,t)=>{if(e.filterExpression!==t.filterExpression){const t=e.filters[0].key;this.addLabelChangeToBrowserHistory(t);const{needsSync:n}=this.doVariablesNeedSync();n?this.syncVariables():this.runVolumeQuery(!0)}})))}subscribeToAggregatedMetricVariable(){this._subs.add((0,h.vm)(this).subscribeToState(((e,t)=>{e.value!==t.value&&(this.setState({body:new l.gF({children:[]})}),this.updateBody(!0))})))}subscribeToPrimaryLabelsVariable(){const e=(0,h.cR)(this);this._subs.add(e.subscribeToState(((e,t)=>{(0,_.B)(e.filters,t.filters)||this.syncVariables()})))}subscribeToLabelFilterChanges(){const e=(0,h.aW)(this);this._subs.add(e.subscribeToState(((e,t)=>{(0,_.B)(e.filters,t.filters)||this.runVolumeQuery(!0)})))}subscribeToVolume(){this._subs.add(this.state.$data.subscribeToState(((e,t)=>{var n,r,a;(null===(n=e.data)||void 0===n?void 0:n.state)!==o.LoadingState.Done||(0,_.B)(null==t||null===(r=t.data)||void 0===r?void 0:r.series,null==e||null===(a=e.data)||void 0===a?void 0:a.series)||this.updateBody(!0)})))}subscribeToTimeRange(){this._subs.add(l.jh.getTimeRange(this).subscribeToState((()=>{this.isTimeRangeTooEarlyForAggMetrics()?this.onUnsupportedAggregatedMetricTimeRange():this.onSupportedAggregatedMetricTimeRange(),this.runVolumeQuery()})))}fixRequiredUrlParams(){const{key:e}=oe();e||this.selectDefaultLabelTab()}isTimeRangeTooEarlyForAggMetrics(){return l.jh.getTimeRange(this).state.value.from.isBefore((0,o.dateTime)(re))}onUnsupportedAggregatedMetricTimeRange(){const e=this.getQueryOptionsToolbar();null==e||e.setState({options:{aggregatedMetrics:ee(Z({},null==e?void 0:e.state.options.aggregatedMetrics),{disabled:!0})}})}getQueryOptionsToolbar(){return l.jh.getAncestor(this,N.PR).state.controls.find((e=>e instanceof D.s))}onSupportedAggregatedMetricTimeRange(){const e=this.getQueryOptionsToolbar();null==e||e.setState({options:{aggregatedMetrics:ee(Z({},null==e?void 0:e.state.options.aggregatedMetrics),{disabled:!1})}})}runVolumeQuery(e=!1){e&&this.setVolumeQueryRunner(),this.updateAggregatedMetricVariable(),this.state.$data.runQueries()}updateAggregatedMetricVariable(){const e=(0,h.vm)(this),t=(0,h.cR)(this);this.isTimeRangeTooEarlyForAggMetrics()&&te||!this.isAggregatedMetricsActive()?(e.changeValueTo(u.OX),t.setState({hide:F.zL.dontHide}),e.changeValueTo(u.OX),l.jh.findByKeyAndType(this,N.yQ,Y.H).setState({hidden:!1})):(e.changeValueTo(ne),t.setState({hide:F.zL.hideVariable,filters:[]}),l.jh.findByKeyAndType(this,N.yQ,Y.H).setState({hidden:!0}))}updateTabs(){if(!this.state.tabs){const e=new V({});this.setState({tabs:e})}}getGridItems(){return this.state.body.state.children}getVizPanel(e){return e.state.body instanceof l.Eb?e.state.body:void 0}runPanelQuery(e){if(e.isActive){const n=(0,U.oh)(e);if(1===n.length){var t;const e=n[0],r=e.state.queries[0],a=null===(t=e.state.data)||void 0===t?void 0:t.timeRange,i=l.jh.getTimeRange(this),s=a?Math.abs(i.state.value.from.diff(null==a?void 0:a.from,"s")):1/0,o=a?Math.abs(i.state.value.to.diff(null==a?void 0:a.to,"s")):1/0,c=l.jh.interpolate(this,r.expr);(e.state.key!==c||s>0||o>0)&&(e.setState({key:c}),e.runQueries())}}}updateBody(e=!1){var t;const{labelsToQuery:n}=this.getLabels(null===(t=this.state.$data.state.data)||void 0===t?void 0:t.series),r=this.getSelectedTab();if(this.updateTabs(),n&&0!==n.length){const t=[],a=this.getGridItems(),i=l.jh.getTimeRange(this).state.value,s=(0,h.vm)(this),o=(0,h.El)(this),c=(0,h.S9)(this);for(const l of n.slice(0,20)){const n=a.filter((e=>{const t=this.getVizPanel(e);return(null==t?void 0:t.state.title)===l}));if(2===n.length)t.push(n[0],n[1]),n[0].isActive&&e&&this.runPanelQuery(n[0]),n[1].isActive&&e&&this.runPanelQuery(n[1]);else{const e=this.buildServiceLayout(r,l,i,s,o,c),n=this.buildServiceLogsLayout(r,l);t.push(e,n)}}this.state.body.setState({children:t,isLazy:!0,templateColumns:"repeat(auto-fit, minmax(500px, 1fr) minmax(300px, 70vw))",autoRows:"200px",md:{templateColumns:"1fr",rowGap:1,columnGap:1}})}else this.state.body.setState({children:[]})}updateServiceLogs(e,t){var n;if(!this.state.body)return void this.updateBody();const{labelsToQuery:r}=this.getLabels(null===(n=this.state.$data.state.data)||void 0===n?void 0:n.series),a=null==r?void 0:r.indexOf(t);if(void 0===a||a<0)return;let i=[...this.getGridItems()];i.splice(2*a+1,1,this.buildServiceLogsLayout(e,t)),this.state.body.setState({children:i})}getLogExpression(e,t,n){return`{${e}=\`${t}\` , ${u.ll} }${n}`}getMetricExpression(e,t,n){const r=n.state.filters[0];return t.state.value===ne?r.key===u.OX?`sum by (${u.e4}) (sum_over_time({${ne}=\`${e}\` } | logfmt | unwrap count [$__auto]))`:`sum by (${u.e4}) (sum_over_time({${ne}=~\`.+\` } | logfmt | ${r.key}=\`${e}\` | unwrap count [$__auto]))`:`sum by (${u.e4}) (count_over_time({ ${r.key}=\`${e}\`, ${u.ll} } [$__auto]))`}getLabels(e){var t,n,r;const a=null!==(r=null==e||null===(t=e[0])||void 0===t?void 0:t.fields[0].values)&&void 0!==r?r:[],i=null===(n=(0,h.S9)(this).getValue())||void 0===n?void 0:n.toString(),s=(0,h.eY)(this).getValue(),o=this.getSelectedTab(),l=function(e,t,n,r){if(!(null==e?void 0:e.length))return[];".+"===n&&(n="");const a=(0,d.eT)(t,r).filter((t=>t.toLowerCase().includes(n.toLowerCase())&&e.includes(t)));return Array.from(new Set([...a,...e]))}(a,i,String(s),o);return{labelsByVolume:a,labelsToQuery:l}}constructor(e){var t;super(Z({body:new l.gF({children:[]}),$variables:new l.Pj({variables:[new P.m({name:u.Du,label:"Service",hide:F.zL.hideVariable,skipUrlSync:!0,value:".+"}),new P.m({name:u.Wi,label:"",hide:F.zL.hideLabel,value:u.OX,skipUrlSync:!0,options:[{value:u.OX,label:u.OX},{value:ne,label:ne}]}),new l.H9({name:u.Gb,hide:F.zL.hideLabel,expressionBuilder:e=>function(e){if(e.length){const t=e[0];return`${t.key}${t.operator}\`${t.value}\``}return""}(e),filters:[{key:null!==(t=oe().key)&&void 0!==t?t:u.OX,value:".+",operator:"=~"}]}),new l.H9({name:u.fi,datasource:u.eL,layout:"vertical",filters:[],expressionBuilder:O.VW,hide:F.zL.hideVariable,key:"adhoc_service_filter_replica",skipUrlSync:!0})]}),$data:(0,E.HF)({queries:[],runQueriesMode:"manual"}),serviceLevel:new Map,showPopover:!1,tabOptions:[{label:u.ky,value:u.OX}]},e)),X(this,"_urlSync",new l.So(this,{keys:[ae]})),X(this,"onSearchServicesChange",(0,a.debounce)((e=>{const t=(0,h.eY)(this);(e?(0,O.vC)(e):".+")!==t.state.value&&t.setState({value:e?(0,O.vC)(e):".+",label:null!=e?e:""});const n=(0,h.El)(this),r=n.state.filters[0];(0,O.vC)(t.state.value.toString())!==r.value&&n.setState({filters:[ee(Z({},r),{value:(0,O.vC)(t.state.value.toString())})]}),(0,p.EE)(p.NO.service_selection,p.ir.service_selection.search_services_changed,{searchQuery:e})}),500)),X(this,"getLevelFilterForService",(e=>{let t=this.state.serviceLevel.get(e)||[];return 0===t.length?"":` | ${t.map((e=>("logs"===e&&(e=""),`${u.e4}=\`${e}\``))).join(" or ")} `})),X(this,"buildServiceLogsLayout",((e,t)=>{const n=this.getLevelFilterForService(t),r=new l.xK({$behaviors:[new l.Gg.K2({sync:o.DashboardCursorSync.Off})],body:l.d0.logs().setHoverHeader(!0).setData((0,E.rS)([(0,O.l)(this.getLogExpression(e,t,n),{maxLines:100,refId:`logs-${t}`})],{runQueriesMode:"manual"})).setTitle(t).setOption("showTime",!0).setOption("enableLogDetails",!1).build()});return r.addActivationHandler((()=>{var e;(null===(e=(0,U.oh)(r)[0].state.data)||void 0===e?void 0:e.state)!==o.LoadingState.Done&&this.runPanelQuery(r)})),r})),X(this,"extendTimeSeriesLegendBus",((e,t,n,r)=>{const a=n.onToggleSeriesVisibility;n.onToggleSeriesVisibility=(n,i)=>{var s,o,l;null==a||a(n,i);const c=(0,k.de)(null!==(l=null===(o=r.state.$data)||void 0===o||null===(s=o.state.data)||void 0===s?void 0:s.series)&&void 0!==l?l:[]),d=(0,k.pC)(n,this.state.serviceLevel.get(t),i,c);this.state.serviceLevel.set(t,d),this.updateServiceLogs(e,t)}})),this.addActivationHandler(this.onActivate.bind(this))}}function oe(){const e=T.locationService.getLocation(),t=new URLSearchParams(e.search),n=t.get(ae),r=null==n?void 0:n.split("|");return{key:null==r?void 0:r[0],search:t,location:e}}function le(e){return{container:(0,r.css)({display:"flex",flexDirection:"column",flexGrow:1,position:"relative"}),headingWrapper:(0,r.css)({marginTop:e.spacing(1)}),loadingText:(0,r.css)({margin:0}),header:(0,r.css)({position:"absolute",right:0,top:"4px",zIndex:2}),bodyWrapper:(0,r.css)({flexGrow:1,display:"flex",flexDirection:"column"}),body:(0,r.css)({flexGrow:1,display:"flex",flexDirection:"column"}),icon:(0,r.css)({color:e.colors.text.disabled,marginLeft:e.spacing.x1}),searchFieldPlaceholderText:(0,r.css)({fontSize:e.typography.bodySmall.fontSize,color:e.colors.text.disabled,alignItems:"center",display:"flex"}),searchWrapper:(0,r.css)({display:"flex",alignItems:"center",flexWrap:"wrap"}),searchField:(0,r.css)({marginTop:e.spacing(1),position:"relative"})}}X(se,"Component",(({model:e})=>{var t;const n=(0,c.useStyles2)(le),{body:r,$data:a,tabs:i}=e.useState(),{data:l}=a.useState(),d=e.getSelectedTab(),u=(0,h.eY)(e),{label:p,value:g}=u.useState(),v=g&&".+"!==g,{labelsByVolume:m,labelsToQuery:f}=e.getLabels(null==l?void 0:l.series),b=(null==l?void 0:l.state)===o.LoadingState.Loading||(null==l?void 0:l.state)===o.LoadingState.Streaming||void 0===l,S=(null===(t=a.state.data)||void 0===t?void 0:t.state)===o.LoadingState.Error;var w;const E=null!==(w=null==f?void 0:f.length)&&void 0!==w?w:0,x=r.state.children.length/2,k=e.formatPrimaryLabelForUI();let P=u.getValue().toString();".+"===P&&(P="");const _=(0,O.sT)(P);var T;return s().createElement("div",{className:n.container},s().createElement("div",{className:n.bodyWrapper},i&&s().createElement(i.Component,{model:i}),s().createElement(c.Field,{className:n.searchField},s().createElement("div",{className:n.searchWrapper},s().createElement(j.f,{initialFilter:{label:_,value:P,icon:"filter"},isLoading:b,value:P||p,onChange:t=>(t=>{e.onSearchServicesChange(t)})(t),selectOption:t=>{y(d,t,e)},label:k,options:null!==(T=null==f?void 0:f.map((e=>({value:e,label:e}))))&&void 0!==T?T:[]}),!b&&s().createElement("span",{className:n.searchFieldPlaceholderText},"Showing ",x," of ",E," ",s().createElement(c.IconButton,{className:n.icon,"aria-label":"Count info",name:"info-circle",tooltip:`${E} labels have values for the selected time range. Total label count may differ`})))),!b&&S&&s().createElement(C,null),!b&&!S&&v&&!(null==m?void 0:m.length)&&s().createElement(L,null),!b&&!S&&!v&&!(null==m?void 0:m.length)&&s().createElement(H,{labelName:d}),!(!b&&S)&&s().createElement("div",{className:n.body},s().createElement(r.Component,{model:r}))))}))},8760:(e,t,n)=>{n.d(t,{C:()=>s});var r=n(5959),a=n.n(r),i=n(2007);function s(e){return a().createElement(i.RadioButtonGroup,{options:[{label:"Logs",value:"logs",description:"Show results in logs visualisation"},{label:"Table",value:"table",description:"Show results in table visualisation"}],size:"sm",value:e.vizType,onChange:e.onChange})}},5431:(e,t,n)=>{n.d(t,{m:()=>s});var r=n(1269),a=n(7141);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class s extends a.n8{getValueOptions(e){return(0,r.of)(this.state.options)}constructor(e){super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){i(e,t,n[t])}))}return e}({type:"custom",value:"",text:"",options:[],name:""},e))}}i(s,"Component",(({model:e})=>(0,a.yC)(e)))},2718:(e,t,n)=>{n.d(t,{EE:()=>i,NO:()=>s,ir:()=>o});var r=n(8531),a=n(2533);const i=(e,t,n)=>{(0,r.reportInteraction)(((e,t)=>`${a.id.replace(/-/g,"_")}_${e}_${t}`)(e,t),n)},s={service_selection:"service_selection",service_details:"service_details",all:"all"},o={[s.service_selection]:{search_services_changed:"search_services_changed",service_selected:"service_selected",aggregated_metrics_toggled:"aggregated_metrics_toggled",add_to_filters:"add_to_filters"},[s.service_details]:{open_in_explore_clicked:"open_in_explore_clicked",action_view_changed:"action_view_changed",add_to_filters_in_breakdown_clicked:"add_to_filters_in_breakdown_clicked",select_field_in_breakdown_clicked:"select_field_in_breakdown_clicked",level_in_logs_volume_clicked:"level_in_logs_volume_clicked",layout_type_changed:"layout_type_changed",search_string_in_logs_changed:"search_string_in_logs_changed",pattern_removed:"pattern_removed",pattern_selected:"pattern_selected",pattern_field_clicked:"pattern_field_clicked",logs_visualization_toggle:"logs_visualization_toggle",logs_detail_filter_applied:"logs_detail_filter_applied",logs_popover_line_filter:"logs_popover_line_filter",logs_toggle_displayed_field:"logs_toggle_displayed_field",logs_clear_displayed_fields:"logs_clear_displayed_fields",value_breakdown_sort_change:"value_breakdown_sort_change",wasm_not_supported:"wasm_not_supported",change_viz_type:"change_viz_type"},[s.all]:{interval_too_long:"interval_too_long",open_in_explore_menu_clicked:"open_in_explore_menu_clicked"}}},833:(e,t,n)=>{n.d(t,{B:()=>i,n:()=>s});var r=n(3241),a=n.n(r);const i=(e,t)=>{if(typeof e!=typeof t)return!1;const n=new Set(e),r=new Set(t);return n.size===r.size&&a().isEqual(n,r)},s=(e,t)=>typeof e==typeof t&&a().isEqual(e,t)},7322:(e,t,n)=>{n.r(t),n.d(t,{DETECTED_FIELDS_CARDINALITY_NAME:()=>Y,DETECTED_FIELDS_NAME_FIELD:()=>K,DETECTED_FIELDS_PARSER_NAME:()=>X,DETECTED_FIELDS_TYPE_NAME:()=>Z,WRAPPED_LOKI_DS_UID:()=>J,WrappedLokiDatasource:()=>ee,default:()=>te});var r=n(7781),a=n(8531),i=n(7141),s=n(3321),o=n(1269),l=n(9829),c=n(892),d=n(6001),u=n(3143),p=n(2533),g=n(5745),h=n(2344),v=n(8682);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){m(e,t,n[t])}))}return e}function b(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function y(e){if(function(e){return void 0!==e.targets.find((e=>function(e){return e.trim().length>2&&!function(e,t){let n=!1;return h.K3.parse(e).iterate({enter:({type:e})=>{if(e.id===t)return n=!0,!1}}),n}(e,h.Yw)}(e.expr)))}(e))return!1;if(function(e){return e.targets.find((e=>"instant"===e.queryType))}(e))return!1;for(let n=0;n<e.targets.length;n++){var t;if(null===(t=e.targets[n].expr)||void 0===t?void 0:t.includes("avg_over_time"))return!1}return!0}const S="__stream_shard_number__",w=e=>e.replace("}",`, __stream_shard__=~"${S}"}`),O=(e,t)=>{if(void 0===t||0===t.length)return e.map((e=>b(f({},e),{expr:e.expr.replace(`, __stream_shard__=~"${S}"}`,"}")})));let n=t.join("|");return"-1"===n||1===t.length?(n="-1"===n?"":n,e.map((e=>b(f({},e),{expr:e.expr.replace(`, __stream_shard__=~"${S}"}`,`, __stream_shard__="${n}"}`)})))):e.map((e=>b(f({},e),{expr:e.expr.replace(new RegExp(`${S}`,"g"),n)})))};var E=n(2871);function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}function L(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function k(e,t,n){const a=(0,r.closestIdx)(t.values[n],e.values);return a<0?0:t.values[n]===e.values[a]&&null!=t.nanos&&null!=e.nanos?t.nanos[n]>e.nanos[a]?a+1:a:t.values[n]>e.values[a]?a+1:a}function j(e,t,n,r,a,i){const s=function(e,t,n,r){return e.nanos&&n.nanos?void 0!==e.values[t]&&e.values[t]===n.values[r]&&void 0!==e.nanos[t]&&e.nanos[t]===n.nanos[r]:void 0!==e.values[t]&&e.values[t]===n.values[r]}(e,n,r,i);return!!s&&(null==t||null==a||void 0!==t.values[n]&&t.values[n]===a.values[i])}function P(e,t,n){const r=t.filter((t=>t.name===e.name));return 1===r.length?r[0]:t[n]}const _="Summary: total bytes processed";function T(e,t){const n=e.find((e=>e.displayName===_)),r=t.find((e=>e.displayName===_));if(null!=r&&null!=n)return[{value:r.value+n.value,displayName:_,unit:n.unit}];const a=null!=r?r:n;return null!=a?[a]:[]}function F(e){return L(C({},e),{fields:e.fields.map((e=>L(C({},e),{values:e.values})))})}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){D(e,t,n[t])}))}return e}function $(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function A(e,t){const n=e.interpolateVariablesInQueries(t.targets,t.scopedVars).filter((e=>e.expr)).map((e=>$(N({},e),{expr:w(e.expr)})));return function(e,t,n){let a=!1,i={data:[],state:r.LoadingState.Streaming,key:(0,g.A)()},s=null,l=new Map,c=null;const d=(o,u,p,g)=>{let h=g,v=!1;null!=s&&(s.unsubscribe(),s=null);const m=()=>{i.state=a?r.LoadingState.Error:r.LoadingState.Done,o.next(i),o.complete()};if(a)return void m();const f=()=>{const e=Math.min(u+g,p.length);u<p.length&&e<=p.length?d(o,e,p,h):m()},b=e=>{try{if(e&&!function(e){var t,n,r;const a=e.errors?(null!==(n=e.errors[0].message)&&void 0!==n?n:"").toLowerCase():null!==(r=null===(t=e.error)||void 0===t?void 0:t.message)&&void 0!==r?r:"";if(a.includes("timeout"))return!0;if(a.includes("parse error"))throw new Error(a);return!1}(e))return!1}catch(o){var t,n,r,i,s,h;return E.v.error(o,{msg:"sharding retry error",error:null!==(i=null==e||null===(t=e.error)||void 0===t?void 0:t.message)&&void 0!==i?i:"",errors:null!==(s=null==e||null===(n=e.errors)||void 0===n?void 0:n.map((e=>e.message)).join(" | "))&&void 0!==s?s:"",traces:null!==(h=null==e||null===(r=e.traceIds)||void 0===r?void 0:r.join("|"))&&void 0!==h?h:""}),a=!0,!1}if(g>1)return M(`Possible time out, new group size ${g=Math.floor(Math.sqrt(g))}`),v=!0,d(o,u,p,g),!0;var m;const f=null!==(m=l.get(u))&&void 0!==m?m:0;return f>3?(a=!0,!1):(l.set(u,f+1),c=setTimeout((()=>{E.v.info(`Retrying ${u} (${f+1})`),d(o,u,p,g),c=null}),1500*Math.pow(2,f)),v=!0,!0)},y=function(e,t,n){return t===e.length?[-1]:e.slice(t,t+n)}(p,u,g);M(`Querying ${y.join(", ")}`);const S=$(N({},t),{targets:O(n,y)});t.requestId&&(S.requestId=`${t.requestId}_shard_${u}_${g}`),s=e.runQuery(S).subscribe({next:e=>{var t;((null!==(t=e.errors)&&void 0!==t?t:[]).length>0||null!=e.error)&&b(e)||(h=function(e,t,n){return Math.min(t,Math.max(Math.floor(.7*(n-e)),1))}(u+g,function(e,t){var n,r;if(!e.data.length)return t+1;const a=null===(r=e.data[0].meta)||void 0===r||null===(n=r.stats)||void 0===n?void 0:n.find((e=>"Summary: exec time"===e.displayName));if(a){const e=Math.round(a.value);return M(`${a.value}`),e<=1?Math.floor(1.5*t):e<6?Math.ceil(1.1*t):1===t?t:e<20?Math.ceil(.9*t):Math.floor(t/2)}return t}(e,g),p.length),h!==g&&M(`New group size ${h}`),i=function(e,t){if(!e)return L(C({},n=t),{data:n.data.map(F)});var n,a,i;t.data.forEach((t=>{const n=e.data.find((e=>function(e,t){var n,a,i,s,o,l;if(e.refId!==t.refId)return!1;if(null!=e.name&&null!=t.name&&e.name!==t.name)return!1;const c=null===(n=e.meta)||void 0===n?void 0:n.type;if(c!==(null===(a=t.meta)||void 0===a?void 0:a.type))return!1;if(c===r.DataFrameType.TimeSeriesMulti)return function(e,t){const n=e.fields.find((e=>e.type===r.FieldType.number)),a=t.fields.find((e=>e.type===r.FieldType.number));return void 0!==n&&void 0!==a&&(null==e.name&&(e.name=JSON.stringify(n.labels)),null==t.name&&(t.name=JSON.stringify(a.labels)),e.name===t.name)}(e,t);const d=null===(s=e.meta)||void 0===s||null===(i=s.custom)||void 0===i?void 0:i.frameType,u=null===(l=t.meta)||void 0===l||null===(o=l.custom)||void 0===o?void 0:o.frameType;return"LabeledTimeValues"===d&&"LabeledTimeValues"===u||d===u}(e,t)));n?function(e,t){var n,a;const i=e.fields.find((e=>e.type===r.FieldType.time)),s=e.fields.find((e=>e.type===r.FieldType.string&&"id"===e.name)),o=t.fields.find((e=>e.type===r.FieldType.time)),l=t.fields.find((e=>e.type===r.FieldType.string&&"id"===e.name));if(!i||!o)return void E.v.error(new Error("Time fields not found in the data frames"));var c;const d=null!==(c=null==o?void 0:o.values.slice(0))&&void 0!==c?c:[],u=Math.max(e.fields.length,t.fields.length);for(let n=0;n<d.length;n++){const a=k(i,o,n),c=j(i,s,a,o,l,n);for(let i=0;i<u;i++){if(!e.fields[i])continue;const s=P(e.fields[i],t.fields,i);if(s)if(c){if(e.fields[i].type===r.FieldType.time)continue;var p;e.fields[i].type===r.FieldType.number?e.fields[i].values[a]=(null!==(p=e.fields[i].values[a])&&void 0!==p?p:0)+s.values[n]:e.fields[i].type===r.FieldType.other?"object"==typeof s.values[n]?e.fields[i].values[a]=C({},e.fields[i].values[a],s.values[n]):null!=s.values[n]&&(e.fields[i].values[a]=s.values[n]):e.fields[i].values[a]=s.values[n]}else if(void 0!==s.values[n]){var g,h;e.fields[i].values.splice(a,0,s.values[n]),s.nanos&&(e.fields[i].nanos=null!==(h=e.fields[i].nanos)&&void 0!==h?h:new Array(e.fields[i].values.length-1).fill(0),null===(g=e.fields[i].nanos)||void 0===g||g.splice(a,0,s.nanos[n]))}}}var v,m;e.length=e.fields[0].values.length,e.meta=L(C({},e.meta),{stats:T(null!==(v=null===(n=e.meta)||void 0===n?void 0:n.stats)&&void 0!==v?v:[],null!==(m=null===(a=t.meta)||void 0===a?void 0:a.stats)&&void 0!==m?m:[])})}(n,t):e.data.push(F(t))}));const s=[...null!==(a=e.errors)&&void 0!==a?a:[],...null!==(i=t.errors)&&void 0!==i?i:[]];var o;s.length>0&&(e.errors=s);const l=null!==(o=e.error)&&void 0!==o?o:t.error;var c,d;null!=l&&(e.error=l);const u=[...null!==(c=e.traceIds)&&void 0!==c?c:[],...null!==(d=t.traceIds)&&void 0!==d?d:[]];return u.length>0&&(e.traceIds=u),e}(i,e))},complete:()=>{v||(i.data.length&&o.next(i),f())},error:e=>{E.v.error(e,{msg:"failed to shard"}),o.next(i),b()||f()}})},u=n=>{s=e.query(t).subscribe({next:e=>{i=e},complete:()=>{n.next(i)},error:e=>{E.v.error(e,{msg:"runNonSplitRequest subscription error"}),n.error(i)}})},p=new o.Observable((r=>{const i=(e=>{const t=(0,v.QH)(e,[h.MD]);return t.length>0?e.substring(t[0].from,t[0].to).replace(`, __stream_shard__=~"${S}"}`,"}"):""})(n[0].expr);return(0,v.T0)(i)?(e.languageProvider.fetchLabelValues("__stream_shard__",{timeRange:t.range,streamSelector:i||void 0}).then((e=>{const t=e.map((e=>parseInt(e,10)));t&&t.length?(t.sort(((e,t)=>t-e)),M(`Querying ${t.join(", ")} shards`),d(r,0,t,function(e){return Math.floor(Math.sqrt(e.length))}(t))):(E.v.warn("Shard splitting not supported. Issuing a regular query."),u(r))})).catch((e=>{E.v.error(e,{msg:"failed to fetch label values for __stream_shard__"}),u(r)})),()=>{a=!0,c&&clearTimeout(c),null!=s&&(s.unsubscribe(),s=null)}):(M(`Skipping invalid selector: ${i}`),void r.complete())}));return p}(e,t,n)}const I=Boolean(localStorage.getItem(`${p.id}.sharding_debug_enabled`));function M(e){I&&console.log(e)}var B=function(e){return e.Backward="backward",e.Forward="forward",e.Scan="scan",e}({}),R=n(8831),V=n(7918),W=n(1766),z=n(9254);function H(e,t,n,r,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function U(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){H(i,r,a,s,o,"next",e)}function o(e){H(i,r,a,s,o,"throw",e)}s(void 0)}))}}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){G(e,t,n[t])}))}return e}function Q(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const J="wrapped-loki-ds-uid",K="name",Y="cardinality",X="parser",Z="type";class ee extends i.UU{query(e){return new o.Observable((t=>{var n;if(!(null===(n=e.scopedVars)||void 0===n?void 0:n.__sceneObject))throw new Error("Scene object not found in request");var r=this;(0,a.getDataSourceSrv)().get((0,l.U4)(e.scopedVars.__sceneObject.valueOf())).then(function(){var n=U((function*(n){var i;if(!(n instanceof a.DataSourceWithBackend))throw new Error("Invalid datasource!");e.targets=null===(i=e.targets)||void 0===i?void 0:i.map((e=>(e.datasource=n,e)));const s=new Set;if(e.targets.forEach((e=>{var t;s.add(null!==(t=e.resource)&&void 0!==t?t:"")})),1!==s.size)throw new Error("A request cannot contain queries to multiple endpoints");switch(e.targets[0].resource){case"volume":yield r.getVolume(e,n,t);break;case"patterns":yield r.getPatterns(e,n,t);break;case"detected_labels":yield r.getDetectedLabels(e,n,t);break;case"detected_fields":yield r.getDetectedFields(e,n,t);break;case"labels":yield r.getLabels(e,n,t);break;default:r.getData(e,n,t)}}));return function(e){return n.apply(this,arguments)}}())}))}getData(e,t,n){const r=a.config.featureToggles.exploreLogsShardSplitting,i=Q(q({},e),{targets:this.applyQueryDirection(t.interpolateVariablesInQueries(e.targets,e.scopedVars).map((e=>Q(q({},e),{resource:void 0,expr:(0,V.VT)(e.expr)}))))});return(!1!==y(i)&&r?A(t,i):t.query(i)).subscribe(n),n}getPatterns(e,t,n){var a=this;return U((function*(){const i=e.targets.filter((e=>"patterns"===e.resource));if(1!==i.length)throw new Error("Patterns query can only have a single target!");const{interpolatedTarget:s,expression:o}=a.interpolate(t,i,e);n.next({data:[],state:r.LoadingState.Loading});try{var l;const a=t.getResource("patterns",{query:o,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString(),step:e.interval},{requestId:null!==(l=e.requestId)&&void 0!==l?l:"patterns",headers:{"X-Query-Tags":`Source=${R.s_}`}}),i=yield a,d=null==i?void 0:i.data;let u=-1/0,p=0;var c;const g=null!==(c=null==d?void 0:d.map((e=>{const t=[],n=[];let a=0;return e.samples.forEach((([e,r])=>{t.push(1e3*e),n.push(r),r>u&&(u=r),r<p&&(p=r),r>u&&(u=r),r<p&&(p=r),a+=r})),(0,r.createDataFrame)({refId:s.refId,name:e.pattern,fields:[{name:"time",type:r.FieldType.time,values:t,config:{}},{name:e.pattern,type:r.FieldType.number,values:n,config:{}}],meta:{preferredVisualisationType:"graph",custom:{sum:a}}})})))&&void 0!==c?c:[];g.sort(((e,t)=>{var n,r,a,i;return(null===(r=t.meta)||void 0===r||null===(n=r.custom)||void 0===n?void 0:n.sum)-(null===(i=e.meta)||void 0===i||null===(a=i.custom)||void 0===a?void 0:a.sum)})),n.next({data:g,state:r.LoadingState.Done})}catch(e){n.next({data:[],state:r.LoadingState.Error})}return n}))()}interpolate(e,t,n){const r=e.interpolateVariablesInQueries(t,n.scopedVars);if(!r.length)throw new Error("Datasource failed to interpolate query!");const a=r[0];return{interpolatedTarget:a,expression:(0,V.VT)(a.expr)}}applyQueryDirection(e){const t=(0,z.PY)()||(0,z.zQ)();return e.map((e=>(e.refId!==W.DS||(e.direction=t===s.uH.Descending?B.Backward:B.Forward),e)))}getDetectedLabels(e,t,n){var a=this;return U((function*(){const i=e.targets.filter((e=>"detected_labels"===e.resource));if(1!==i.length)throw new Error("Detected labels query can only have a single target!");let{interpolatedTarget:s,expression:o}=a.interpolate(t,i,e);"{}"===o&&(o=""),n.next({data:[],state:r.LoadingState.Loading});try{var l,u,p;const a=yield t.getResource("detected_labels",{query:o,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString()},{requestId:null!==(p=e.requestId)&&void 0!==p?p:"detected_labels",headers:{"X-Query-Tags":`Source=${R.s_}`}}),{labelName:i}=(0,c.W6)(),g=null===(u=a.detectedLabels)||void 0===u||null===(l=u.filter((e=>i!==e.label&&!d.rm.includes(e.label))))||void 0===l?void 0:l.sort(((e,t)=>(0,d.p_)(e,t))),h=null==g?void 0:g.map((e=>({name:e.label,values:[e.cardinality]}))),v=(0,r.createDataFrame)({refId:s.refId,fields:null!=h?h:[]});n.next({data:[v],state:r.LoadingState.Done})}catch(e){n.next({data:[],state:r.LoadingState.Error})}return n}))()}getDetectedFields(e,t,n){var a=this;return U((function*(){const i=e.targets.filter((e=>"detected_fields"===e.resource));if(1!==i.length)throw new Error("Detected fields query can only have a single target!");n.next({data:[],state:r.LoadingState.Loading});const{interpolatedTarget:s,expression:o}=a.interpolate(t,i,e);try{var l,c;const a=yield t.getResource("detected_fields",{query:o,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString()},{requestId:null!==(c=e.requestId)&&void 0!==c?c:"detected_fields",headers:{"X-Query-Tags":`Source=${R.s_}`}}),i={name:K,type:r.FieldType.string,values:[],config:{}},u={name:Y,type:r.FieldType.number,values:[],config:{}},p={name:X,type:r.FieldType.string,values:[],config:{}},g={name:Z,type:r.FieldType.string,values:[],config:{}};null===(l=a.fields)||void 0===l||l.forEach((e=>{var t;d.$R.includes(e.label)||(i.values.push(e.label),u.values.push(e.cardinality),p.values.push((null===(t=e.parsers)||void 0===t?void 0:t.length)?e.parsers.join(", "):"structuredMetadata"),g.values.push(e.type))}));const h=(0,r.createDataFrame)({refId:s.refId,fields:[i,u,p,g]});n.next({data:[h],state:r.LoadingState.Done})}catch(e){E.v.error(e,{msg:"Detected fields error"}),n.next({data:[],state:r.LoadingState.Error})}return n}))()}getVolume(e,t,n){return U((function*(){if(1!==e.targets.length)throw new Error("Volume query can only have a single target!");const a=e.targets[0],i=a.primaryLabel;if(!i)throw new Error("Primary label is required for volume queries!");const s=t.interpolateVariablesInQueries([a],e.scopedVars),o=(0,V.VT)(s[0].expr.replace(".*.*",".+"));n.next({data:[],state:r.LoadingState.Loading});try{var l,c,d;const a=yield t.getResource("index/volume",{query:o,start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString(),limit:5e3},{requestId:null!==(d=e.requestId)&&void 0!==d?d:"volume",headers:{"X-Query-Tags":`Source=${R.s_}`}});null==a||a.data.result.sort(((e,t)=>{const n=e.value[1],r=t.value[1];return Number(r)-Number(n)}));const s=(0,r.createDataFrame)({fields:[{name:u.OX,values:null==a||null===(l=a.data.result)||void 0===l?void 0:l.map((e=>e.metric[i]))},{name:"volume",values:null==a||null===(c=a.data.result)||void 0===c?void 0:c.map((e=>Number(e.value[1])))}]});n.next({data:[s]})}catch(e){E.v.error(e),n.next({data:[],state:r.LoadingState.Error})}return n.complete(),n}))()}getLabels(e,t,n){return U((function*(){if(1!==e.targets.length)throw new Error("Volume query can only have a single target!");try{var a;const i=yield t.getResource("labels",{start:e.range.from.utc().toISOString(),end:e.range.to.utc().toISOString()},{requestId:null!==(a=e.requestId)&&void 0!==a?a:"labels",headers:{"X-Query-Tags":`Source=${R.s_}`}}),s=(0,r.createDataFrame)({fields:[{name:"labels",values:null==i?void 0:i.data}]});n.next({data:[s],state:r.LoadingState.Done})}catch(e){n.next({data:[],state:r.LoadingState.Error})}return n.complete(),n}))()}testDatasource(){return Promise.resolve({status:"success",message:"Data source is working",title:"Success"})}constructor(e,t){super(e,t)}}const te=function(){i.Go.registerRuntimeDataSource({dataSource:new ee("wrapped-loki-ds",J)})}},9055:(e,t,n)=>{n.d(t,{_J:()=>d,wy:()=>u});var r=n(7141),a=n(4235),i=n(866),s=n(6939),o=n(4750),l=n(227);function c(e){const t=r.jh.getAncestor(e,a.PR);r.jh.findAllObjects(t,(e=>e instanceof i.p)).forEach((e=>e.forceRender())),r.jh.findDescendents(t,s.yj).forEach((e=>e.forceRender()))}function d(e,t,n){const r=(0,o.S9)(n).getValue();(0,l.OB)(r,e,t),c(n)}function u(e,t,n){const r=(0,o.S9)(n).getValue();(0,l.cC)(r,e,t),c(n)}},7097:(e,t,n)=>{n.d(t,{JI:()=>E,Jl:()=>C,OE:()=>w,Qg:()=>b,Ri:()=>y,ZD:()=>L,Zp:()=>S,k$:()=>O,ph:()=>x});var r=n(7781),a=n(2007),i=n(7141),s=n(558),o=n(3143),l=n(5183),c=n(1269),d=n(1766),u=n(4750),p=n(7232),g=n(2871),h=n(4861);const v=e=>{if(e&&Object.values(r.ReducerID).includes(e))return e};function m(e){switch(e){case"json":return"json";case"logfmt":return"logfmt";case"":case"structuredMetadata":return"structuredMetadata";default:return"mixed"}}function f(e){switch(e){case"int":case"float":case"duration":case"boolean":case"bytes":return e;default:return"string"}}function b(e){var t;const n=new Set(null!==(t=null==e?void 0:e.map((e=>e.toString())))&&void 0!==t?t:[]);n.delete("structuredMetadata");const r=Array.from(n);return 1===r.length?m(r[0]):0===n.size?"structuredMetadata":"mixed"}function y(e,t){var n;const r=(0,d.rD)(t),a=null==r?void 0:r.fields[2],i=null==r?void 0:r.fields[0],s=null==i?void 0:i.values.indexOf(e);var o;const l=void 0!==s&&-1!==s?m(null!==(o=null==a||null===(n=a.values)||void 0===n?void 0:n[s])&&void 0!==o?o:""):void 0;return void 0===l?(g.v.warn("missing parser, using mixed format for",{fieldName:e}),"mixed"):l}function S(e,t,n,r,o){return(d,u)=>{const p=v(r.state.sortBy),g=i.d0.timeseries().setOption("legend",{showLegend:!1}).setCustomFieldConfig("fillOpacity",9).setTitle(e(d)).setData(new i.Es({transformations:[()=>function(e){return t=>t.pipe((0,c.map)((()=>[e])))}(d)]})).setOverrides(l.jC).setMenu(new h.GD({frame:d,fieldName:e(d),labelName:o})).setHeaderActions([new s.oR({frame:d,variableName:n})]);return t===a.DrawStyle.Bars&&g.setCustomFieldConfig("stacking",{mode:a.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setOverrides(l.jC).setCustomFieldConfig("drawStyle",a.DrawStyle.Bars),p&&(g.setOption("legend",{showLegend:!0,calcs:[p]}),g.setDisplayName(" ")),new i.xK({body:g.build()})}}function w(e,t,n){const r=e?function(e,t,n=0){var r;const a=null===(r=t.fields.find((e=>"labelTypes"===e.name)))||void 0===r?void 0:r.values[n];if(!a)return null;switch(a[e]){case"I":return p.H.Indexed;case"S":return p.H.StructuredMetadata;case"P":return p.H.Parsed;default:return null}}(t,e):p.H.Parsed;if(r)return function(e,t){switch(e){case p.H.Indexed:return o.MB;case p.H.Parsed:return o.mB;case p.H.StructuredMetadata:return t===o.e4?o._Y:o._P;default:{const n=new Error(`Invalid label type for ${t}`);throw g.v.error(n,{type:e,msg:`Invalid label type for ${t}`}),n}}}(r,t);const a=y(t,n);return"structuredMetadata"===a?o._P:(g.v.warn("unable to determine label variable, falling back to parsed field",{key:t,parserForThisField:null!=a?a:""}),o.mB)}function O(e){return b(e.state.filters.map((e=>(0,u.bu)(e).parser)))}function E(e){return"duration"===e||"bytes"===e||"float"===e}function x(e,t){var n;const r=null==t?void 0:t.fields[0],a=null==t?void 0:t.fields[3],i=null==r?void 0:r.values.indexOf(e);return void 0!==i&&-1!==i?f(null==a||null===(n=a.values)||void 0===n?void 0:n[i]):void 0}function C(e,t,n){var r,a;const i=null==n?void 0:n.fields[2],s=null==n?void 0:n.fields[0],o=null==n?void 0:n.fields[3],l=null==s?void 0:s.values.indexOf(e),c=void 0!==l&&-1!==l?m(null==i||null===(r=i.values)||void 0===r?void 0:r[l]):"mixed",d=void 0!==l&&-1!==l?f(null==o||null===(a=o.values)||void 0===a?void 0:a[l]):void 0,p=t.state.filters.map((e=>{var t;const n=null==s?void 0:s.values.indexOf(e.key),r=(0,u.bu)(e);if(r.parser)return r.parser;var a;const o=void 0!==n&&-1!==n?m(null!==(a=null==i||null===(t=i.values)||void 0===t?void 0:t[n])&&void 0!==a?a:"mixed"):void 0;return null!=o?o:"mixed"}));let g="",h="";return"structuredMetadata"===c?h=`| ${e}!=""`:g=`| ${e}!=""`,function(e,t){return t.fieldType&&["bytes","duration"].includes(t.fieldType)?`avg_over_time(${(0,u.DX)(t)} | unwrap `+t.fieldType+`(${e}) | __error__="" [$__auto]) by ()`:t.fieldType&&"float"===t.fieldType?`avg_over_time(${(0,u.DX)(t)} | unwrap `+e+' | __error__="" [$__auto]) by ()':`sum by (${e}) (count_over_time(${(0,u.DX)(t)} [$__auto]))`}(e,{structuredMetadataToAdd:h,fieldExpressionToAdd:g,parser:b([...p,c]),fieldType:d})}function L(e){return"string"==typeof e?e.replace(/'/g,"\\\\'"):e}},6001:(e,t,n)=>{n.d(t,{$R:()=>s,dD:()=>i,p_:()=>a,rd:()=>l,rm:()=>o});var r=n(3143);function a(e,t){return 1===e.cardinality?1:1===t.cardinality?-1:e.cardinality-t.cardinality}function i(e){const t=[...e];e.includes(r.e4)||t.unshift(r.e4);const n=t.map((e=>({label:e,value:String(e)})));return[{label:"All",value:r.To},...n]}const s=["level_extracted",r.e4,"level"],o=["__aggregated_metric__","__stream_shard__"];function l(e){const t=[...e].map((e=>({label:e,value:String(e)})));return[{label:"All",value:r.To},...t]}},4119:(e,t,n)=>{n.d(t,{d:()=>o,o:()=>l});var r=n(3143),a=n(7097),i=n(7918),s=n(4750);const o="repeat(auto-fit, minmax(400px, 1fr))";function l(e,t,n){let o="",l="";const c=(0,s.ir)(e),d=(0,a.k$)(c);return n&&n!==r.e4?o=` ,${n} != ""`:n&&n===r.e4&&(l=` | ${n} != ""`),(0,i.l)(`sum(count_over_time(${(0,s.DX)({labelExpressionToAdd:o,structuredMetadataToAdd:l,parser:d})} [$__auto])) by (${t})`,{legendFormat:`{{${t}}}`,refId:"LABEL_BREAKDOWN_VALUES"})}},1383:(e,t,n)=>{n.d(t,{Ex:()=>u,H7:()=>d,PE:()=>g,de:()=>c,pC:()=>l});var r=n(2007),a=n(3143),i=n(558),s=n(4750),o=n(4793);function l(e,t,n,a){if(n===r.SeriesVisibilityChangeMode.ToggleSelection){const n=null!=t?t:[];return 1===n.length&&n.includes(e)?[]:[e]}let i=(null==t?void 0:t.length)?t:a;return i.includes(e)?i.filter((t=>t!==e)):[...i,e]}function c(e){return e.map((e=>{var t;return null!==(t=d(e))&&void 0!==t?t:"logs"}))}function d(e){var t;const n=null===(t=e.fields[1])||void 0===t?void 0:t.labels;if(!n)return null;const r=Object.keys(n);return 0===r.length?null:n[r[0]]}function u(e,t){const n=(0,s.iw)(t),r=n.state.filters.filter((e=>e.operator===o.w.Equal)).map((e=>p(e.value))),a=n.state.filters.filter((e=>e.operator===o.w.NotEqual)).map((e=>p(e.value)));return e.filter((e=>!a.includes(e)&&(0===r.length||r.includes(e))))}function p(e){return'""'===e?"logs":e}function g(e,t){const n=(0,s.iw)(t),r=0===n.state.filters.length,l=n.state.filters.find((t=>t.value===e&&t.operator===o.w.Equal));let c;return"logs"===e&&(e='""'),r||!l?((0,i.PT)(a.e4,e,"include",t),c="add"):((0,i.Qt)(a.e4,e,"toggle",t),c="remove"),c}},2871:(e,t,n)=>{n.d(t,{v:()=>c});var r=n(8531),a=n(2533),i=n(4011);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){s(e,t,n[t])}))}return e}const l={app:a.id,version:"1.0.5"},c={info:(e,t)=>{const n=o({},l,t);console.log(e,n),d(e,n)},warn:(e,t)=>{const n=o({},l,t);console.warn(e,n),u(e,n)},error:(e,t)=>{const n=o({},l,t);console.error(e,n),p(e,n)}},d=(e,t)=>{try{(0,r.logInfo)(e,t)}catch(e){console.warn("Failed to log faro event!")}},u=(e,t)=>{try{(0,r.logWarning)(e,t)}catch(n){console.warn("Failed to log faro warning!",{msg:e,context:t})}},p=(e,t)=>{let n=t;try{!function(e,t){if("object"==typeof e&&null!==e&&((0,i.u4)(e)&&Object.keys(e).forEach((n=>{const r=e[n];"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(t[n]=r.toString())})),g(e)))if("object"==typeof e.data&&null!==e.data)try{t.data=JSON.stringify(e.data)}catch(e){}else"string"!=typeof e.data&&"boolean"!=typeof e.data&&"number"!=typeof e.data||(t.data=e.data.toString())}(e,n),e instanceof Error?(0,r.logError)(e,n):"string"==typeof e?(0,r.logError)(new Error(e),n):e&&"object"==typeof e?n.msg?(0,r.logError)(new Error(n.msg),n):(0,r.logError)(new Error("error object"),n):(0,r.logError)(new Error("unknown error"),n)}catch(t){console.error("Failed to log faro error!",{err:e,context:n})}},g=e=>"data"in e},9186:(e,t,n)=>{n.d(t,{Il:()=>g,Os:()=>u,fF:()=>p,hy:()=>f,po:()=>h,z5:()=>v});var r=n(7781);function a(e,t,n){const r=e.getFieldByName(t);if(void 0!==r)return r.type===n?r:void 0}const i="timestamp",s="body",o="severity",l="id",c="labels";function d(e){const t={};return Object.entries(e).forEach((([e,n])=>{t[e]="string"==typeof n?n:JSON.stringify(n)})),t}function u(e){var t;return(null===(t=e.meta)||void 0===t?void 0:t.type)===r.DataFrameType.LogLines?function(e){const t=new r.FieldCache(e),n=a(t,i,r.FieldType.time),u=a(t,s,r.FieldType.string);if(void 0===n||void 0===u)return null;var p;const g=null!==(p=a(t,o,r.FieldType.string))&&void 0!==p?p:null;var h;const v=null!==(h=a(t,l,r.FieldType.string))&&void 0!==h?h:null;var m;const f=null!==(m=a(t,c,r.FieldType.other))&&void 0!==m?m:null,b=null===f?null:f.values,y=t.fields.filter(((e,t)=>t!==n.index&&t!==u.index&&t!==(null==g?void 0:g.index)&&t!==(null==v?void 0:v.index)&&t!==(null==f?void 0:f.index)));return{raw:e,timeField:n,bodyField:u,severityField:g,idField:v,getLogFrameLabels:()=>b,timeNanosecondField:null,getLogFrameLabelsAsLabels:()=>null!==b?b.map(d):null,getLabelFieldName:()=>null!==f?f.name:null,extraFields:y}}(e):function(e){const t=new r.FieldCache(e),n=t.getFirstFieldOfType(r.FieldType.time),a=t.getFirstFieldOfType(r.FieldType.string);if(void 0===n||void 0===a)return null;var i;const s=null!==(i=t.getFieldByName("tsNs"))&&void 0!==i?i:null;var o;const l=null!==(o=t.getFieldByName("level"))&&void 0!==o?o:null;var c;const u=null!==(c=t.getFieldByName("id"))&&void 0!==c?c:null,[p,g]=function(e,t,n){const a=e.getFieldByName("labels");if(void 0!==a&&a.type===r.FieldType.other){const e=a.values.map(d);return[a,()=>e]}return[null,()=>function(e,t){const n=e.labels;if(void 0!==n){const e=new Array(t);return e.fill(n),e}return null}(t,n.length)]}(t,a,e),h=t.fields.filter(((e,t)=>t!==n.index&&t!==a.index&&t!==(null==s?void 0:s.index)&&t!==(null==l?void 0:l.index)&&t!==(null==u?void 0:u.index)&&t!==(null==p?void 0:p.index)));return{timeField:n,bodyField:a,timeNanosecondField:s,severityField:l,idField:u,getLogFrameLabels:g,getLogFrameLabelsAsLabels:g,getLabelFieldName:()=>{var e;return null!==(e=null==p?void 0:p.name)&&void 0!==e?e:null},extraFields:h,raw:e}}(e)}function p(e){var t;return null!==(t=null==e?void 0:e.timeField.name)&&void 0!==t?t:i}function g(e){var t;return null!==(t=null==e?void 0:e.bodyField.name)&&void 0!==t?t:s}function h(e){var t,n;return null!==(n=null==e||null===(t=e.idField)||void 0===t?void 0:t.name)&&void 0!==n?n:l}function v(e){var t;let n=0,a=0;const i=null===(t=e[0])||void 0===t?void 0:t.fields.find((e=>e.type===r.FieldType.time));if(i){const e=i.values.sort(),t=e[0]<e[e.length-1];n=t?e[0]:e[e.length-1],a=t?e[e.length-1]:e[0]}return{start:n,end:a}}const m="Visible range";function f(e,t){const n=(0,r.arrayToDataFrame)([{time:e,timeEnd:t,isRegion:!0,text:"Range from oldest to newest logs in display",color:"rgba(58, 113, 255, 0.3)"}]);return n.name=m,n.meta={dataTopic:r.DataTopic.Annotations},n}},6949:(e,t,n)=>{let r;function a(){r||(r=new i)}n.d(t,{JO:()=>s,rX:()=>a});class i{getServiceSceneState(){return this.serviceSceneState}setPatternsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.patternsCount=e}setLabelsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.labelsCount=e}setFieldsCount(e){this.serviceSceneState||(this.serviceSceneState={}),this.serviceSceneState.fieldsCount=e}setServiceSceneState(e){this.serviceSceneState={patternsCount:e.patternsCount,labelsCount:e.labelsCount,fieldsCount:e.fieldsCount,loading:e.loading,logsCount:e.logsCount,totalLogsCount:e.totalLogsCount}}constructor(){var e,t;t=void 0,(e="serviceSceneState")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t}}function s(){return r}},4011:(e,t,n)=>{n.d(t,{FH:()=>u,OK:()=>h,QX:()=>v,Zt:()=>g,aJ:()=>l,fS:()=>p,lb:()=>c,u4:()=>o,v_:()=>d});var r=n(7781);const a=e=>"object"==typeof e&&null!==e;function i(e,t){return t in e}const s=e=>"string"==typeof e&&e||"",o=e=>"object"==typeof e;function l(e){let t=[];if(Array.isArray(e))for(let n=0;n<e.length;n++)t.push(s(e[n]));return t}function c(e){const t=a(e)&&i(e,"row")&&i(e,"id")&&e;if(t){const e="number"==typeof t.row&&t.row,n="string"==typeof t.id&&t.id;if(!1!==n&&!1!==e)return{row:e,id:n}}return!1}function d(e){return"string"==typeof e&&("logs"===e||"table"===e)&&e}function u(e){return"string"==typeof e&&e===r.LogsSortOrder.Ascending.toString()?r.LogsSortOrder.Ascending:"string"==typeof e&&e===r.LogsSortOrder.Descending.toString()&&r.LogsSortOrder.Descending}function p(e){const t=a(e)&&i(e,"value")&&i(e,"parser")&&e;if(t){const e="string"==typeof t.parser&&("logfmt"===t.parser||"json"===t.parser||"mixed"===t.parser||"structuredMetadata"===t.parser)&&t.parser,n="string"==typeof t.value&&t.value;if(!1!==e&&!1!==n)return{parser:e,value:n}}return!1}function g(e){const t=a(e)&&o(e)&&e;if(t){const e=Object.keys(t),n={};for(let r=0;r<e.length;r++){const a=e[r],i=t[e[r]];"number"==typeof i&&(n[a]=i)}return n}return!1}function h(e){const t=a(e)&&i(e,"to")&&i(e,"from")&&e;if(t){const e=s(t.to),n=s(t.from);if(e&&n)return{to:e,from:n}}}class v extends Error{}},8835:(e,t,n)=>{n.d(t,{Ns:()=>S,Vt:()=>b,ad:()=>y,fg:()=>m,jY:()=>f});var r=n(4235),a=n(3143),i=n(6949),s=n(8531),o=n(892),l=n(7141),c=n(7781),d=n(7608),u=n(2871),p=n(8831);function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let h;function v(e,t){return c.urlUtil.renderUrl(e,function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){g(e,t,n[t])}))}return e}({},Object.entries(c.urlUtil.getUrlSearchParams()).reduce(((e,[t,n])=>(o.tm.includes(t)&&(e[t]=n),e)),{}),e)}(t))}function m(e,t,n){const s=l.jh.getAncestor(n,r.PR);if(s){var c,g;const r=null===(c=s.state.routeMatch)||void 0===c?void 0:c.params.labelName,l=null===(g=s.state.routeMatch)||void 0===g?void 0:g.params.labelValue;if(r&&l){let s=function(e,t,n,r="service"){return e===a.To&&t===o._J.label?(0,p._F)(`${o.G3.explore}/${r}/${(0,d.uu)(n)}/${o.G3.labels}`):e===a.To&&t===o._J.field?(0,p._F)(`${o.G3.explore}/${r}/${(0,d.uu)(n)}/${o.G3.fields}`):(0,p._F)(`${o.G3.explore}/${r}/${(0,d.uu)(n)}/${t}/${(0,d.uu)(e)}`)}(t,e,l,r);const c=v(s);return n&&(0,i.JO)().setServiceSceneState(n.state),void y(c)}u.v.warn("missing url params",{urlLabelName:null!=r?r:"",urlLabelValue:null!=l?l:""})}}function f(e,t){y(v(o.bw.logs(t,e)))}function b(e,t,n){var a,s;const c=l.jh.getAncestor(t,r.PR),u=null===(a=c.state.routeMatch)||void 0===a?void 0:a.params.labelValue,g=null===(s=c.state.routeMatch)||void 0===s?void 0:s.params.labelName;if(u){const r=v((0,p._F)(`${o.G3.explore}/${g}/${(0,d.uu)(u)}/${e}`),n);t&&(0,i.JO)().setServiceSceneState(t.state),y(r)}}function y(e){h=e,s.locationService.push(e)}function S(){const e=s.locationService.getLocation(),t=(0,o.qe)(o.bw.explore()),n=e.pathname+e.search,r=s.locationService.getSearch();t===n||n.includes(t)||(r.get("var-filters")?y(t):(h&&s.locationService.replace(h),s.locationService.push(t)))}},5183:(e,t,n)=>{n.d(t,{rS:()=>O,FH:()=>w,HF:()=>E,jC:()=>v,ZC:()=>m,Cw:()=>b});var r=n(7781),a=n(7141),i=n(1269),s=n(7322);class o extends a.dt{runQueries(){const e=a.jh.getTimeRange(this);this.runWithTimeRange(e)}constructor(e){super(e)}}var l=n(2007),c=n(1383),d=n(1766);function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}function g(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const h="logs";function v(e){e.matchFieldsWithName("info").overrideColor({mode:"fixed",fixedColor:"semi-dark-green"}),e.matchFieldsWithName("debug").overrideColor({mode:"fixed",fixedColor:"semi-dark-blue"}),e.matchFieldsWithName("error").overrideColor({mode:"fixed",fixedColor:"semi-dark-red"}),e.matchFieldsWithName("warn").overrideColor({mode:"fixed",fixedColor:"semi-dark-orange"}),e.matchFieldsWithName("logs").overrideColor({mode:"fixed",fixedColor:"darkgray"})}function m(e){return e.setCustomFieldConfig("stacking",{mode:l.StackingMode.Normal}).setCustomFieldConfig("fillOpacity",100).setCustomFieldConfig("lineWidth",0).setCustomFieldConfig("pointSize",0).setCustomFieldConfig("drawStyle",l.DrawStyle.Bars).setOverrides(v)}function f(e,t){t.match({id:r.FieldMatcherID.byNames,options:{mode:"exclude",names:e,prefix:"All except:",readOnly:!0}}).overrideCustomFieldConfig("hideFrom",{legend:!1,tooltip:!1,viz:!0});const n=t.build();n[n.length-1].__systemRef="hideSeriesFrom"}function b(e,t,n){const r=(0,c.Ex)((0,c.de)(t),n);if(null==r?void 0:r.length){const t=m(a.No.timeseries()).setOverrides(f.bind(null,r));t instanceof a.OS&&e.onFieldConfigChange(t.build(),!0)}}function y(){return e=>e.pipe((0,i.map)((e=>e.map(((t,n)=>g(p({},t),{fields:t.fields.map(((n,a)=>{if(n.type===r.FieldType.time)return n;const i=(0,r.getFieldDisplayName)(n,t,e);return g(p({},n),{config:g(p({},n.config),{displayName:i,color:{mode:r.FieldColorModeId.PaletteClassicByName}})})}))}))))))}function S(){return e=>e.pipe((0,i.map)((e=>e.map((e=>(e.fields.length<2||e.fields[1].config.displayNameFromDS||(e.fields[1].config.displayNameFromDS=h),e))).sort(((e,t)=>{if(e.fields.length<2||t.fields.length<2)return 0;const n=e.fields[1].config.displayNameFromDS,r=(null==n?void 0:n.includes("error"))?4:(null==n?void 0:n.includes("warn"))?3:(null==n?void 0:n.includes("info"))?2:1,a=t.fields[1].config.displayNameFromDS;return r-((null==a?void 0:a.includes("error"))?4:(null==a?void 0:a.includes("warn"))?3:(null==a?void 0:a.includes("info"))?2:1)})))))}function w(e){return new o({datasource:{uid:s.WRAPPED_LOKI_DS_UID},queries:e})}function O(e,t){const n=e.find((e=>{var t;return null===(t=e.legendFormat)||void 0===t?void 0:t.toLowerCase().includes("level")})),r=e.find((e=>e.refId===d.DS||e.refId===d.AA));return n?new a.Es({$data:E(p({datasource:{uid:s.WRAPPED_LOKI_DS_UID},queries:e},t)),transformations:[S]}):r?E(p({datasource:{uid:s.WRAPPED_LOKI_DS_UID},queries:e},t)):new a.Es({$data:E(p({datasource:{uid:s.WRAPPED_LOKI_DS_UID},queries:e},t)),transformations:[y]})}function E(e){return new a.dt(p({datasource:{uid:s.WRAPPED_LOKI_DS_UID},queries:[]},e))}},8831:(e,t,n)=>{n.d(t,{Gy:()=>a,_F:()=>i,s_:()=>r});const r=n(2533).id,a=`/a/${r}`;function i(e){return`${a}/${e}`}},7918:(e,t,n)=>{n.d(t,{$k:()=>v,BM:()=>p,E3:()=>y,M3:()=>E,VT:()=>k,VW:()=>f,W3:()=>x,ZX:()=>b,by:()=>j,l:()=>g,sT:()=>L,vC:()=>C});var r=n(4235),a=n(3143),i=n(3241),s=n(4750),o=n(8831),l=n(4793);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){c(e,t,n[t])}))}return e}function u(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const p=(e,t,n,r)=>u(d(u(d({},h),{resource:t,refId:t}),n),{datasource:{uid:a.gR},expr:e,primaryLabel:r}),g=(e,t)=>u(d({},h,t),{expr:e}),h={refId:"A",queryType:"range",editorMode:"code",supportingQueryType:o.s_},v=(e,t,n,r)=>p(e,t,d({},r),n);function m(e){const t=e.filter((e=>e.operator===l.w.Equal));return{negative:e.filter((e=>e.operator===l.w.NotEqual)),positiveGroups:(0,i.groupBy)(t,(e=>e.key))}}function f(e){let{positiveFilters:t,negative:n}=function(e){const{negative:t,positiveGroups:n}=m(e);let r=[];for(const e in n){const t=n[e].map((e=>e.value));r.push(1===t.length?S(n[e][0]):O(e,t))}return{positiveFilters:r,negative:t}}(e);const r=n.map((e=>S(e))).join(", ");return(0,i.trim)(`${t.join(", ")}, ${r}`," ,")}function b(e){const t=e.filter((e=>e.operator===l.w.Equal)),n=e.filter((e=>e.operator===l.w.NotEqual)),a=e.filter((e=>r.nB.includes(e.operator))),o=(0,i.groupBy)(t,(e=>e.key));let c="";for(const e in o)c+=" | "+o[e].map((e=>`${w(e)}`)).join(" or ");return`${c} ${n.map((e=>`| ${w(e)}`)).join(" ")} ${a.map((e=>`| ${function(e){const t=(0,s.bu)(e).value;return`${e.key}${e.operator}${t}`}(e)}`)).join(" ")}`.trim()}function y(e){const t=e.filter((e=>e.operator===l.w.Equal)),n=e.filter((e=>e.operator===l.w.NotEqual)),r=(0,i.groupBy)(t,(e=>e.key));let a="";for(const e in r)a+=" | "+r[e].map((e=>`${S(e)}`)).join(" or ");return`${a} ${n.map((e=>`| ${S(e)}`)).join(" ")}`.trim()}function S(e){return e.value===a.ZO?`${e.key}${e.operator}${e.value}`:`${e.key}${e.operator}\`${e.value}\``}function w(e){const t=(0,s.bu)(e).value;return t===a.ZO?`${e.key}${e.operator}${t}`:`${e.key}${e.operator}\`${t}\``}function O(e,t){return`${e}=~"${t.join("|")}"`}function E(e){const t=e.filter((e=>"exclude"===e.type)).map((e=>`!> \`${e.pattern}\``)).join(" ").trim(),n=e.filter((e=>"include"===e.type));let r="";return n.length>0&&(r=1===n.length?`|> \`${n[0].pattern}\``:`|>  ${n.map((e=>`\`${e.pattern}\``)).join(" or ")}`),`${t} ${r}`.trim()}function x(e){const{positiveGroups:t,negative:n}=m(e.state.filters),r=[];for(const e in t){const n=t[e].map((e=>e.value));1===n.length?r.push({key:e,value:t[e][0].value,operator:"="}):r.push({key:e,value:n.join("|"),operator:"=~"})}return n.forEach((e=>{r.push(e)})),r}function C(e){return".+"!==e&&".*"!==e.substring(0,2)?`.*${e}.*`:e}function L(e){return".*"===e.substring(0,2)&&".*"===e.slice(-2)?e.slice(2).slice(0,-2):e}function k(e){return e.replace(/\s*,\s*}/,"}")}const j=1e3},892:(e,t,n)=>{n.d(t,{FT:()=>y,G3:()=>u,HU:()=>v,KL:()=>m,NX:()=>x,W6:()=>S,XJ:()=>E,Zt:()=>f,_J:()=>p,bw:()=>g,er:()=>w,mC:()=>h,qe:()=>O,tm:()=>b});var r=n(7781),a=n(3143),i=n(8531),s=n(7608),o=n(4750),l=n(2871),c=n(8831);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(e){return e.explore="explore",e.logs="logs",e.labels="labels",e.patterns="patterns",e.fields="fields",e}({}),p=function(e){return e.field="field",e.label="label",e}({});const g={explore:()=>(0,c._F)("explore"),logs:(e,t="service")=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/logs`),fields:(e,t="service")=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/fields`),patterns:(e,t="service")=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/patterns`),labels:(e,t="service")=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/labels`)},h={label:(e,t="service",n)=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/label/${n}`),field:(e,t="service",n)=>(0,c._F)(`explore/${t}/${(0,s.uu)(e)}/field/${n}`)},v={explore:(0,c._F)("explore"),logs:(0,c._F)("explore/:labelName/:labelValue/logs"),fields:(0,c._F)("explore/:labelName/:labelValue/fields"),patterns:(0,c._F)("explore/:labelName/:labelValue/patterns"),labels:(0,c._F)("explore/:labelName/:labelValue/labels")},m={field:(0,c._F)("explore/:labelName/:labelValue/field/:breakdownLabel"),label:(0,c._F)("explore/:labelName/:labelValue/label/:breakdownLabel")},f=["from","to",`var-${a.EY}`,`var-${a.MB}`],b=["from","to","mode","urlColumns","visualizationType","selectedLine","displayedFields","panelState",a.uw,`var-${a.uw}`,`var-${a.EY}`,`var-${a.MB}`,`var-${a.mB}`,`var-${a._Y}`,`var-${a.LI}`,`var-${a.Jg}`,`var-${a.EY}`,`var-${a.WM}`,`var-${a._P}`];function y(){const e=i.locationService.getLocation();return e.pathname.slice(e.pathname.lastIndexOf("/")+1,e.pathname.length)}function S(){const e=i.locationService.getLocation(),t=e.pathname.slice(e.pathname.indexOf("/a/grafana-lokiexplore-app/explore")+34+1).split("/");let n=t[0];const r=t[1],s=t[3];return n===a.OX&&(n=a.ky),{labelName:n,labelValue:r,breakdownLabel:s}}function w(){const e=i.locationService.getLocation().pathname.split("/");return e[e.length-2]}function O(e,t){return r.urlUtil.renderUrl(e,function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){d(e,t,n[t])}))}return e}({},Object.entries(r.urlUtil.getUrlSearchParams()).reduce(((e,[t,n])=>(f.includes(t)&&(e[t]=n),e)),{}),e)}(t))}function E(e){return{labelName:e.params.labelName,labelValue:e.params.labelValue,breakdownLabel:e.params.breakdownLabel}}function x(e){const t=(0,o.cR)(e);let{labelName:n,labelValue:r}=S();if(n===a.ky&&(n=a.OX),!t.state.filters.find((e=>e.key===n))){const e=i.locationService.getLocation();l.v.info("invalid primary label name in url",{labelName:n,url:`${e.pathname}${e.search}`})}if(!t.state.filters.find((e=>(0,s.uu)(e.value)===r))){const e=i.locationService.getLocation();l.v.info("invalid primary label value in url",{labelValue:r,url:`${e.pathname}${e.search}`})}}},9829:(e,t,n)=>{n.d(t,{Ti:()=>c,U4:()=>d,UX:()=>v,hJ:()=>p,m0:()=>m,oh:()=>h,u9:()=>u}),n(7781);var r=n(8531),a=n(7141),i=n(3143),s=(n(892),n(4235)),o=n(2871);function l(e,t,n,r,a,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,a)}function c(e){return a.jh.getAncestor(e,s.PR)}function d(e){return a.jh.interpolate(e,i.gR)}function u(e){return a.jh.interpolate(e,i.SA).replace(/\s+/g," ")}function p(e){return g.apply(this,arguments)}function g(){var e;return e=function*(e){return yield(0,r.getDataSourceSrv)().get(i.gR,{__sceneObject:{value:e}})},g=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function s(e){l(i,r,a,s,o,"next",e)}function o(e){l(i,r,a,s,o,"throw",e)}s(void 0)}))},g.apply(this,arguments)}function h(e){return a.jh.findDescendents(e,a.dt)}function v(e,t,n){const r=a.jh.findObject(e,t);return r instanceof n?r:(null!==r&&o.v.warn(`invalid return type: ${n.toString()}`),null)}function m(e){var t;return null===(t=e.state.controls)||void 0===t?void 0:t.find((e=>e instanceof a.KE))}},4932:(e,t,n)=>{n.d(t,{E:()=>o,X:()=>s});var r=n(7928),a=n(3241);const i=new r.A({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1});function s(e,t,n){const[a,s,o]=i.search(e,t,0,1e5);let l=[],c=new Set;if(a&&o){const t=(e,t)=>{t&&c.add(e)};for(let n=0;n<o.length;n++){let a=o[n];r.A.highlight(e[s.idx[a]],s.ranges[a],t),l.push(e[s.idx[a]])}n([l,[...c]])}else t||n([])}const o=(0,a.debounce)(s,300)},5722:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_SORT_BY:()=>d,calculateDataFrameChangepoints:()=>p,calculateOutlierValue:()=>m,sortSeries:()=>u,sortSeriesByName:()=>g,wasmSupported:()=>f});var r=n(1854),a=n(6944),i=n(7781),s=n(1383),o=n(3241),l=n(2718),c=n(2871);const d="changepoint",u=(0,o.memoize)(((e,t,n)=>{if("alphabetical"===t)return g(e,n);"outliers"===t&&h(e);const r=n=>{var r;try{if("changepoint"===t)return p(n);if("outliers"===t)return m(e,n)}catch(e){c.v.error(e,{msg:"failed to sort"}),t=i.ReducerID.stdDev}const a=i.fieldReducers.get(t);var s,o;return null!==(o=(null!==(s=null===(r=a.reduce)||void 0===r?void 0:r.call(a,n.fields[1],!0,!0))&&void 0!==s?s:(0,i.doStandardCalcs)(n.fields[1],!0,!0))[t])&&void 0!==o?o:0},a=e.map((e=>({value:r(e),dataFrame:e})));return a.sort(((e,t)=>void 0!==e.value&&void 0!==t.value?t.value-e.value:0)),"asc"===n&&a.reverse(),a.map((({dataFrame:e})=>e))}),((e,t,n)=>{const r=e.length>0?e[0].fields[0].values[0]:0,a=e.length>0?e[e.length-1].fields[0].values[e[e.length-1].fields[0].values.length-1]:0,i=e.length>0?(0,s.H7)(e[0]):"",o=e.length>0?(0,s.H7)(e[e.length-1]):"",l=e.map((e=>e.length+"_"+e.fields.map((e=>e.name+"_"+e.values[0]+"_"+e.values[e.values.length-1]))));return`${i}_${o}_${r}_${a}_${e.length}_${l}_${t}_${n}`})),p=e=>{if(!f())throw new Error("WASM not supported, fall back to stdDev");const t=e.fields.filter((e=>e.type===i.FieldType.number)),n=t[0].values.length;let a=Math.floor(n/100)||1;a>1&&(a=Math.ceil(a/2));const s=t[0].values.filter(((e,t)=>t%a==0)),o=new Float64Array(s);return r.ChangepointDetector.defaultArgpcp().detectChangepoints(o).indices.length},g=(e,t)=>{const n=[...e];return n.sort(((e,t)=>{const n=(0,s.H7)(e),r=(0,s.H7)(t);return n&&r&&null!==(a=null==n?void 0:n.localeCompare(r))&&void 0!==a?a:0;var a})),"desc"===t&&n.reverse(),n},h=e=>{if(!f())return;const t=(0,i.outerJoinDataFrames)({frames:e});if(!t)return;const n=t.fields.filter((e=>e.type===i.FieldType.number)).flatMap((e=>new Float64Array(e.values)));try{const e=a.OutlierDetector.dbscan({sensitivity:.4}).preprocess(n);v=e.detect()}catch(e){c.v.error(e,{msg:"initOutlierDetector: OutlierDetector error"})}};let v;const m=(e,t)=>{if(!f())throw new Error("WASM not supported, fall back to stdDev");if(!v)throw new Error("Initialize outlier detector first");const n=e.indexOf(t);return v.seriesResults[n].isOutlier?v.seriesResults[n].outlierIntervals.length:0},f=()=>{const e="object"==typeof WebAssembly;return e||(0,l.EE)(l.NO.service_details,l.ir.service_details.wasm_not_supported),e}},227:(e,t,n)=>{n.d(t,{Gg:()=>v,IW:()=>V,N$:()=>C,OB:()=>p,QB:()=>y,RN:()=>T,Rf:()=>F,Xo:()=>I,YK:()=>P,YM:()=>j,ZF:()=>L,cC:()=>g,cO:()=>h,eT:()=>u,ex:()=>R,fq:()=>E,hp:()=>M,k5:()=>N,ke:()=>S,o5:()=>$,sj:()=>m,vs:()=>O});var r=n(2533),a=n(4750),i=n(2871),s=n(3143),o=n(4011);const l=`${r.id}.services.favorite`,c=`${r.id}.primarylabels.tabs.favorite`,d=`${r.id}.datasource`;function u(e,t){if(!e||"string"!=typeof e)return[];const n=f(e,t);let r=[];try{r=(0,o.aJ)(JSON.parse(localStorage.getItem(n)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}return Array.isArray(r)||(r=[]),r}function p(e,t,n){if(!e||"string"!=typeof e)return;const r=f(e,t);let a=[];try{a=(0,o.aJ)(JSON.parse(localStorage.getItem(r)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(a)||(a=[]);const s=a.filter((e=>e!==n));s.unshift(n),localStorage.setItem(r,JSON.stringify(s))}function g(e,t,n){if(!e||!t||!n||"string"!=typeof e)return;const r=f(e,t);let a=[];try{a=(0,o.aJ)(JSON.parse(localStorage.getItem(r)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(a)||(a=[]);const s=a.filter((e=>e!==n));localStorage.setItem(r,JSON.stringify(s))}function h(e,t){if(!e||!t)return;const n=b(e);let r=[];try{r=(0,o.aJ)(JSON.parse(localStorage.getItem(n)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing saved tabs from local storage"})}if(Array.isArray(r)||(r=[]),-1===r.indexOf(t)){const e=r.filter((e=>e!==t));e.unshift(t),localStorage.setItem(n,JSON.stringify(e))}}function v(e,t){if(!e||!t)return;const n=b(e);let r=[];try{r=(0,o.aJ)(JSON.parse(localStorage.getItem(n)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}Array.isArray(r)||(r=[]);const a=r.filter((e=>e!==t));localStorage.setItem(n,JSON.stringify(a))}function m(e){if(!e||"string"!=typeof e)return[];const t=b(e);let n=[];try{n=(0,o.aJ)(JSON.parse(localStorage.getItem(t)||"[]"))}catch(e){i.v.error(e,{msg:"Error parsing favorite services from local storage"})}return Array.isArray(n)||(n=[]),n}function f(e,t){return t=t===s.OX?"":`_${t}`,`${l}_${e}${t}`}function b(e){return`${c}_${e}`}function y(){var e;return null!==(e=localStorage.getItem(d))&&void 0!==e?e:void 0}function S(e){localStorage.setItem(d,e)}const w=`${r.id}.values.sort`;function O(e,t,n){var r;const a=(null!==(r=localStorage.getItem(`${w}.${e}.by`))&&void 0!==r?r:"").split(".");return a[0]&&a[1]?{sortBy:a[0],direction:a[1]}:{sortBy:t,direction:n}}function E(e,t,n){t&&n&&localStorage.setItem(`${w}.${e}.by`,`${t}.${n}`)}function x(e){return`${(0,a.nH)(e)}.${(0,a.p_)(e)}`}function C(e){const t=x(e),n=localStorage.getItem(`${r.id}.${t}.logs.fields`);return n?JSON.parse(n):[]}function L(e,t){const n=x(e);localStorage.setItem(`${r.id}.${n}.logs.fields`,JSON.stringify(t))}const k=`${r.id}.logs.option`;function j(e,t){return localStorage.getItem(`${k}.${e}`)||t}function P(e,t){let n=t.toString();"boolean"!=typeof t||t||(n=""),localStorage.setItem(`${k}.${e}`,n)}const _="grafana.explore.logs.logsVolume";function T(e,t){const n=`${_}.${e}`;void 0!==t?localStorage.setItem(n,t):localStorage.removeItem(n)}function F(e){return localStorage.getItem(`${_}.${e}`)}const D="grafana.explore.logs.visualisationType";function N(){var e;const t=null!==(e=localStorage.getItem(D))&&void 0!==e?e:"";switch(t){case"table":case"logs":return t;default:return"logs"}}function $(e){localStorage.setItem(D,e)}const A=`${r.id}.linefilter.option`;function I(e){let t=e.toString();e||(t=""),localStorage.setItem(`${A}.caseSensitive`,t)}function M(e){return"true"===localStorage.getItem(`${A}.caseSensitive`)||e}const B=`${r.id}.panel.option`;function R(e,t){const n=localStorage.getItem(`${B}.${e}`);var r;return null!==n&&null!==(r=t.find((e=>n===e)))&&void 0!==r?r:null}function V(e,t){localStorage.setItem(`${B}.${e}`,t)}},1220:(e,t,n)=>{n.d(t,{b:()=>r});const r={appConfig:{container:"data-testid ac-container",apiKey:"data-testid ac-api-key",apiUrl:"data-testid ac-api-url",submit:"data-testid ac-submit-form"},exploreServiceSearch:{search:"data-testid search-services"},header:{refreshPicker:"data-testid RefreshPicker run button"},variables:{datasource:{label:"data-testid Dashboard template variables submenu Label Data source"},combobox:{},serviceName:{label:"data-testid Dashboard template variables submenu Label Labels"}},breakdowns:{labels:{},fields:{},common:{sortByFunction:"data-testid SortBy function",sortByDirection:"data-testid SortBy direction",filterButtonGroup:"data-testid filter-button-group",filterButton:"data-testid filter-button",filterSelect:"data-testid filter-select",filterNumericPopover:{removeButton:"data-testid filter-numeric-remove",submitButton:"data-testid filter-numeric-submit",cancelButton:"data-testid filter-numeric-cancel",inputGreaterThan:"data-testid filter-numeric-gt",inputGreaterThanUnit:"data-testid filter-numeric-gtu",inputGreaterThanInclusive:"data-testid filter-numeric-gte",inputLessThan:"data-testid filter-numeric-lt",inputLessThanUnit:"data-testid filter-numeric-ltu",inputLessThanInclusive:"data-testid filter-numeric-lte"}}},index:{showLogsButton:"data-testid Show logs",addNewLabelTab:"data-testid Tab Add label",searchLabelValueInput:"data-testid search-services-input",aggregatedMetricsMenu:"data-testid aggregated-metrics-menu",aggregatedMetricsToggle:"data-testid aggregated-metrics-toggle",header:{showLogsButton:"data-testid Show logs header"}},exploreServiceDetails:{searchLogs:"data-testid search-logs",openExplore:"data-testid open-explore",tabPatterns:"data-testid tab-patterns",tabLogs:"data-testid tab-logs",tabFields:"data-testid tab-fields",tabLabels:"data-testid tab-labels",buttonRemovePattern:"data-testid button-remove-pattern",buttonFilterInclude:"data-testid button-filter-include",buttonFilterExclude:"data-testid button-filter-exclude"},patterns:{tableWrapper:"data-testid table-wrapper",buttonIncludedPattern:"data-testid button-included-pattern",buttonExcludedPattern:"data-testid button-excluded-pattern"},logsPanelHeader:{header:"data-testid Panel header Logs",radio:"data-testid radio-button"},table:{wrapper:"data-testid table-wrapper",inspectLine:"data-testid inspect",rawLogLine:"data-testid raw-log-line"}}},8315:(e,t,n)=>{n.d(t,{Dk:()=>s,EJ:()=>c,Ki:()=>d,Zr:()=>l,gW:()=>o});var r=n(8531),a=n(2871),i=n(7781);const s=e=>{if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}},o=(e,t,n)=>{const a=r.locationService.getLocation(),i=new URLSearchParams(a.search);i.set("from",n.from.toISOString()),i.set("to",n.to.toISOString()),i.set(e,JSON.stringify(t));const s=i.toString().replace(/\+/g,"%20");return window.location.origin+a.pathname+"?"+s};function l(e){return e.length?(null==e?void 0:e.charAt(0).toUpperCase())+e.slice(1):(a.v.warn("invalid string argument"),e)}function c(e,t,n){return e.substring(0,t)+(n&&e.length>t?"…":"")}function d(e){const t=(0,i.dateTime)(e.timeEpochMs-1),n=(0,i.dateTime)(e.timeEpochMs+1);return{from:t,to:n,raw:{from:t,to:n}}}},4750:(e,t,n)=>{n.d(t,{BL:()=>x,DX:()=>l,El:()=>E,Hj:()=>b,Ku:()=>c,P4:()=>m,Rr:()=>v,S9:()=>y,aW:()=>u,bY:()=>S,bu:()=>L,cR:()=>d,eY:()=>w,h:()=>O,ir:()=>g,iw:()=>h,n5:()=>C,nH:()=>P,oY:()=>p,p_:()=>j,vm:()=>f,z2:()=>k});var r=n(7141),a=n(5431),i=n(3143),s=n(2871),o=n(4011);function l(e){const{labelExpressionToAdd:t="",structuredMetadataToAdd:n="",fieldExpressionToAdd:r="",parser:a}=e;switch(a){case"structuredMetadata":return`{${i.S1}${t}} ${n} ${i.S6} ${i.qZ} ${i.sC} ${i.A2} ${r} ${i.Oc}`;case"json":return`{${i.S1}${t}} ${n} ${i.S6} ${i.qZ} ${i.sC} ${i.A2} ${i.VL} ${r} ${i.Oc}`;case"logfmt":return`{${i.S1}${t}} ${n} ${i.S6} ${i.qZ} ${i.sC} ${i.A2} ${i.mF} ${r} ${i.Oc}`;default:return`{${i.S1}${t}} ${n} ${i.S6} ${i.qZ} ${i.sC} ${i.A2} ${i.YN} ${r} ${i.Oc}`}}function c(e){const t=r.jh.lookupVariable(i.uw,e);if(!(t instanceof r.yP))throw new Error("VAR_PATTERNS not found");return t}function d(e){return S(i.MB,e)}function u(e){return S(i.fi,e)}function p(e){return S(i._P,e)}function g(e){return S(i.mB,e)}function h(e){return S(i._Y,e)}function v(e){const t=r.jh.lookupVariable(i.WM,e);if(!(t instanceof r.yP))throw new Error("VAR_LINE_FILTER not found");return t}function m(e){const t=r.jh.lookupVariable(i.Jg,e);if(!(t instanceof a.m))throw new Error("VAR_LABEL_GROUP_BY not found");return t}function f(e){const t=r.jh.lookupVariable(i.Wi,e);if(!(t instanceof a.m))throw new Error("SERVICE_LABEL_VAR not found");return t}function b(e){const t=r.jh.lookupVariable(i.LI,e);if(!(t instanceof a.m))throw new Error("VAR_FIELD_GROUP_BY not found");return t}function y(e){const t=r.jh.lookupVariable(i.EY,e);if(!(t instanceof r.mI))throw new Error("VAR_DATASOURCE not found");return t}function S(e,t){const n=r.jh.lookupVariable(e,t);if(!(n instanceof r.H9))throw new Error(`Could not get AdHocFiltersVariable ${e}. Variable not found.`);return n}function w(e){const t=r.jh.lookupVariable(i.Du,e);if(!(t instanceof a.m))throw new Error("VAR_PRIMARY_LABEL_SEARCH not found");return t}function O(e){w(e).setState({value:".+",label:""})}function E(e){const t=r.jh.lookupVariable(i.Gb,e);if(!(t instanceof r.H9))throw new Error("VAR_PRIMARY_LABEL not found");return t}function x(e,t){E(t).setState({filters:[{value:".+",operator:"=~",key:e}]})}function C(e){return`var-${e}`}function L(e,t=i.mB){try{const t=(0,o.fS)(JSON.parse(e.value));if(!1!==t)return t;throw new o.QX("getValueFromFieldsFilter: invalid filter value!")}catch(n){if(n instanceof o.QX?s.v.error(n,{msg:`getValueFromFieldsFilter: Failed to validate ${t}`,value:e.value}):s.v.error(n,{msg:`getValueFromFieldsFilter: Failed to parse ${t}`,value:e.value}),e.value)return{value:e.value,parser:"mixed"};throw n}}function k(e,t){return e.state.name===i.mB&&t?L(t):{value:null==t?void 0:t.value}}function j(e){return function(e){const t=e.filters.filter((e=>e.key===i.OX)).map((e=>e.value));if(!t)throw new Error("Service present in filters selected");return t[0]}(d(e).state)}function P(e){return y(e).getValue()}},1863:(e,t,n)=>{n.d(t,{m:()=>l,r:()=>c});var r=n(7141),a=n(5431),i=n(3143),s=n(4235),o=n(892);function l(e){const t=r.jh.getVariables(e);let n=[];for(const e of t.state.variables)e instanceof r.H9&&e.state.filters.length&&n.push(e),e instanceof a.m&&e.state.value&&"logsFormat"!==e.state.name&&n.push(e);return n}function c(e){const t=r.jh.getAncestor(e,s.PR);t.setState({patterns:[]}),l(t).forEach((e=>{if(e instanceof r.H9&&"adhoc_service_filter"===e.state.key){let{labelName:t}=(0,o.W6)();t===i.ky&&(t=i.OX),e.setState({filters:e.state.filters.filter((e=>e.key===t))})}else e instanceof r.H9?e.setState({filters:[]}):e instanceof a.m&&e.setState({value:"",text:""})}))}}}]);
//# sourceMappingURL=59.js.map